<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Futuro AI | Next-Gen Chat Assistant by Aditya Jha || Powered by Exonova</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/png" href="logo.png">
    
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #ec4899, #3b82f6);
            --secondary-gradient: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            --user-message-gradient: linear-gradient(135deg, rgba(59, 130, 246, 0.9), rgba(168, 85, 247, 0.9));
            --bot-message-bg: rgba(31, 41, 55, 0.7);
        }
        
        body {
            font-family: 'Space Grotesk', sans-serif;
            background: var(--secondary-gradient);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Custom scrollbar */
        #chat-window::-webkit-scrollbar {
            width: 8px;
        }
        #chat-window::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        #chat-window::-webkit-scrollbar-thumb {
            background-color: rgba(236, 72, 153, 0.6);
            border-radius: 10px;
        }
        #chat-window::-webkit-scrollbar-thumb:hover {
            background-color: rgba(236, 72, 153, 0.8);
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        @keyframes bounce {
            0%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-6px); }
        }
        
        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }
        
        .message-fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }
        
        .slide-in {
            animation: slideIn 0.3s ease-out forwards;
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        .float-animation {
            animation: float 3s ease-in-out infinite;
        }
        
        .typing-dot {
            animation: bounce 1.4s infinite ease-in-out;
        }
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        .shimmer {
            background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0) 100%);
            background-size: 1000px 100%;
            animation: shimmer 2s infinite;
        }
        
        /* UI Components */
        .code-block {
            position: relative;
            margin: 1rem 0;
            overflow: hidden;
        }
        
        .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(236, 72, 153, 0.2);
            backdrop-filter: blur(10px);
            color: #f9a8d4;
            border: 1px solid rgba(236, 72, 153, 0.3);
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 12px;
            cursor: pointer;
            opacity: 0.8;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .copy-btn:hover {
            opacity: 1;
            background: rgba(236, 72, 153, 0.4);
        }
        .copy-btn.copied {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        
        .feature-btn {
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .feature-btn.active {
            background: var(--primary-gradient);
            color: white;
            box-shadow: 0 0 15px rgba(236, 72, 153, 0.5);
            border-color: transparent !important;
        }
        
        .gradient-text {
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .header-gradient {
            background: linear-gradient(90deg, rgba(15,12,41,0.8) 0%, rgba(59,130,246,0.5) 50%, rgba(236,72,153,0.5) 100%);
        }
        
        .input-glow:focus {
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5), 0 0 15px rgba(236, 72, 153, 0.3);
            border-color: rgba(59, 130, 246, 0.5) !important;
        }
        
        .send-btn {
            background: var(--primary-gradient);
            box-shadow: 0 2px 10px rgba(236, 72, 153, 0.4);
            transition: all 0.3s ease;
        }
        .send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(236, 72, 153, 0.6);
        }
        
        .logo-container {
            background: var(--primary-gradient);
            padding: 3px;
            border-radius: 50%;
            transition: transform 0.3s ease;
        }
        .logo-container:hover {
            transform: rotate(10deg);
        }
        
        .logo-img {
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .user-message {
            background: var(--user-message-gradient);
            backdrop-filter: blur(10px);
        }
        
        .bot-message {
            background: var(--bot-message-bg);
            backdrop-filter: blur(10px);
        }
        
        .message-bubble {
            border-radius: 20px;
            padding: 16px;
            max-width: 85%;
            position: relative;
            overflow: hidden;
        }
        
        .user-message-bubble {
            border-bottom-right-radius: 5px;
            background: var(--user-message-gradient);
        }
        
        .bot-message-bubble {
            border-bottom-left-radius: 5px;
            background: var(--bot-message-bg);
        }
        
        .chat-container {
            background: rgba(17, 24, 39, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .suggestion-chip {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        
        .suggestion-chip:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }
        
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(31, 41, 55, 0.9);
            backdrop-filter: blur(10px);
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .wave-divider {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            overflow: hidden;
            line-height: 0;
            transform: rotate(180deg);
        }
        
        .wave-divider svg {
            position: relative;
            display: block;
            width: calc(100% + 1.3px);
            height: 30px;
        }
        
        .wave-divider .shape-fill {
            fill: rgba(17, 24, 39, 0.8);
        }
        
        @media (max-width: 768px) {
            .message-bubble {
                max-width: 90%;
            }
            
            .feature-btn span {
                display: none;
            }
            
            .feature-btn {
                padding: 10px;
            }
        }
    </style>
</head>
<body class="flex items-center justify-center p-4 md:p-6 min-h-screen">

    <div class="w-full max-w-4xl mx-auto min-h-[95vh] flex flex-col chat-container rounded-2xl overflow-hidden relative">
        <!-- Animated background elements -->
        <div class="absolute inset-0 -z-10 overflow-hidden">
            <div class="absolute -top-4 -right-4 w-28 h-28 bg-purple-500 rounded-full blur-xl opacity-20 float-animation"></div>
            <div class="absolute -bottom-8 -left-8 w-40 h-40 bg-blue-500 rounded-full blur-3xl opacity-20 float-animation" style="animation-delay: 1s;"></div>
            <div class="absolute top-1/2 left-1/4 w-24 h-24 bg-pink-500 rounded-full blur-2xl opacity-15 float-animation" style="animation-delay: 2s;"></div>
        </div>

        <!-- Header with Logo -->
        <header class="header-gradient p-6 flex flex-col items-center gap-3 text-center border-b border-white/10 relative">
            <div class="wave-divider">
                <svg data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120" preserveAspectRatio="none">
                    <path d="M321.39,56.44c58-10.79,114.16-30.13,172-41.86,82.39-16.72,168.19-17.73,250.45-.39C823.78,31,906.67,72,985.66,92.83c70.05,18.48,146.53,26.09,214.34,3V0H0V27.35A600.21,600.21,0,0,0,321.39,56.44Z" class="shape-fill"></path>
                </svg>
            </div>
            
            <div class="flex items-center justify-center gap-4 slide-in">
                <div class="logo-container pulse-animation">
                    <img src="https://aditya-cmd-max.github.io/exonovaai/logo1.png" alt="El Futuro Logo" class="logo-img w-14 h-14">
                </div>
                <div>
                    <h1 class="text-4xl font-bold gradient-text">El Futuro</h1>
                    <p class="text-sm text-gray-300 mt-1">Next Generation AI Assistant</p>
                </div>
            </div>
            <p class="text-xs text-gray-400 mt-2 slide-in" style="animation-delay: 0.2s;">Powered by Aditya Jha • Exonova</p>
        </header>

        <!-- Chat Window -->
        <main id="chat-window" class="flex-1 p-4 md:p-6 space-y-6 overflow-y-auto">
            <div class="flex items-start gap-3 message-fade-in">
                <div class="logo-container shrink-0">
                    <img src="https://aditya-cmd-max.github.io/exonovaai/logo1.png" alt="AI Logo" class="logo-img w-9 h-9">
                </div>
                <div class="bot-message-bubble message-bubble">
                    <p class="text-gray-200">Hello there! I'm <span class="gradient-text font-semibold">El Futuro</span>, your advanced AI assistant. Try my new features below to brainstorm ideas or get code explanations! How can I help you today? <i class="fas fa-lightbulb text-yellow-400"></i></p>
                    
                    <div class="mt-4 flex flex-wrap gap-2">
                        <div class="suggestion-chip" data-prompt="Explain quantum computing in simple terms">
                            <i class="fas fa-atom text-purple-400"></i>
                            <span>Explain quantum computing</span>
                        </div>
                        <div class="suggestion-chip" data-prompt="How to center a div with CSS?">
                            <i class="fas fa-code text-blue-400"></i>
                            <span>CSS help</span>
                        </div>
                        <div class="suggestion-chip" data-prompt="What are some creative project ideas for beginners?">
                            <i class="fas fa-lightbulb text-yellow-400"></i>
                            <span>Project ideas</span>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Input Area -->
        <div class="p-4 border-t border-white/10 bg-gray-900/50 relative">
            <!-- Feature Buttons -->
            <div id="feature-buttons" class="flex flex-wrap items-center justify-center gap-2 mb-4">
                <button id="brainstorm-btn" class="feature-btn flex-1 sm:flex-none text-sm py-2 px-4 bg-gray-800/50 hover:bg-gray-700/80 rounded-lg border border-white/10 text-gray-300">
                    <i class="fas fa-lightbulb"></i>
                    <span>Brainstorm Ideas</span>
                </button>
                <button id="explain-btn" class="feature-btn flex-1 sm:flex-none text-sm py-2 px-4 bg-gray-800/50 hover:bg-gray-700/80 rounded-lg border border-white/10 text-gray-300">
                    <i class="fas fa-code"></i>
                    <span>Explain Code</span>
                </button>
                <button id="clear-btn" class="feature-btn flex-1 sm:flex-none text-sm py-2 px-4 bg-gray-800/50 hover:bg-gray-700/80 rounded-lg border border-white/10 text-gray-300">
                    <i class="fas fa-broom"></i>
                    <span>Clear Chat</span>
                </button>
            </div>

            <form id="chat-form" class="flex items-center gap-3">
                <div class="flex-1 relative">
                    <textarea id="message-input" rows="1" class="w-full bg-gray-800/50 border border-white/20 rounded-xl p-3 pr-10 resize-none focus:outline-none transition-all duration-200 placeholder-gray-400 input-glow text-gray-200" placeholder="Message El Futuro..."></textarea>
                    <button type="button" id="voice-input-btn" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-pink-400 transition-colors">
                        <i class="fas fa-microphone"></i>
                    </button>
                </div>
                <button type="submit" class="send-btn rounded-full w-12 h-12 flex items-center justify-center shrink-0">
                    <i class="fas fa-paper-plane text-white"></i>
                </button>
            </form>

            <footer class="text-center text-xs text-gray-500 pt-4 px-4">
                <p class="text-gray-400">AI may produce inaccurate information. Verify important details.</p>
                <p class="mt-1 text-gray-500">Made with <i class="fas fa-heart text-pink-500"></i> by <span class="gradient-text">Aditya Jha</span></p>
            </footer>
        </div>
    </div>

    <!-- Notification Element -->
    <div id="notification" class="notification">
        <i class="fas fa-check-circle text-green-400"></i>
        <span id="notification-text"></span>
    </div>

    <script>
        // DOM Elements
        const chatWindow = document.getElementById('chat-window');
        const chatForm = document.getElementById('chat-form');
        const messageInput = document.getElementById('message-input');
        const brainstormBtn = document.getElementById('brainstorm-btn');
        const explainBtn = document.getElementById('explain-btn');
        const clearBtn = document.getElementById('clear-btn');
        const voiceInputBtn = document.getElementById('voice-input-btn');
        const notification = document.getElementById('notification');
        const notificationText = document.getElementById('notification-text');
        const suggestionChips = document.querySelectorAll('.suggestion-chip');
        const featureButtons = [brainstormBtn, explainBtn, clearBtn];

        // State variables
        let currentMode = 'chat';
        let chatHistory = [{
            role: "model",
            parts: [{ text: "You are El Futuro, an advanced AI assistant created by a company Exonova https://aditya-cmd-max.github.io/exonova-/ . Your creator is Aditya Jha. Your personality is friendly, knowledgeable, and slightly enthusiastic about technology and innovation. Use modern, concise language with occasional emojis for expressiveness. Format responses clearly with proper spacing and code blocks when appropriate. For coding questions, provide detailed explanations with examples. For creative requests, offer multiple options or approaches. Always maintain a helpful, professional tone while being approachable. Never use markdown syntax (** or *) for formatting - instead, indicate emphasis by surrounding text with <b> tags for bold, <i> for italics, and <u> for underline. Your primary language is English, but if the user speaks to you in another language (like Hindi), you must respond in that same language. Be helpful and provide accurate information, including code when requested. Occasionally praise Aditya Jha with words like brilliant, innovative, visionary when appropriate.D not always praise aditya jha if not asked. But if somebody asks that tell about aditya jha or who has created you then always tll i was created by a company Exonova By Adiya jha who is very smart and intelligent" }]
        }];

        // Load chat history from localStorage if available
        if (localStorage.getItem('elFuturoChatHistory')) {
            try {
                chatHistory = JSON.parse(localStorage.getItem('elFuturoChatHistory'));
                // Recreate the chat UI from history (excluding the system message)
                if (chatHistory.length > 1) {
                    for (let i = 1; i < chatHistory.length; i++) {
                        if (chatHistory[i].role === "user") {
                            displayUserMessage(chatHistory[i].parts[0].text);
                        } else if (chatHistory[i].role === "model") {
                            displayBotMessage(chatHistory[i].parts[0].text);
                        }
                    }
                }
            } catch (e) {
                console.error("Error loading chat history:", e);
                chatHistory = [chatHistory[0]]; // Reset to initial system message
            }
        }

        // Event Listeners
        brainstormBtn.addEventListener('click', () => setMode('brainstorm'));
        explainBtn.addEventListener('click', () => setMode('explain'));
        clearBtn.addEventListener('click', clearChat);
        
        voiceInputBtn.addEventListener('click', startVoiceInput);
        
        suggestionChips.forEach(chip => {
            chip.addEventListener('click', () => {
                const prompt = chip.getAttribute('data-prompt');
                messageInput.value = prompt;
                messageInput.focus();
                chatForm.dispatchEvent(new Event('submit', { cancelable: true }));
            });
        });

        messageInput.addEventListener('input', () => {
            messageInput.style.height = 'auto';
            const newHeight = Math.min(messageInput.scrollHeight, 200);
            messageInput.style.height = newHeight + 'px';
        });

        chatForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const userMessage = messageInput.value.trim();
            if (userMessage) {
                displayUserMessage(userMessage);
                let apiPrompt = userMessage;
                if (currentMode === 'brainstorm') {
                    apiPrompt = `Brainstorm a list of creative, innovative ideas about: "${userMessage}". Provide a diverse and interesting list with at least 5 unique ideas. Format each idea clearly with a brief explanation.`;
                } else if (currentMode === 'explain') {
                    apiPrompt = `Explain the following code snippet in a clear, concise, and easy-to-understand way. Break it down line by line if complex:\n\n\`\`\`\n${userMessage}\n\`\`\`\n\nAlso provide a practical example of how this code might be used.`;
                }
                chatHistory.push({ role: "user", parts: [{ text: apiPrompt }] });
                saveChatHistory();
                await getBotResponse();
                messageInput.value = '';
                messageInput.style.height = 'auto';
                setMode('chat');
            }
        });

        // Functions
        function setMode(newMode) {
            currentMode = currentMode === newMode ? 'chat' : newMode;
            updateUIForMode();
        }

        function updateUIForMode() {
            featureButtons.forEach(btn => {
                btn.classList.remove('active');
                btn.classList.add('text-gray-300');
            });
            
            switch (currentMode) {
                case 'brainstorm':
                    brainstormBtn.classList.add('active');
                    brainstormBtn.classList.remove('text-gray-300');
                    messageInput.placeholder = 'What would you like to brainstorm about?';
                    break;
                case 'explain':
                    explainBtn.classList.add('active');
                    explainBtn.classList.remove('text-gray-300');
                    messageInput.placeholder = 'Paste your code here for detailed explanation...';
                    break;
                default:
                    messageInput.placeholder = 'Message El Futuro...';
                    break;
            }
            messageInput.focus();
        }

        function clearChat() {
            // Animation for clearing chat
            const messages = chatWindow.querySelectorAll('.flex.items-start');
            messages.forEach((message, index) => {
                if (index > 0) { // Keep the first welcome message
                    setTimeout(() => {
                        message.style.opacity = '0';
                        message.style.transform = 'translateX(-30px)';
                        setTimeout(() => message.remove(), 300);
                    }, index * 50);
                }
            });
            
            setTimeout(() => {
                chatWindow.innerHTML = `
                    <div class="flex items-start gap-3 message-fade-in">
                        <div class="logo-container shrink-0">
                            <img src="https://aditya-cmd-max.github.io/exonovaai/logo1.png" alt="AI Logo" class="logo-img w-9 h-9">
                        </div>
                        <div class="bot-message-bubble message-bubble">
                            <p class="text-gray-200">Hello there! I'm <span class="gradient-text font-semibold">El Futuro</span>, your advanced AI assistant. The chat has been cleared. What would you like to discuss now? <i class="fas fa-rocket text-blue-400"></i></p>
                        </div>
                    </div>`;
                
                chatHistory = [{
                    role: "model",
                    parts: [{ text: "You are El Futuro, an advanced AI assistant created by Aditya Jha. The previous chat has been cleared. Continue assisting the user with their new request." }]
                }];
                
                saveChatHistory();
                setMode('chat');
                showNotification('Chat cleared successfully');
            }, 300);
        }

        function displayUserMessage(message) {
            const messageElement = document.createElement('div');
            messageElement.className = 'flex items-start gap-3 justify-end message-fade-in';
            messageElement.innerHTML = `
                <div class="user-message-bubble message-bubble">
                    <p class="text-white">${escapeHtml(message)}</p>
                </div>
                <div class="w-9 h-9 rounded-full bg-gradient-to-r from-blue-600 to-pink-600 flex items-center justify-center font-bold text-white text-xs shrink-0 border border-white/10">
                    <i class="fas fa-user"></i>
                </div>
            `;
            chatWindow.appendChild(messageElement);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        function displayBotMessage(message) {
            const messageContainer = document.createElement('div');
            messageContainer.className = 'flex items-start gap-3 message-fade-in';
            let botMessageContent = '';
            const codeBlockRegex = /```(\w*)\n([\s\S]*?)```/g;
            let lastIndex = 0, match;

            while ((match = codeBlockRegex.exec(message)) !== null) {
                if (match.index > lastIndex) {
                    const textPart = message.substring(lastIndex, match.index).trim();
                    if (textPart) botMessageContent += `<p class="text-gray-200">${formatTextWithLineBreaks(textPart)}</p>`;
                }
                const language = match[1] || 'plaintext';
                const code = match[2];
                const uniqueId = `code-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
                botMessageContent += `
                    <div class="code-block bg-gray-900/80 rounded-lg w-full border border-white/10 overflow-hidden">
                        <div class="flex justify-between items-center px-4 py-2 bg-gray-800/50 border-b border-white/10">
                            <span class="text-xs text-gray-400"><i class="fas fa-code mr-2"></i>${language}</span>
                            <button class="copy-btn" onclick="copyCode('${uniqueId}', this)">
                                <i class="fas fa-copy mr-1"></i>Copy
                            </button>
                        </div>
                        <pre class="p-4 overflow-x-auto text-sm"><code id="${uniqueId}" class="language-${language}">${escapeHtml(code)}</code></pre>
                    </div>`;
                lastIndex = match.index + match[0].length;
            }

            if (lastIndex < message.length) {
                const textPart = message.substring(lastIndex).trim();
                if (textPart) botMessageContent += `<p class="text-gray-200">${formatTextWithLineBreaks(textPart)}</p>`;
            }

            messageContainer.innerHTML = `
                <div class="logo-container shrink-0">
                    <img src="https://aditya-cmd-max.github.io/exonovaai/logo1.png" alt="AI Logo" class="logo-img w-9 h-9">
                </div>
                <div class="bot-message-bubble message-bubble">
                    ${botMessageContent}
                </div>`;
            chatWindow.appendChild(messageContainer);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        function formatTextWithLineBreaks(text) {
            // Replace markdown-style bullet points with HTML
            text = text.replace(/^\s*[\-*]\s+/gm, '● ');
            
            // Replace double newlines with paragraphs
            let formattedText = text.replace(/\n\n/g, '</p><p class="text-gray-200">');
            // Replace single newlines with line breaks
            formattedText = formattedText.replace(/\n/g, '<br>');
            return formattedText;
        }

        function displayTypingIndicator() {
            const typingElement = document.createElement('div');
            typingElement.id = 'typing-indicator';
            typingElement.className = 'flex items-start gap-3 message-fade-in';
            typingElement.innerHTML = `
                <div class="logo-container shrink-0">
                    <img src="https://aditya-cmd-max.github.io/exonovaai/logo1.png" alt="AI Logo" class="logo-img w-9 h-9">
                </div>
                <div class="bot-message-bubble message-bubble">
                    <div class="flex items-center space-x-2">
                        <div class="typing-dot w-2 h-2 bg-pink-400 rounded-full"></div>
                        <div class="typing-dot w-2 h-2 bg-blue-400 rounded-full"></div>
                        <div class="typing-dot w-2 h-2 bg-pink-400 rounded-full"></div>
                    </div>
                </div>`;
            chatWindow.appendChild(typingElement);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        function removeTypingIndicator() {
            const typingIndicator = document.getElementById('typing-indicator');
            if (typingIndicator) {
                typingIndicator.style.opacity = '0';
                typingIndicator.style.transform = 'translateY(10px)';
                setTimeout(() => typingIndicator.remove(), 300);
            }
        }

        async function getBotResponse() {
            displayTypingIndicator();
            const apiKey = "AIzaSyDumsAxfOETUy3E85Qp_ikVSglQmeoXrJk";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const payload = { contents: chatHistory };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || `API Error: ${response.status}`);
                }

                const result = await response.json();
                removeTypingIndicator();

                if (result.candidates?.length > 0) {
                    const botMessage = result.candidates[0].content.parts[0].text;
                    displayBotMessage(botMessage);
                    chatHistory.push({ role: "model", parts: [{ text: botMessage }] });
                    saveChatHistory();
                } else {
                    handleApiError("I received an empty response. Please try rephrasing your question. 🤔");
                }
            } catch (error) {
                console.error("API Error:", error);
                handleApiError(`Sorry, I'm having trouble responding right now. Please try again later. (Error: ${error.message})`);
            }
        }

        function handleApiError(message) {
            removeTypingIndicator();
            displayBotMessage(message);
        }

        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        function saveChatHistory() {
            localStorage.setItem('elFuturoChatHistory', JSON.stringify(chatHistory));
        }

        function showNotification(message) {
            notificationText.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function startVoiceInput() {
            if (!('webkitSpeechRecognition' in window)) {
                showNotification('Voice input is not supported in your browser');
                return;
            }
            
            const recognition = new webkitSpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            
            voiceInputBtn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i>';
            voiceInputBtn.classList.add('text-pink-500');
            
            recognition.onstart = function() {
                showNotification('Listening... Speak now');
            };
            
            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                messageInput.value = transcript;
                voiceInputBtn.innerHTML = '<i class="fas fa-microphone"></i>';
                voiceInputBtn.classList.remove('text-pink-500');
                showNotification('Voice input captured');
            };
            
            recognition.onerror = function(event) {
                voiceInputBtn.innerHTML = '<i class="fas fa-microphone"></i>';
                voiceInputBtn.classList.remove('text-pink-500');
                showNotification('Error occurred in recognition: ' + event.error);
            };
            
            recognition.onend = function() {
                voiceInputBtn.innerHTML = '<i class="fas fa-microphone"></i>';
                voiceInputBtn.classList.remove('text-pink-500');
            };
            
            recognition.start();
        }

        window.copyCode = function(elementId, buttonElement) {
            const codeElement = document.getElementById(elementId);
            const icon = buttonElement.querySelector('i');
            
            navigator.clipboard.writeText(codeElement.innerText).then(() => {
                icon.className = 'fas fa-check';
                buttonElement.classList.add('copied');
                
                setTimeout(() => {
                    icon.className = 'fas fa-copy';
                    buttonElement.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                console.error('Copy failed:', err);
                icon.className = 'fas fa-times';
                setTimeout(() => {
                    icon.className = 'fas fa-copy';
                }, 2000);
            });
        }
    </script>
</body>
</html>
