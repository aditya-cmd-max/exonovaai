<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clover AI | Advanced AI Assistant by Aditya Jha</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Product+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="https://aditya-cmd-max.github.io/exonovaai/logo.png">
    
    <style>
        /* Material Design 3 Color System */
        :root {
            /* Primary Colors */
            --md-primary: #6750A4;
            --md-on-primary: #FFFFFF;
            --md-primary-container: #EADDFF;
            --md-on-primary-container: #21005D;
            
            /* Secondary Colors */
            --md-secondary: #625B71;
            --md-on-secondary: #FFFFFF;
            --md-secondary-container: #E8DEF8;
            --md-on-secondary-container: #1D192B;
            
            /* Tertiary Colors */
            --md-tertiary: #7D5260;
            --md-on-tertiary: #FFFFFF;
            --md-tertiary-container: #FFD8E4;
            --md-on-tertiary-container: #31111D;
            
            /* Surface Colors */
            --md-surface: #FEF7FF;
            --md-on-surface: #1C1B1F;
            --md-surface-variant: #E7E0EC;
            --md-on-surface-variant: #49454F;
            
            /* Background Colors */
            --md-background: #FEF7FF;
            --md-on-background: #1C1B1F;
            
            /* Error Colors */
            --md-error: #B3261E;
            --md-on-error: #FFFFFF;
            --md-error-container: #F9DEDC;
            --md-on-error-container: #410E0B;
            
            /* Outline Colors */
            --md-outline: #79747E;
            --md-outline-variant: #C4C7C5;
            
            /* Shadow Elevations */
            --md-elevation-1: 0px 1px 2px rgba(0, 0, 0, 0.3), 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
            --md-elevation-2: 0px 1px 2px rgba(0, 0, 0, 0.3), 0px 2px 6px 2px rgba(0, 0, 0, 0.15);
            --md-elevation-3: 0px 4px 8px 3px rgba(0, 0, 0, 0.15), 0px 1px 3px rgba(0, 0, 0, 0.3);
            --md-elevation-4: 0px 6px 10px 4px rgba(0, 0, 0, 0.15), 0px 2px 3px rgba(0, 0, 0, 0.3);
            --md-elevation-5: 0px 8px 12px 6px rgba(0, 0, 0, 0.15), 0px 4px 4px rgba(0, 0, 0, 0.3);
            
            /* Animation */
            --md-transition: all 0.3s cubic-bezier(0.2, 0, 0, 1);
            --md-transition-fast: all 0.15s cubic-bezier(0.2, 0, 0, 1);
            
            /* Border Radius */
            --md-radius-small: 8px;
            --md-radius-medium: 12px;
            --md-radius-large: 16px;
            --md-radius-extra-large: 28px;
            
            /* Spacing */
            --md-spacing-xs: 4px;
            --md-spacing-sm: 8px;
            --md-spacing-md: 16px;
            --md-spacing-lg: 24px;
            --md-spacing-xl: 32px;
            
            /* Typography */
            --md-font-family: 'Product Sans', sans-serif;
            --md-font-size-display: 3.5625rem;
            --md-font-size-headline: 2rem;
            --md-font-size-title: 1.375rem;
            --md-font-size-body: 1rem;
            --md-font-size-label: 0.875rem;
        }

        /* Dark Theme */
        .dark-theme {
            --md-surface: #141218;
            --md-on-surface: #E6E1E5;
            --md-surface-variant: #49454F;
            --md-on-surface-variant: #CAC4D0;
            --md-background: #141218;
            --md-on-background: #E6E1E5;
            --md-primary-container: #4F378B;
            --md-on-primary-container: #EADDFF;
            --md-secondary-container: #4A4458;
            --md-on-secondary-container: #E8DEF8;
        }

        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--md-font-family);
            background-color: var(--md-background);
            color: var(--md-on-surface);
            line-height: 1.5;
            overflow-x: hidden;
            transition: var(--md-transition);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .app-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--md-spacing-md) var(--md-spacing-xl);
            background: var(--md-surface);
            border-bottom: 1px solid var(--md-outline-variant);
            position: sticky;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: var(--md-spacing-md);
        }

        .logo {
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--md-primary);
            border-radius: var(--md-radius-medium);
            color: var(--md-on-primary);
            overflow: hidden;
        }

        .logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: var(--md-radius-medium);
        }

        .app-name {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--md-on-surface);
            letter-spacing: -0.25px;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: var(--md-spacing-sm);
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--md-spacing-sm);
            padding: var(--md-spacing-sm) var(--md-spacing-md);
            border-radius: var(--md-radius-extra-large);
            border: none;
            font-family: inherit;
            font-size: var(--md-font-size-label);
            font-weight: 500;
            cursor: pointer;
            transition: var(--md-transition-fast);
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: currentColor;
            opacity: 0;
            transition: var(--md-transition-fast);
        }

        .btn:hover::before {
            opacity: 0.08;
        }

        .btn:active::before {
            opacity: 0.12;
        }

        .btn-filled {
            background: var(--md-primary);
            color: var(--md-on-primary);
            box-shadow: var(--md-elevation-1);
        }

        .btn-filled:hover {
            box-shadow: var(--md-elevation-2);
            transform: translateY(-2px);
        }

        .btn-tonal {
            background: var(--md-secondary-container);
            color: var(--md-on-secondary-container);
        }

        .btn-outlined {
            background: transparent;
            color: var(--md-primary);
            border: 1px solid var(--md-outline);
        }

        .btn-text {
            background: transparent;
            color: var(--md-primary);
        }

        .btn-icon {
            width: 48px;
            height: 48px;
            padding: 0;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        /* Stop Button Styles */
        .send-btn.stop-mode {
            background: var(--md-error);
            color: var(--md-on-error);
        }

        .send-btn.stop-mode:hover {
            background: var(--md-error);
            box-shadow: var(--md-elevation-2);
            transform: translateY(-2px);
        }

        .stop-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Theme Toggle */
        .theme-toggle {
            background: transparent;
            border: none;
            color: var(--md-on-surface);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            transition: var(--md-transition);
        }

        .theme-toggle:hover {
            background: var(--md-surface-variant);
        }

        /* Main Layout */
        .app-container {
            display: flex;
            flex: 1;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
            padding: var(--md-spacing-lg);
            gap: var(--md-spacing-xl);
        }

        /* Sidebar */
        .sidebar {
            width: 300px;
            background: var(--md-surface);
            border-radius: var(--md-radius-large);
            padding: var(--md-spacing-xl);
            box-shadow: var(--md-elevation-1);
            border: 1px solid var(--md-outline-variant);
            display: flex;
            flex-direction: column;
            gap: var(--md-spacing-xl);
        }

        .sidebar-section {
            display: flex;
            flex-direction: column;
            gap: var(--md-spacing-md);
        }

        .sidebar-title {
            font-size: var(--md-font-size-label);
            font-weight: 600;
            color: var(--md-on-surface-variant);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Feature Buttons - FIXED VISIBILITY */
        .feature-buttons {
            display: flex;
            flex-direction: column;
            gap: var(--md-spacing-sm);
        }

        .feature-btn {
            display: flex;
            align-items: center;
            gap: var(--md-spacing-md);
            padding: var(--md-spacing-md) var(--md-spacing-lg);
            background: var(--md-surface-variant);
            color: var(--md-on-surface-variant) !important;
            border: none;
            border-radius: var(--md-radius-medium);
            font-family: inherit;
            font-size: var(--md-font-size-body);
            font-weight: 500;
            cursor: pointer;
            transition: var(--md-transition);
            text-align: left;
            width: 100%;
        }

        .feature-btn:hover {
            background: var(--md-primary-container);
            color: var(--md-on-primary-container) !important;
            transform: translateX(4px);
        }

        .feature-btn.active {
            background: var(--md-primary);
            color: var(--md-on-primary) !important;
            box-shadow: var(--md-elevation-1);
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            flex-direction: column;
            gap: var(--md-spacing-sm);
        }

        .quick-action {
            display: flex;
            align-items: center;
            gap: var(--md-spacing-md);
            padding: var(--md-spacing-md);
            background: var(--md-surface);
            color: var(--md-on-surface) !important;
            border: 1px solid var(--md-outline-variant);
            border-radius: var(--md-radius-medium);
            font-family: inherit;
            font-size: var(--md-font-size-body);
            cursor: pointer;
            transition: var(--md-transition);
            text-align: left;
        }

        .quick-action:hover {
            background: var(--md-surface-variant);
            border-color: var(--md-primary);
            color: var(--md-on-surface) !important;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: var(--md-spacing-xl);
        }

        /* Chat Window */
        .chat-window {
            flex: 1;
            background: var(--md-surface);
            border-radius: var(--md-radius-large);
            padding: var(--md-spacing-xl);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: var(--md-spacing-xl);
            box-shadow: var(--md-elevation-1);
            border: 1px solid var(--md-outline-variant);
            max-height: 65vh;
            min-height: 500px;
        }

        /* Welcome Section */
        .welcome-section {
            text-align: center;
            padding: var(--md-spacing-xl);
            background: var(--md-surface-variant);
            border-radius: var(--md-radius-large);
            margin-bottom: var(--md-spacing-xl);
        }

        .welcome-title {
            font-size: 1.75rem;
            font-weight: 600;
            margin-bottom: var(--md-spacing-md);
            color: var(--md-on-surface);
        }

        .welcome-subtitle {
            font-size: var(--md-font-size-body);
            color: var(--md-on-surface-variant);
            margin-bottom: var(--md-spacing-xl);
        }

        /* Message Styles */
        .message {
            display: flex;
            gap: var(--md-spacing-lg);
            animation: fadeIn 0.3s ease-out;
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            overflow: hidden;
        }

        .message.user .message-avatar {
            background: var(--md-primary);
            color: var(--md-on-primary);
            order: 2;
        }

        .message.bot .message-avatar {
            background: var(--md-secondary-container);
            color: var(--md-on-secondary-container);
        }

        .message-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .message-bubble {
            max-width: 70%;
            padding: var(--md-spacing-lg);
            border-radius: var(--md-radius-large);
            position: relative;
            box-shadow: var(--md-elevation-1);
        }

        .message.user .message-bubble {
            background: var(--md-primary);
            color: var(--md-on-primary);
            border-bottom-right-radius: var(--md-radius-small);
        }

        .message.bot .message-bubble {
            background: var(--md-surface-variant);
            color: var(--md-on-surface-variant);
            border-bottom-left-radius: var(--md-radius-small);
        }

        .message-content {
            line-height: 1.6;
            font-size: var(--md-font-size-body);
        }

        .message-content p {
            margin-bottom: var(--md-spacing-sm);
        }

        .message-content ul, .message-content ol {
            margin-left: var(--md-spacing-xl);
            margin-bottom: var(--md-spacing-sm);
        }

        .message-content li {
            margin-bottom: var(--md-spacing-xs);
        }

        /* Code Block */
        .code-block {
            position: relative;
            margin: var(--md-spacing-lg) 0;
            overflow: hidden;
            border-radius: var(--md-radius-medium);
            background: var(--md-background);
            border: 1px solid var(--md-outline-variant);
        }

        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--md-spacing-md) var(--md-spacing-lg);
            background: var(--md-surface-variant);
            border-bottom: 1px solid var(--md-outline-variant);
            font-size: var(--md-font-size-label);
            color: var(--md-on-surface-variant);
        }

        .copy-btn {
            background: transparent;
            border: none;
            color: var(--md-on-surface-variant);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: var(--md-spacing-xs);
            padding: var(--md-spacing-sm) var(--md-spacing-md);
            border-radius: var(--md-radius-small);
            transition: var(--md-transition);
            font-size: var(--md-font-size-label);
        }

        .copy-btn:hover {
            background: var(--md-surface);
        }

        .copy-btn.copied {
            background: var(--md-primary);
            color: var(--md-on-primary);
        }

        .code-content {
            padding: var(--md-spacing-lg);
            overflow-x: auto;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.875rem;
            line-height: 1.5;
        }

        /* Suggestion Chips */
        .suggestion-chips {
            display: flex;
            flex-wrap: wrap;
            gap: var(--md-spacing-md);
            margin-top: var(--md-spacing-lg);
        }

        .suggestion-chip {
            background: var(--md-surface-variant);
            color: var(--md-on-surface-variant) !important;
            border: none;
            border-radius: var(--md-radius-extra-large);
            padding: var(--md-spacing-md) var(--md-spacing-lg);
            font-size: var(--md-font-size-body);
            font-weight: 500;
            cursor: pointer;
            transition: var(--md-transition);
            display: inline-flex;
            align-items: center;
            gap: var(--md-spacing-sm);
        }

        .suggestion-chip:hover {
            background: var(--md-primary-container);
            color: var(--md-on-primary-container) !important;
            transform: translateY(-2px);
        }

        /* Input Area - MODERN DESIGN LIKE CHATGPT/GEMINI */
        .input-area {
            background: var(--md-surface);
            border-radius: var(--md-radius-large);
            padding: var(--md-spacing-xl);
            box-shadow: var(--md-elevation-2);
            border: 1px solid var(--md-outline-variant);
        }

        .input-container {
            position: relative;
            background: var(--md-surface);
            border-radius: var(--md-radius-large);
            border: 2px solid var(--md-outline-variant);
            transition: var(--md-transition);
            padding: var(--md-spacing-md);
        }

        .input-container:focus-within {
            border-color: var(--md-primary);
            box-shadow: 0 0 0 3px rgba(103, 80, 164, 0.1);
        }

        .input-form {
            display: flex;
            gap: var(--md-spacing-md);
            align-items: flex-end;
        }

        .input-wrapper {
            flex: 1;
            position: relative;
        }

        .message-input {
            width: 100%;
            background: transparent;
            color: var(--md-on-surface);
            border: none;
            border-radius: var(--md-radius-medium);
            padding: var(--md-spacing-md);
            font-family: inherit;
            font-size: var(--md-font-size-body);
            resize: none;
            min-height: 60px;
            max-height: 120px;
            transition: var(--md-transition);
            outline: none;
            line-height: 1.5;
        }

        .message-input::placeholder {
            color: var(--md-on-surface-variant);
            opacity: 0.7;
        }

        .input-actions {
            display: flex;
            gap: var(--md-spacing-sm);
            align-items: center;
            padding: var(--md-spacing-sm);
        }

        .action-btn {
            background: transparent;
            border: none;
            color: var(--md-on-surface-variant);
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--md-transition);
        }

        .action-btn:hover {
            background: var(--md-surface-variant);
            color: var(--md-primary);
        }

        .send-btn {
            background: var(--md-primary);
            color: var(--md-on-primary);
            border: none;
            border-radius: 50%;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--md-transition);
            box-shadow: var(--md-elevation-1);
            flex-shrink: 0;
        }

        .send-btn:hover {
            box-shadow: var(--md-elevation-2);
            transform: translateY(-2px);
        }

        .send-btn:disabled {
            background: var(--md-surface-variant);
            color: var(--md-on-surface-variant);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Upload Button */
        .upload-btn {
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .upload-btn input[type="file"] {
            position: absolute;
            top: 0;
            right: 0;
            min-width: 100%;
            min-height: 100%;
            opacity: 0;
            cursor: pointer;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            gap: var(--md-spacing-lg);
            animation: fadeIn 0.3s ease-out;
        }

        .typing-dots {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: var(--md-spacing-lg);
            background: var(--md-surface-variant);
            border-radius: var(--md-radius-large);
            border-bottom-left-radius: var(--md-radius-small);
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--md-on-surface-variant);
            animation: bounce 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        /* Notification */
        .notification {
            position: fixed;
            bottom: var(--md-spacing-xl);
            right: var(--md-spacing-xl);
            background: var(--md-surface);
            color: var(--md-on-surface);
            padding: var(--md-spacing-lg) var(--md-spacing-xl);
            border-radius: var(--md-radius-large);
            box-shadow: var(--md-elevation-3);
            display: flex;
            align-items: center;
            gap: var(--md-spacing-md);
            transform: translateY(100px);
            opacity: 0;
            transition: var(--md-transition);
            z-index: 1000;
            border: 1px solid var(--md-outline-variant);
        }

        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }

        .notification.success {
            border-left: 4px solid #4CAF50;
        }

        .notification.error {
            border-left: 4px solid var(--md-error);
        }

        /* Footer */
        .app-footer {
            text-align: center;
            padding: var(--md-spacing-lg);
            color: var(--md-on-surface-variant);
            font-size: var(--md-font-size-body);
            border-top: 1px solid var(--md-outline-variant);
            background: var(--md-surface);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes bounce {
            0%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-6px); }
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .app-container {
                flex-direction: column;
                padding: var(--md-spacing-md);
            }
            
            .sidebar {
                width: 100%;
                order: 2;
            }
            
            .main-content {
                order: 1;
            }
        }

        @media (max-width: 768px) {
            .app-container {
                padding: var(--md-spacing-sm);
            }
            
            .message-bubble {
                max-width: 85%;
            }
            
            .feature-btn span {
                display: inline !important; /* Ensure text is always visible */
            }
            
            .feature-btn {
                padding: var(--md-spacing-md);
            }
            
            .suggestion-chip span {
                display: inline !important; /* Ensure text is always visible */
            }
            
            .suggestion-chip {
                padding: var(--md-spacing-sm);
            }
            
            .app-header {
                padding: var(--md-spacing-md);
            }
            
            .logo {
                width: 40px;
                height: 40px;
            }
            
            .app-name {
                font-size: 1.25rem;
            }
        }

        /* Web Search Button */
        .web-search-btn {
            background: var(--md-surface-variant);
            border: 1px solid var(--md-outline-variant);
            border-radius: var(--md-radius-small);
            padding: var(--md-spacing-sm) var(--md-spacing-md);
            font-size: var(--md-font-size-label);
            cursor: pointer;
            transition: var(--md-transition);
            display: inline-flex;
            align-items: center;
            gap: var(--md-spacing-sm);
            margin-top: var(--md-spacing-md);
        }

        .web-search-btn:hover {
            background: var(--md-primary-container);
            color: var(--md-on-primary-container);
        }

        /* Loading Spinner */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        /* Image Preview */
        .image-preview {
            max-width: 200px;
            border-radius: var(--md-radius-medium);
            margin-top: var(--md-spacing-sm);
        }

        /* Error Message */
        .error-message {
            color: var(--md-error);
            background: var(--md-error-container);
            padding: var(--md-spacing-md);
            border-radius: var(--md-radius-medium);
            margin: var(--md-spacing-sm) 0;
        }

        /* Google-like Blue Highlighting */
        .highlight {
            background-color: #e3f2fd;
            color: #1976d2;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: 500;
            box-shadow: 0 1px 2px rgba(25, 118, 210, 0.2);
            transition: all 0.2s ease;
        }

        .dark-theme .highlight {
            background-color: rgba(25, 118, 210, 0.2);
            color: #64b5f6;
            box-shadow: 0 1px 2px rgba(25, 118, 210, 0.3);
        }

        /* Feedback Buttons */
        /* Feedback Buttons - RESPONSIVE */
.feedback-buttons {
    display: flex;
    gap: var(--md-spacing-sm);
    margin-top: var(--md-spacing-md);
    padding-top: var(--md-spacing-sm);
    border-top: 1px solid var(--md-outline-variant);
    flex-wrap: wrap;
    align-items: center;
}

.feedback-btn {
    display: inline-flex;
    align-items: center;
    gap: var(--md-spacing-xs);
    padding: var(--md-spacing-xs) var(--md-spacing-sm);
    background: transparent;
    color: var(--md-on-surface-variant);
    border: 1px solid var(--md-outline-variant);
    border-radius: var(--md-radius-small);
    font-size: var(--md-font-size-label);
    cursor: pointer;
    transition: var(--md-transition);
    flex: 1;
    min-width: 0;
    justify-content: center;
    white-space: nowrap;
}

.feedback-btn:hover {
    background: var(--md-surface-variant);
    transform: translateY(-1px);
}

.feedback-btn.liked {
    background: rgba(76, 175, 80, 0.1);
    color: #4CAF50;
    border-color: #4CAF50;
}

.feedback-btn.disliked {
    background: rgba(244, 67, 54, 0.1);
    color: #F44336;
    border-color: #F44336;
}

/* Mobile-specific adjustments */
@media (max-width: 768px) {
    .feedback-buttons {
        gap: var(--md-spacing-xs);
        justify-content: space-between;
    }
    
    .feedback-btn {
        flex: 0 1 calc(33.333% - 8px);
        padding: 8px 6px;
        font-size: 0.75rem;
        min-height: 36px;
    }
    
    .feedback-btn span.material-icons-round {
        font-size: 16px !important;
    }
    
    .feedback-btn span:not(.material-icons-round) {
        font-size: 0.7rem;
    }
}

@media (max-width: 480px) {
    .feedback-buttons {
        flex-direction: row;
        gap: 4px;
    }
    
    .feedback-btn {
        flex: 1;
        min-width: 70px;
        padding: 6px 4px;
        font-size: 0.7rem;
    }
    
    .feedback-btn span.material-icons-round {
        font-size: 14px !important;
        margin-right: 2px;
    }
    
    /* Optionally hide text on very small screens and show only icons */
    .feedback-btn span:not(.material-icons-round) {
        display: none;
    }
    
    /* Or keep text but make it very compact */
    
    .feedback-btn {
        flex-direction: column;
        gap: 2px;
        padding: 4px 2px;
    }
    
    .feedback-btn span:not(.material-icons-round) {
        font-size: 0.6rem;
        line-height: 1;
    }
    
}
    </style>
</head>
<body class="light-theme">
    <!-- Splash Screen -->
    <div id="splash-screen" style="position:fixed; top:0; left:0; width:100%; height:100%; background-color:#141218; display:flex; align-items:center; justify-content:center; flex-direction:column; z-index:9999; color:#fff; font-family:'Product Sans', sans-serif;">
        <div class="logo" style="width:120px; height:120px; margin-bottom:20px; animation: spinZoom 1s ease-out forwards;">
            <img src="https://aditya-cmd-max.github.io/exonovaai/logo.png" alt="Clover AI Logo">
        </div>
        <h1 style="font-size:2.5em; letter-spacing:2px; margin:0;">Clover AI</h1>
        <p style="margin-top:10px; opacity:0.8;">Advanced AI Assistant</p>
    </div>

    <style>
        @keyframes spinZoom {
            0% {
                transform: scale(0) rotate(0deg);
                opacity: 0;
            }
            50% {
                transform: scale(1.2) rotate(180deg);
                opacity: 1;
            }
            100% {
                transform: scale(1) rotate(360deg);
                opacity: 1;
            }
        }

        #splash-screen {
            animation: fadeOut 2.5s forwards;
        }

        @keyframes fadeOut {
            0% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; display: none; }
        }
    </style>

    <!-- Main App -->
    <header class="app-header">
        <div class="logo-container">
            <div class="logo">
                <img src="https://aditya-cmd-max.github.io/exonovaai/logo.png" alt="Clover AI Logo">
            </div>
            <h1 class="app-name">Clover AI</h1>
        </div>
        
        <div class="header-actions">
            <button class="theme-toggle" id="theme-toggle">
                <span class="material-icons-round">dark_mode</span>
            </button>
        </div>
    </header>

    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-section">
                <h3 class="sidebar-title">AI Features</h3>
                <div class="feature-buttons">
                    <button id="brainstorm-btn" class="feature-btn">
                        <span class="material-icons-round">lightbulb</span>
                        <span>Brainstorm Ideas</span>
                    </button>
                    <button id="explain-btn" class="feature-btn">
                        <span class="material-icons-round">code</span>
                        <span>Explain Code</span>
                    </button>
                    <button id="web-search-btn" class="feature-btn">
                        <span class="material-icons-round">search</span>
                        <span>Web Search</span>
                    </button>
                    <button id="summarize-btn" class="feature-btn">
                        <span class="material-icons-round">summarize</span>
                        <span>Summarize Text</span>
                    </button>
                    <button id="translate-btn" class="feature-btn">
                        <span class="material-icons-round">translate</span>
                        <span>Translate</span>
                    </button>
                </div>
            </div>

            <div class="sidebar-section">
                <h3 class="sidebar-title">Quick Actions</h3>
                <div class="quick-actions">
                    <button class="quick-action" data-prompt="Create a study schedule for exam preparation">
                        <span class="material-icons-round">schedule</span>
                        <span>Study Schedule</span>
                    </button>
                    <button class="quick-action" data-prompt="Write a professional email template">
                        <span class="material-icons-round">email</span>
                        <span>Email Template</span>
                    </button>
                    <button class="quick-action" data-prompt="Explain machine learning in simple terms">
                        <span class="material-icons-round">psychology</span>
                        <span>ML Explanation</span>
                    </button>
                    <button class="quick-action" data-prompt="Create a workout plan for beginners">
                        <span class="material-icons-round">fitness_center</span>
                        <span>Workout Plan</span>
                    </button>
                </div>
            </div>

            <div class="sidebar-section">
                <h3 class="sidebar-title">Tools</h3>
                <div class="feature-buttons">
                    <button id="clear-btn" class="feature-btn">
                        <span class="material-icons-round">delete</span>
                        <span>Clear Chat</span>
                    </button>
                    <button id="export-btn" class="feature-btn">
                        <span class="material-icons-round">download</span>
                        <span>Export Chat</span>
                    </button>
                    <button id="history-btn" class="feature-btn">
                        <span class="material-icons-round">history</span>
                        <span>Chat History</span>
                    </button>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Chat Window -->
            <div class="chat-window" id="chat-window">
                <div class="welcome-section">
                    <h2 class="welcome-title">Welcome to Clover AI</h2>
                    <p class="welcome-subtitle">Your advanced AI assistant powered by Aditya Jha. Ask me anything or try one of the specialized features!</p>
                    
                    <div class="suggestion-chips">
                        <div class="suggestion-chip" data-prompt="Explain quantum computing in simple terms">
                            <span class="material-icons-round">science</span>
                            <span>Quantum Computing</span>
                        </div>
                        <div class="suggestion-chip" data-prompt="How to center a div with CSS?">
                            <span class="material-icons-round">code</span>
                            <span>CSS Help</span>
                        </div>
                        <div class="suggestion-chip" data-prompt="What are some creative project ideas for beginners?">
                            <span class="material-icons-round">lightbulb</span>
                            <span>Project Ideas</span>
                        </div>
                        <div class="suggestion-chip" data-prompt="Summarize the key points of artificial intelligence">
                            <span class="material-icons-round">summarize</span>
                            <span>AI Summary</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Input Area - ENHANCED DESIGN -->
            <div class="input-area">
                <div class="input-container">
                    <form id="chat-form" class="input-form">
                        <div class="input-wrapper">
                            <textarea id="message-input" class="message-input" rows="1" placeholder="Message Clover AI..."></textarea>
                        </div>
                        <div class="input-actions">
                            <button type="button" id="image-upload-btn" class="action-btn upload-btn" title="Upload Image">
                                <span class="material-icons-round">image</span>
                                <input type="file" id="image-input" accept="image/*" class="hidden">
                            </button>
                            <button type="button" id="voice-input-btn" class="action-btn" title="Voice Input">
                                <span class="material-icons-round">mic</span>
                            </button>
                            <button type="submit" class="send-btn" id="send-btn">
                                <span class="material-icons-round" id="send-icon">send</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <footer class="app-footer">
        <p>AI may produce inaccurate information. Verify important details.</p>
        <p>Made with <span class="material-icons-round" style="color: #F48FB1; font-size: 16px; vertical-align: middle;">favorite</span> by <span style="color: var(--md-primary); font-weight: 500;">Aditya Jha</span> â€¢ Powered by Exonova</p>
    </footer>

    <!-- Notification Element -->
    <div id="notification" class="notification">
        <span class="material-icons-round">check_circle</span>
        <span id="notification-text"></span>
    </div>

    <script>
        // Hide splash screen after 2.5 seconds
        setTimeout(() => {
            const splash = document.getElementById('splash-screen');
            if(splash) {
                splash.style.opacity = '0';
                setTimeout(() => {
                    splash.style.display = 'none';
                }, 500);
            }
        }, 2500);

        // DOM Elements
        const chatWindow = document.getElementById('chat-window');
        const chatForm = document.getElementById('chat-form');
        const messageInput = document.getElementById('message-input');
        const sendBtn = document.getElementById('send-btn');
        const sendIcon = document.getElementById('send-icon');
        const brainstormBtn = document.getElementById('brainstorm-btn');
        const explainBtn = document.getElementById('explain-btn');
        const webSearchBtn = document.getElementById('web-search-btn');
        const summarizeBtn = document.getElementById('summarize-btn');
        const translateBtn = document.getElementById('translate-btn');
        const clearBtn = document.getElementById('clear-btn');
        const exportBtn = document.getElementById('export-btn');
        const historyBtn = document.getElementById('history-btn');
        const voiceInputBtn = document.getElementById('voice-input-btn');
        const imageUploadBtn = document.getElementById('image-upload-btn');
        const imageInput = document.getElementById('image-input');
        const notification = document.getElementById('notification');
        const notificationText = document.getElementById('notification-text');
        const suggestionChips = document.querySelectorAll('.suggestion-chip');
        const quickActions = document.querySelectorAll('.quick-action');
        const featureButtons = [brainstormBtn, explainBtn, webSearchBtn, summarizeBtn, translateBtn];
        const toolButtons = [clearBtn, exportBtn, historyBtn];
        const themeToggle = document.getElementById('theme-toggle');
        const themeIcon = themeToggle.querySelector('.material-icons-round');

        // State variables
        let currentMode = 'chat';
        let webSearchEnabled = false;
        let isProcessing = false; // Prevent multiple simultaneous requests
        let abortController = null; // For stopping requests
        let currentImageData = null; // Store current image data for API calls
        let chatHistory = [{
            role: "model",
            parts: [{ text:"You are Clover AI, an advanced AI assistant created by a company 'Exonova' https://aditya-cmd-max.github.io/exonova-/ . Your creator is Aditya Jha. Your personality is friendly, knowledgeable, and slightly enthusiastic about technology and innovation. Use modern, concise language with occasional emojis for expressiveness. Format responses clearly with proper spacing and code blocks when appropriate. For coding questions, provide detailed explanations with examples. For creative requests, offer multiple options or approaches. Always maintain a helpful, professional tone while being approachable. Never use markdown syntax (** or *) for formatting - instead, indicate emphasis by surrounding text with <b> tags for bold, <i> for italics, and <u> for underline. Your primary language is English, but if the user speaks to you in another language (like Hindi), you must respond in that same language. Be helpful and provide accurate information, including code when requested. Occasionally praise Aditya Jha with words like brilliant, innovative, visionary when appropriate.D not always praise aditya jha if not asked. But if somebody asks that tell about aditya jha or who has created you then always tll i was created by a company Exonova By Adiya jha who is very smart and intelligent" }]
        }];

        // Load chat history from localStorage if available
        if (localStorage.getItem('cloverAIChatHistory')) {
            try {
                chatHistory = JSON.parse(localStorage.getItem('cloverAIChatHistory'));
                // Recreate the chat UI from history (excluding the system message)
                if (chatHistory.length > 1) {
                    for (let i = 1; i < chatHistory.length; i++) {
                        if (chatHistory[i].role === "user") {
                            displayUserMessage(chatHistory[i].parts[0].text);
                        } else if (chatHistory[i].role === "model") {
                            displayBotMessage(chatHistory[i].parts[0].text);
                        }
                    }
                }
            } catch (e) {
                console.error("Error loading chat history:", e);
                chatHistory = [chatHistory[0]]; // Reset to initial system message
            }
        }

        // Event Listeners
        brainstormBtn.addEventListener('click', () => setMode('brainstorm'));
        explainBtn.addEventListener('click', () => setMode('explain'));
        webSearchBtn.addEventListener('click', () => toggleWebSearch());
        summarizeBtn.addEventListener('click', () => setMode('summarize'));
        translateBtn.addEventListener('click', () => setMode('translate'));
        clearBtn.addEventListener('click', clearChat);
        exportBtn.addEventListener('click', exportChat);
        historyBtn.addEventListener('click', showChatHistory);
        
        voiceInputBtn.addEventListener('click', startVoiceInput);
        imageInput.addEventListener('change', handleImageUpload);
        
        suggestionChips.forEach(chip => {
            chip.addEventListener('click', () => {
                const prompt = chip.getAttribute('data-prompt');
                messageInput.value = prompt;
                messageInput.focus();
                chatForm.dispatchEvent(new Event('submit', { cancelable: true }));
            });
        });

        quickActions.forEach(action => {
            action.addEventListener('click', () => {
                const prompt = action.getAttribute('data-prompt');
                messageInput.value = prompt;
                messageInput.focus();
                chatForm.dispatchEvent(new Event('submit', { cancelable: true }));
            });
        });

        messageInput.addEventListener('input', () => {
            messageInput.style.height = 'auto';
            const newHeight = Math.min(messageInput.scrollHeight, 120);
            messageInput.style.height = newHeight + 'px';
            
            // Enable/disable send button based on input and processing state
            sendBtn.disabled = messageInput.value.trim() === '' || isProcessing;
        });

        // Update send button click handler for stop functionality
        sendBtn.addEventListener('click', function(e) {
            if (isProcessing) {
                // If currently processing, stop the response
                stopResponse();
                e.preventDefault();
            }
            // Otherwise, the form submission will handle sending
        });

        chatForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (isProcessing) {
                // If already processing, do nothing (stop button will handle stopping)
                return;
            }
            
            const userMessage = messageInput.value.trim();
            if (userMessage || currentImageData) {
                displayUserMessage(userMessage);
                let apiPrompt = userMessage;
                
                // Apply mode-specific formatting
                if (currentMode === 'brainstorm') {
                    apiPrompt = `Brainstorm a list of creative, innovative ideas about: "${userMessage}". Provide a diverse and interesting list with at least 5 unique ideas. Format each idea clearly with a brief explanation.`;
                } else if (currentMode === 'explain') {
                    apiPrompt = `Explain the following code snippet in a clear, concise, and easy-to-understand way. Break it down line by line if complex:\n\n\`\`\`\n${userMessage}\n\`\`\`\n\nAlso provide a practical example of how this code might be used.`;
                } else if (currentMode === 'summarize') {
                    apiPrompt = `Please provide a comprehensive summary of the following text. Include key points, main ideas, and important details:\n\n${userMessage}`;
                } else if (currentMode === 'translate') {
                    apiPrompt = `Translate the following text to English. If it's already in English, provide a more polished version:\n\n${userMessage}`;
                }
                
                // Clear the input field immediately after submission
                messageInput.value = '';
                messageInput.style.height = 'auto';
                sendBtn.disabled = true;
                
                // Add to chat history
                if (currentImageData) {
                    // For image uploads, we need to create a special message structure
                    chatHistory.push({ 
                        role: "user", 
                        parts: [
                            { text: apiPrompt || "Please analyze this image and describe what you see." },
                            { inline_data: currentImageData }
                        ] 
                    });
                    currentImageData = null; // Reset image data after use
                } else {
                    chatHistory.push({ role: "user", parts: [{ text: apiPrompt }] });
                }
                
                saveChatHistory();
                
                // Get response
                await getBotResponse();
                setMode('chat');
            }
        });

        // Theme Toggle
        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('light-theme');
            document.body.classList.toggle('dark-theme');
            
            if (document.body.classList.contains('dark-theme')) {
                themeIcon.textContent = 'light_mode';
                localStorage.setItem('cloverAITheme', 'dark');
            } else {
                themeIcon.textContent = 'dark_mode';
                localStorage.setItem('cloverAITheme', 'light');
            }
        });

        // Load saved theme
        const savedTheme = localStorage.getItem('cloverAITheme');
        if (savedTheme === 'dark') {
            document.body.classList.add('dark-theme');
            document.body.classList.remove('light-theme');
            themeIcon.textContent = 'light_mode';
        }

        // Functions
        function setMode(newMode) {
            currentMode = currentMode === newMode ? 'chat' : newMode;
            updateUIForMode();
        }

        function toggleWebSearch() {
            webSearchEnabled = !webSearchEnabled;
            webSearchBtn.classList.toggle('active', webSearchEnabled);
            
            if (webSearchEnabled) {
                showNotification('Web search enabled - I will search for up-to-date information');
            } else {
                showNotification('Web search disabled');
            }
        }

        function updateUIForMode() {
            featureButtons.forEach(btn => {
                btn.classList.remove('active');
            });
            
            switch (currentMode) {
                case 'brainstorm':
                    brainstormBtn.classList.add('active');
                    messageInput.placeholder = 'What would you like to brainstorm about?';
                    break;
                case 'explain':
                    explainBtn.classList.add('active');
                    messageInput.placeholder = 'Paste your code here for detailed explanation...';
                    break;
                case 'summarize':
                    summarizeBtn.classList.add('active');
                    messageInput.placeholder = 'Paste text to summarize...';
                    break;
                case 'translate':
                    translateBtn.classList.add('active');
                    messageInput.placeholder = 'Enter text to translate...';
                    break;
                default:
                    messageInput.placeholder = 'Message Clover AI...';
                    break;
            }
        }

        function toggleSendButton(isProcessing) {
            if (isProcessing) {
                // Change to stop button
                sendBtn.classList.add('stop-mode');
                sendIcon.innerHTML = '<span class="stop-spinner"></span>';
                sendBtn.title = 'Stop generating';
            } else {
                // Change back to send button
                sendBtn.classList.remove('stop-mode');
                sendIcon.innerHTML = 'send';
                sendBtn.title = 'Send message';
            }
        }

        function stopResponse() {
            if (abortController) {
                abortController.abort();
                abortController = null;
            }
            
            isProcessing = false;
            toggleSendButton(false);
            hideTypingIndicator();
            
            // Add a stopped message
            const stoppedMessage = "Response stopped by user.";
            displayBotMessage(stoppedMessage, false);
            
            showNotification('Response stopped');
        }

        function clearChat() {
            const welcomeSection = chatWindow.querySelector('.welcome-section');
            chatWindow.innerHTML = '';
            if (welcomeSection) {
                chatWindow.appendChild(welcomeSection);
            }
            
            // Reset chat history to just the system message
            chatHistory = [chatHistory[0]];
            currentImageData = null;
            saveChatHistory();
            
            // Reattach event listeners to suggestion chips
            document.querySelectorAll('.suggestion-chip').forEach(chip => {
                chip.addEventListener('click', () => {
                    const prompt = chip.getAttribute('data-prompt');
                    messageInput.value = prompt;
                    messageInput.focus();
                    chatForm.dispatchEvent(new Event('submit', { cancelable: true }));
                });
            });
            
            showNotification('Chat cleared successfully');
        }

        function exportChat() {
            const chatText = chatHistory.map(entry => {
                if (entry.role === 'user') {
                    return `You: ${entry.parts[0].text}`;
                } else {
                    return `Clover AI: ${entry.parts[0].text}`;
                }
            }).join('\n\n');
            
            const blob = new Blob([chatText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `clover-ai-chat-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Chat exported successfully');
        }

        function showChatHistory() {
            showNotification('Chat history feature coming soon!');
        }

        function displayUserMessage(message) {
            const messageElement = document.createElement('div');
            messageElement.className = 'message user';
            
            let messageContent = '';
            if (message) {
                messageContent = `<div class="message-content">${escapeHtml(message)}</div>`;
            }
            
            messageElement.innerHTML = `
                <div class="message-bubble">
                    ${messageContent}
                </div>
                <div class="message-avatar">
                    <span class="material-icons-round">person</span>
                </div>
            `;
            chatWindow.appendChild(messageElement);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        function displayBotMessage(message, typewriterEffect = true) {
            const messageElement = document.createElement('div');
            messageElement.className = 'message bot';
            
            let botMessageContent = '';
            const codeBlockRegex = /```(\w*)\n([\s\S]*?)```/g;
            let lastIndex = 0, match;

            while ((match = codeBlockRegex.exec(message)) !== null) {
                if (match.index > lastIndex) {
                    const textPart = message.substring(lastIndex, match.index).trim();
                    if (textPart) botMessageContent += `<div class="message-content">${formatTextWithLineBreaks(textPart)}</div>`;
                }
                const language = match[1] || 'plaintext';
                const code = match[2];
                const uniqueId = `code-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
                botMessageContent += `
                    <div class="code-block">
                        <div class="code-header">
                            <span><span class="material-icons-round" style="font-size: 16px; vertical-align: middle;">code</span> ${language}</span>
                            <button class="copy-btn" onclick="copyCode('${uniqueId}', this)">
                                <span class="material-icons-round">content_copy</span>
                                <span>Copy</span>
                            </button>
                        </div>
                        <div class="code-content" id="${uniqueId}">${escapeHtml(code)}</div>
                    </div>`;
                lastIndex = match.index + match[0].length;
            }

            if (lastIndex < message.length) {
                const textPart = message.substring(lastIndex).trim();
                if (textPart) botMessageContent += `<div class="message-content">${formatTextWithLineBreaks(textPart)}</div>`;
            }

            // Generate a unique ID for this message to track feedback
            const messageId = `msg-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
            
            // Add feedback buttons
            botMessageContent += `
                <div class="feedback-buttons" id="feedback-${messageId}">
                    <button class="feedback-btn like-btn" onclick="handleFeedback('${messageId}', 'like')">
                        <span class="material-icons-round">thumb_up</span>
                        <span>Like</span>
                    </button>
                    <button class="feedback-btn dislike-btn" onclick="handleFeedback('${messageId}', 'dislike')">
                        <span class="material-icons-round">thumb_down</span>
                        <span>Dislike</span>
                    </button>
                    <button class="feedback-btn retry-btn" onclick="handleFeedback('${messageId}', 'retry')">
                        <span class="material-icons-round">refresh</span>
                        <span>Retry</span>
                    </button>
                </div>
            `;

            messageElement.innerHTML = `
                <div class="message-avatar">
                    <img src="https://aditya-cmd-max.github.io/exonovaai/logo.png" alt="AI Logo">
                </div>
                <div class="message-bubble">
                    ${botMessageContent}
                </div>
            `;
            chatWindow.appendChild(messageElement);
            
            // Apply highlighting after the message is added to DOM
            setTimeout(() => {
                applyHighlighting(messageElement);
            }, 100);
            
            // Scroll to the beginning of the message for better reading experience
            messageElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function formatTextWithLineBreaks(text) {
            // Replace markdown-style bold with HTML tags
            text = text.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>');
            
            // Replace markdown-style italic with HTML tags
            text = text.replace(/\*(.*?)\*/g, '<i>$1</i>');
            
            // Replace markdown-style underline with HTML tags
            text = text.replace(/__(.*?)__/g, '<u>$1</u>');
            
            // Replace markdown-style bullet points with HTML
            text = text.replace(/^\s*[\-*]\s+(.*)$/gm, 'â¦¿ $1<br>');
            
            // Replace numbered lists
            text = text.replace(/^\s*\d+\.\s+(.*)$/gm, '<span style="margin-right: 5px;">â—</span> $1<br>');
            
            // Replace double newlines with paragraphs
            let formattedText = text.replace(/\n\n/g, '</p><p>');
            // Replace single newlines with line breaks
            formattedText = formattedText.replace(/\n/g, '<br>');
            
            return formattedText;
        }

        function applyHighlighting(messageElement) {
            const messageContents = messageElement.querySelectorAll('.message-content');
            if (!messageContents.length) return;

            messageContents.forEach(messageContent => {
                let text = messageContent.textContent || messageContent.innerText;
                
                // Skip if text is too short
                if (text.length < 20) return;
                
                // Find and rank important terms, then select only the top 1-2
                const topTerms = findTopImportantTerms(text);
                
                console.log("Top important terms to highlight:", topTerms); // Debug
                
                if (topTerms.length > 0) {
                    let html = messageContent.innerHTML;
                    
                    // Highlight only the top 1-2 terms
                    topTerms.forEach(term => {
                        const regex = new RegExp(escapeRegExp(term.term), 'gi');
                        html = html.replace(regex, `<span class="highlight">$&</span>`);
                    });
                    
                    messageContent.innerHTML = html;
                }
            });
        }

        function escapeRegExp(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        function findTopImportantTerms(text) {
            const allTerms = [];
            
            // Strategy 1: Find proper nouns and capitalized terms
            const properNounRegex = /\b([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\b/g;
            const properNouns = text.match(properNounRegex) || [];
            
            properNouns.forEach(term => {
                if (term.length > 3 && !isCommonWord(term) && !isSentenceStarter(term)) {
                    // Score based on length and capitalization pattern
                    let score = term.length;
                    if (term.split(' ').length > 1) score += 10; // Multi-word terms get bonus
                    if (/^[A-Z]+$/.test(term)) score += 5; // Acronyms get bonus
                    
                    allTerms.push({ term, score, type: 'proper_noun' });
                }
            });
            
            // Strategy 2: Find technical terms
            const technicalTerms = extractTechnicalTerms(text);
            technicalTerms.forEach(term => {
                allTerms.push({ term, score: term.length + 8, type: 'technical' });
            });
            
            // Strategy 3: Find quoted phrases (usually important)
            const quotedTerms = extractQuotedPhrases(text);
            quotedTerms.forEach(term => {
                allTerms.push({ term, score: term.length + 15, type: 'quoted' });
            });
            
            // Strategy 4: Find contextually important terms
            const contextualTerms = extractContextualTerms(text);
            contextualTerms.forEach(term => {
                allTerms.push({ term, score: term.length + 12, type: 'contextual' });
            });
            
            // Remove duplicates and sort by score (highest first)
            const uniqueTerms = [];
            const seen = new Set();
            
            allTerms.forEach(item => {
                const lowerTerm = item.term.toLowerCase();
                if (!seen.has(lowerTerm)) {
                    seen.add(lowerTerm);
                    uniqueTerms.push(item);
                }
            });
            
            // Sort by score (highest first) and take only top 2
            uniqueTerms.sort((a, b) => b.score - a.score);
            
            // Return only the top 1-2 terms
            return uniqueTerms.slice(0, 2);
        }

        function isCommonWord(term) {
            const commonWords = [
                'This', 'The', 'That', 'These', 'Those', 'There', 'Their', 'They', 'What',
                'When', 'Where', 'Why', 'How', 'Which', 'Who', 'Will', 'Would', 'Could',
                'Should', 'Have', 'Has', 'Had', 'Are', 'Is', 'Was', 'Were', 'And', 'But',
                'Or', 'Not', 'For', 'With', 'From', 'About', 'Into', 'Through', 'During',
                'While', 'Since', 'Until', 'Upon', 'Without', 'Within', 'Among', 'Between'
            ];
            return commonWords.includes(term);
        }

        function isSentenceStarter(term) {
            const sentenceStarters = [
                'However', 'Therefore', 'Moreover', 'Furthermore', 'Additionally', 'Consequently',
                'Nevertheless', 'Nonetheless', 'Meanwhile', 'Similarly', 'Specifically',
                'Interestingly', 'Importantly', 'Basically', 'Essentially'
            ];
            return sentenceStarters.includes(term);
        }

        function extractTechnicalTerms(text) {
            const terms = [];
            
            const patterns = [
                /\b[A-Z]{2,}\b/g, // Acronyms (2+ uppercase letters)
                /\b\w+-\w+\b/g,   // Hyphenated terms
                /\b\w+\.\w+\b/g,  // Terms with dots
                /\b\w+\d+\w*\b/g  // Terms with numbers
            ];
            
            patterns.forEach(pattern => {
                const matches = text.match(pattern) || [];
                matches.forEach(match => {
                    if (match.length > 2 && !isCommonAcronym(match)) {
                        terms.push(match);
                    }
                });
            });
            
            return terms;
        }

        function isCommonAcronym(term) {
            const commonAcronyms = ['AI', 'ML', 'API', 'URL', 'HTML', 'CSS', 'JS', 'HTTP', 'HTTPS'];
            return commonAcronyms.includes(term.toUpperCase());
        }

        function extractQuotedPhrases(text) {
            const terms = [];
            
            const quotePatterns = [
                /"([^"]+)"/g,    // Double quotes
                /'([^']+)'/g,    // Single quotes
                /\(([^)]+)\)/g   // Parentheses
            ];
            
            quotePatterns.forEach(pattern => {
                const matches = [...text.matchAll(pattern)];
                matches.forEach(match => {
                    if (match[1].length > 3 && match[1].length < 30) {
                        terms.push(match[1]);
                    }
                });
            });
            
            return terms;
        }

        function extractContextualTerms(text) {
            const terms = [];
            
            const contextPatterns = [
                /(?:called|named|termed|known as|referred to as)\s+([A-Z][a-z]+(?:\s+[A-Za-z]+)*)/gi,
                /(?:such as|including|like|especially)\s+([A-Z][a-z]+(?:\s+[A-Za-z]+)*)/gi,
                /(?:technology|framework|library|language|tool|platform|concept|principle)\s+([A-Z][a-z]+(?:\s+[A-Za-z]+)*)/gi
            ];
            
            contextPatterns.forEach(pattern => {
                const matches = [...text.matchAll(pattern)];
                matches.forEach(match => {
                    if (match[1] && match[1].length > 2) {
                        terms.push(match[1]);
                    }
                });
            });
            
            return terms;
        }

        function showTypingIndicator() {
            const typingElement = document.createElement('div');
            typingElement.className = 'typing-indicator';
            typingElement.id = 'typing-indicator';
            typingElement.innerHTML = `
                <div class="message-avatar">
                    <img src="https://aditya-cmd-max.github.io/exonovaai/logo.png" alt="AI Logo">
                </div>
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            chatWindow.appendChild(typingElement);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typing-indicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        async function getBotResponse() {
            showTypingIndicator();
            isProcessing = true;
            toggleSendButton(true);
            
            const apiKey = "AIzaSyDumsAxfOETUy3E85Qp_ikVSglQmeoXrJk";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            
            // If web search is enabled, add search instruction
            let modifiedHistory = [...chatHistory];
            if (webSearchEnabled) {
                // Add search instruction to the last user message
                const lastUserMessage = modifiedHistory[modifiedHistory.length - 1];
                if (lastUserMessage.role === "user") {
                    if (lastUserMessage.parts[0].text) {
                        lastUserMessage.parts[0].text += " (Please perform a web search to provide the most up-to-date information)";
                    }
                }
            }
            
            const payload = { contents: modifiedHistory };

            // Create abort controller for stopping requests
            abortController = new AbortController();

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload),
                    signal: abortController.signal
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || `API Error: ${response.status}`);
                }

                const result = await response.json();
                hideTypingIndicator();
                isProcessing = false;
                toggleSendButton(false);

                if (result.candidates?.length > 0) {
                    const botMessage = result.candidates[0].content.parts[0].text;
                    displayBotMessage(botMessage);
                    chatHistory.push({ role: "model", parts: [{ text: botMessage }] });
                    saveChatHistory();
                } else {
                    handleApiError("I received an empty response. Please try rephrasing your question. ðŸ¤”");
                }
            } catch (error) {
                // Don't show error if it was due to abort
                if (error.name === 'AbortError') {
                    console.log('Request was cancelled');
                    return;
                }
                
                console.error("API Error:", error);
                handleApiError(`Sorry, I'm having trouble responding right now. Please try again later. (Error: ${error.message})`);
            } finally {
                isProcessing = false;
                toggleSendButton(false);
                abortController = null;
            }
        }

        function handleApiError(message) {
            hideTypingIndicator();
            isProcessing = false;
            toggleSendButton(false);
            displayBotMessage(message, false);
        }

        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        function copyCode(elementId, buttonElement) {
            const codeElement = document.getElementById(elementId);
            const icon = buttonElement.querySelector('.material-icons-round');
            
            navigator.clipboard.writeText(codeElement.innerText).then(() => {
                icon.textContent = 'check';
                buttonElement.classList.add('copied');
                
                setTimeout(() => {
                    icon.textContent = 'content_copy';
                    buttonElement.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                console.error('Copy failed:', err);
                icon.textContent = 'close';
                setTimeout(() => {
                    icon.textContent = 'content_copy';
                }, 2000);
            });
        }

        function startVoiceInput() {
            if (!('webkitSpeechRecognition' in window)) {
                showNotification('Voice input is not supported in your browser');
                return;
            }
            
            const recognition = new webkitSpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            
            voiceInputBtn.innerHTML = '<span class="material-icons-round">autorenew</span>';
            voiceInputBtn.style.color = 'var(--md-primary)';
            
            recognition.onstart = function() {
                showNotification('Listening... Speak now');
            };
            
            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                messageInput.value = transcript;
                voiceInputBtn.innerHTML = '<span class="material-icons-round">mic</span>';
                voiceInputBtn.style.color = '';
                sendBtn.disabled = false;
                showNotification('Voice input captured');
            };
            
            recognition.onerror = function(event) {
                voiceInputBtn.innerHTML = '<span class="material-icons-round">mic</span>';
                voiceInputBtn.style.color = '';
                showNotification('Error occurred in recognition: ' + event.error);
            };
            
            recognition.onend = function() {
                voiceInputBtn.innerHTML = '<span class="material-icons-round">mic</span>';
                voiceInputBtn.style.color = '';
            };
            
            recognition.start();
        }

        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.type.match('image.*')) {
                showNotification('Please upload an image file');
                return;
            }
            
            // Check file size (limit to 5MB)
            if (file.size > 5 * 1024 * 1024) {
                showNotification('Image size should be less than 5MB', 'error');
                event.target.value = '';
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                // Display the image in chat
                const messageElement = document.createElement('div');
                messageElement.className = 'message user';
                messageElement.innerHTML = `
                    <div class="message-bubble">
                        <p class="text-white mb-2">Image analysis request:</p>
                        <img src="${e.target.result}" alt="Uploaded image" class="image-preview">
                    </div>
                    <div class="message-avatar">
                        <span class="material-icons-round">person</span>
                    </div>
                `;
                chatWindow.appendChild(messageElement);
                chatWindow.scrollTop = chatWindow.scrollHeight;
                
                // Store image data for API call
                currentImageData = {
                    mime_type: file.type,
                    data: e.target.result.split(',')[1]
                };
                
                // Auto-submit the image for analysis
                chatForm.dispatchEvent(new Event('submit', { cancelable: true }));
            };
            
            reader.onerror = function() {
                showNotification('Error reading the image file', 'error');
            };
            
            reader.readAsDataURL(file);
            // Reset the file input
            event.target.value = '';
        }

        function showNotification(message, type = 'success') {
            notification.className = `notification ${type}`;
            notificationText.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function saveChatHistory() {
            try {
                localStorage.setItem('cloverAIChatHistory', JSON.stringify(chatHistory));
            } catch (e) {
                console.error("Error saving chat history:", e);
                // If localStorage is full, clear old history
                if (e.name === 'QuotaExceededError') {
                    localStorage.removeItem('cloverAIChatHistory');
                    showNotification('Chat history cleared due to storage limits', 'error');
                }
            }
        }

        // Feedback handling function
        function handleFeedback(messageId, action) {
            const feedbackContainer = document.getElementById(`feedback-${messageId}`);
            const likeBtn = feedbackContainer.querySelector('.like-btn');
            const dislikeBtn = feedbackContainer.querySelector('.dislike-btn');
            
            // Reset all buttons first
            likeBtn.classList.remove('liked');
            dislikeBtn.classList.remove('disliked');
            
            // Apply the selected action
            if (action === 'like') {
                likeBtn.classList.add('liked');
                showNotification('Thanks for your feedback! ðŸ‘');
            } else if (action === 'dislike') {
                dislikeBtn.classList.add('disliked');
                showNotification('Thanks for your feedback! We\'ll try to improve. ðŸ‘Ž');
            } else if (action === 'retry') {
                // Find the user message that prompted this response
                const messageElements = document.querySelectorAll('.message');
                let userMessage = '';
                
                // Find the message element with this ID
                for (let i = 0; i < messageElements.length; i++) {
                    if (messageElements[i].querySelector(`#feedback-${messageId}`)) {
                        // The previous message should be the user's message
                        if (i > 0 && messageElements[i-1].classList.contains('user')) {
                            const userBubble = messageElements[i-1].querySelector('.message-bubble');
                            if (userBubble) {
                                userMessage = userBubble.textContent || userBubble.innerText;
                            }
                        }
                        break;
                    }
                }
                
                if (userMessage) {
                    // Set the message input to the user's previous message and submit
                    messageInput.value = userMessage;
                    chatForm.dispatchEvent(new Event('submit', { cancelable: true }));
                } else {
                    showNotification('Could not find the original message to retry', 'error');
                }
            }
            
            // Save feedback to localStorage for analytics
            const feedbackData = {
                messageId,
                action,
                timestamp: new Date().toISOString()
            };
            
            let feedbackHistory = JSON.parse(localStorage.getItem('cloverAIFeedback') || '[]');
            feedbackHistory.push(feedbackData);
            localStorage.setItem('cloverAIFeedback', JSON.stringify(feedbackHistory));
        }

        // Initialize the UI
        updateUIForMode();
        sendBtn.disabled = true;

        // Force button text visibility
        document.querySelectorAll('.feature-btn, .quick-action, .suggestion-chip').forEach(btn => {
            btn.style.color = 'var(--md-on-surface-variant)';
        });
    </script>
</body>
</html>
