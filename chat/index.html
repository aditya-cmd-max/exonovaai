<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clover AI | Advanced AI Assistant by Aditya Jha</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Product+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="https://aditya-cmd-max.github.io/exonovaai/logo.png">

    <meta name="google-site-verification" content="gVm_Dk4QJW6bhd3nyT3WJPIzHXt9SEgn8Z43IU2t27Y" />
    
    <style>
        /* Material Design 3 Color System - Default Purple Theme */
        :root {
            /* Primary Colors */
            --md-primary: #6750A4;
            --md-on-primary: #FFFFFF;
            --md-primary-container: #EADDFF;
            --md-on-primary-container: #21005D;
            
            /* Secondary Colors */
            --md-secondary: #625B71;
            --md-on-secondary: #FFFFFF;
            --md-secondary-container: #E8DEF8;
            --md-on-secondary-container: #1D192B;
            
            /* Tertiary Colors */
            --md-tertiary: #7D5260;
            --md-on-tertiary: #FFFFFF;
            --md-tertiary-container: #FFD8E4;
            --md-on-tertiary-container: #31111D;
            
            /* Surface Colors */
            --md-surface: #FEF7FF;
            --md-on-surface: #1C1B1F;
            --md-surface-variant: #E7E0EC;
            --md-on-surface-variant: #49454F;
            
            /* Background Colors */
            --md-background: #FEF7FF;
            --md-on-background: #1C1B1F;
            
            /* Error Colors */
            --md-error: #B3261E;
            --md-on-error: #FFFFFF;
            --md-error-container: #F9DEDC;
            --md-on-error-container: #410E0B;
            
            /* Outline Colors */
            --md-outline: #79747E;
            --md-outline-variant: #C4C7C5;
            
            /* Shadow Elevations */
            --md-elevation-1: 0px 1px 2px rgba(0, 0, 0, 0.3), 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
            --md-elevation-2: 0px 1px 2px rgba(0, 0, 0, 0.3), 0px 2px 6px 2px rgba(0, 0, 0, 0.15);
            --md-elevation-3: 0px 4px 8px 3px rgba(0, 0, 0, 0.15), 0px 1px 3px rgba(0, 0, 0, 0.3);
            --md-elevation-4: 0px 6px 10px 4px rgba(0, 0, 0, 0.15), 0px 2px 3px rgba(0, 0, 0, 0.3);
            --md-elevation-5: 0px 8px 12px 6px rgba(0, 0, 0, 0.15), 0px 4px 4px rgba(0, 0, 0, 0.3);
            
            /* Animation */
            --md-transition: all 0.3s cubic-bezier(0.2, 0, 0, 1);
            --md-transition-fast: all 0.15s cubic-bezier(0.2, 0, 0, 1);
            
            /* Border Radius */
            --md-radius-small: 8px;
            --md-radius-medium: 12px;
            --md-radius-large: 16px;
            --md-radius-extra-large: 28px;
            
            /* Spacing */
            --md-spacing-xs: 4px;
            --md-spacing-sm: 8px;
            --md-spacing-md: 16px;
            --md-spacing-lg: 24px;
            --md-spacing-xl: 32px;
            
            /* Typography */
            --md-font-family: 'Product Sans', sans-serif;
            --md-font-size-display: 3.5625rem;
            --md-font-size-headline: 2rem;
            --md-font-size-title: 1.375rem;
            --md-font-size-body: 1rem;
            --md-font-size-label: 0.875rem;
            
            /* Sidebar */
            --sidebar-width: 320px;
            --sidebar-min-width: 72px;
        }

        /* Theme Color Variations */
        .theme-blue {
            --md-primary: #1a73e8;
            --md-primary-container: #d2e3fc;
            --md-on-primary-container: #001d3d;
        }

        .theme-green {
            --md-primary: #0a7e07;
            --md-primary-container: #c8e6c9;
            --md-on-primary-container: #002106;
        }

        .theme-orange {
            --md-primary: #ff6d00;
            --md-primary-container: #ffdcc3;
            --md-on-primary-container: #3c1300;
        }

        .theme-pink {
            --md-primary: #c2185b;
            --md-primary-container: #f8bbd0;
            --md-on-primary-container: #3f0021;
        }

        .theme-teal {
            --md-primary: #00796b;
            --md-primary-container: #b2dfdb;
            --md-on-primary-container: #00201c;
        }

        .theme-gradient {
            --md-primary: linear-gradient(135deg, #ff4f5a, #9b4dff, #3b82f6);
            --md-primary-container: linear-gradient(135deg, rgba(255, 79, 90, 0.1), rgba(155, 77, 255, 0.1), rgba(59, 130, 246, 0.1));
            --md-on-primary-container: #21005D;
        }

        /* Dark Theme */
        .dark-theme {
            --md-surface: #141218;
            --md-on-surface: #E6E1E5;
            --md-surface-variant: #49454F;
            --md-on-surface-variant: #CAC4D0;
            --md-background: #141218;
            --md-on-background: #E6E1E5;
            --md-primary-container: #4F378B;
            --md-on-primary-container: #EADDFF;
            --md-secondary-container: #4A4458;
            --md-on-secondary-container: #E8DEF8;
        }

        /* Gradient Username */
        .gradient-username {
            background: linear-gradient(135deg, #ff4f5a, #9b4dff, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 600;
        }

        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--md-font-family);
            background-color: var(--md-background);
            color: var(--md-on-surface);
            line-height: 1.5;
            overflow-x: hidden;
            transition: var(--md-transition);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .app-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--md-spacing-md) var(--md-spacing-xl);
            background: var(--md-surface);
            border-bottom: 1px solid var(--md-outline-variant);
            position: sticky;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: var(--md-spacing-md);
        }

        .logo {
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--md-primary);
            border-radius: var(--md-radius-medium);
            color: var(--md-on-primary);
            overflow: hidden;
        }

        .logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: var(--md-radius-medium);
        }

        .app-name {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--md-on-surface);
            letter-spacing: -0.25px;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: var(--md-spacing-sm);
        }

        /* Mobile Menu Button - Hidden on Desktop */
        .mobile-menu-btn {
            display: none;
            background: transparent;
            border: none;
            color: var(--md-on-surface);
            cursor: pointer;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            transition: var(--md-transition);
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .mobile-menu-btn:hover {
            background: var(--md-surface-variant);
        }

        .mobile-menu-btn .bar {
            width: 24px;
            height: 2px;
            background: var(--md-on-surface);
            margin: 2px 0;
            transition: var(--md-transition);
            border-radius: 1px;
        }

        .mobile-menu-btn.active .bar:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }

        .mobile-menu-btn.active .bar:nth-child(2) {
            opacity: 0;
        }

        .mobile-menu-btn.active .bar:nth-child(3) {
            transform: rotate(-45deg) translate(7px, -6px);
        }

        /* Customization Panel */
        .customization-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 380px;
            height: 100%;
            background: var(--md-surface);
            z-index: 1001;
            overflow-y: auto;
            transition: var(--md-transition);
            box-shadow: var(--md-elevation-5);
            border-left: 1px solid var(--md-outline-variant);
            display: flex;
            flex-direction: column;
        }

        .customization-panel.active {
            right: 0;
        }

        .customization-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--md-spacing-xl) var(--md-spacing-xl) var(--md-spacing-lg);
            border-bottom: 1px solid var(--md-outline-variant);
        }

        .customization-title {
            font-size: var(--md-font-size-title);
            font-weight: 600;
            color: var(--md-on-surface);
        }

        .customization-close {
            background: transparent;
            border: none;
            color: var(--md-on-surface);
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--md-transition);
        }

        .customization-close:hover {
            background: var(--md-surface-variant);
        }

        .customization-content {
            flex: 1;
            padding: var(--md-spacing-xl);
            display: flex;
            flex-direction: column;
            gap: var(--md-spacing-xl);
        }

        .customization-section {
            display: flex;
            flex-direction: column;
            gap: var(--md-spacing-md);
        }

        .section-title {
            font-size: var(--md-font-size-label);
            font-weight: 600;
            color: var(--md-on-surface-variant);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .name-input-container {
            display: flex;
            flex-direction: column;
            gap: var(--md-spacing-sm);
        }

        .name-input {
            width: 100%;
            padding: var(--md-spacing-md);
            background: var(--md-surface-variant);
            border: 1px solid var(--md-outline-variant);
            border-radius: var(--md-radius-medium);
            font-family: inherit;
            font-size: var(--md-font-size-body);
            color: var(--md-on-surface);
            transition: var(--md-transition);
            outline: none;
        }

        .name-input:focus {
            border-color: var(--md-primary);
            box-shadow: 0 0 0 2px rgba(103, 80, 164, 0.1);
        }

        .theme-colors {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--md-spacing-md);
        }

        .theme-color {
            width: 100%;
            aspect-ratio: 1;
            border-radius: var(--md-radius-medium);
            cursor: pointer;
            transition: var(--md-transition);
            border: 3px solid transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .theme-color.active {
            border-color: var(--md-primary);
            transform: scale(1.05);
        }

        .theme-color.purple {
            background: #6750A4;
        }

        .theme-color.blue {
            background: #1a73e8;
        }

        .theme-color.green {
            background: #0a7e07;
        }

        .theme-color.orange {
            background: #ff6d00;
        }

        .theme-color.pink {
            background: #c2185b;
        }

        .theme-color.teal {
            background: #00796b;
        }

        .theme-color.gradient {
            background: linear-gradient(135deg, #ff4f5a, #9b4dff, #3b82f6);
        }

        .toggle-options {
            display: flex;
            flex-direction: column;
            gap: var(--md-spacing-sm);
        }

        .toggle-option {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--md-spacing-md);
            background: var(--md-surface-variant);
            border-radius: var(--md-radius-medium);
            transition: var(--md-transition);
        }

        .toggle-option:hover {
            background: var(--md-primary-container);
        }

        .toggle-label {
            font-size: var(--md-font-size-body);
            color: var(--md-on-surface);
        }

        .toggle-switch {
            position: relative;
            width: 52px;
            height: 28px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--md-outline-variant);
            transition: var(--md-transition);
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: var(--md-transition);
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--md-primary);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        .customization-footer {
            padding: var(--md-spacing-xl);
            border-top: 1px solid var(--md-outline-variant);
        }

        /* Profile Picture Section */
        .profile-picture-section {
            display: flex;
            flex-direction: column;
            gap: var(--md-spacing-md);
        }

        .profile-picture-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--md-spacing-md);
        }

        .profile-picture-preview {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: var(--md-surface-variant);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border: 3px solid var(--md-outline-variant);
            transition: var(--md-transition);
        }

        .profile-picture-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-picture-preview .material-icons-round {
            font-size: 40px;
            color: var(--md-on-surface-variant);
        }

        .profile-picture-actions {
            display: flex;
            gap: var(--md-spacing-sm);
        }

        .profile-picture-btn {
            padding: var(--md-spacing-sm) var(--md-spacing-md);
            border-radius: var(--md-radius-medium);
            border: none;
            font-family: inherit;
            font-size: var(--md-font-size-label);
            font-weight: 500;
            cursor: pointer;
            transition: var(--md-transition);
        }

        .profile-picture-btn.primary {
            background: var(--md-primary);
            color: var(--md-on-primary);
        }

        .profile-picture-btn.secondary {
            background: var(--md-surface-variant);
            color: var(--md-on-surface-variant);
        }

        .profile-picture-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        /* Mobile Sidebar Overlay */
        .mobile-sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: var(--md-transition);
        }

        .mobile-sidebar-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* Mobile Sidebar */
        .mobile-sidebar {
            position: fixed;
            top: 0;
            left: -100%;
            width: 85%;
            max-width: 320px;
            height: 100%;
            background: var(--md-surface);
            z-index: 1000;
            overflow-y: auto;
            transition: var(--md-transition);
            display: flex;
            flex-direction: column;
            padding: var(--md-spacing-xl) var(--md-spacing-lg);
            box-shadow: var(--md-elevation-5);
            border-right: 1px solid var(--md-outline-variant);
        }

        .mobile-sidebar.active {
            left: 0;
        }

        .mobile-sidebar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--md-spacing-xl);
            padding-bottom: var(--md-spacing-md);
            border-bottom: 1px solid var(--md-outline-variant);
        }

        .mobile-sidebar-close {
            background: transparent;
            border: none;
            color: var(--md-on-surface);
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--md-transition);
        }

        .mobile-sidebar-close:hover {
            background: var(--md-surface-variant);
        }

        .mobile-sidebar-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: var(--md-spacing-xl);
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--md-spacing-sm);
            padding: var(--md-spacing-sm) var(--md-spacing-md);
            border-radius: var(--md-radius-extra-large);
            border: none;
            font-family: inherit;
            font-size: var(--md-font-size-label);
            font-weight: 500;
            cursor: pointer;
            transition: var(--md-transition-fast);
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: currentColor;
            opacity: 0;
            transition: var(--md-transition-fast);
        }

        .btn:hover::before {
            opacity: 0.08;
        }

        .btn:active::before {
            opacity: 0.12;
        }

        .btn-filled {
            background: var(--md-primary);
            color: var(--md-on-primary);
            box-shadow: var(--md-elevation-1);
        }

        .btn-filled:hover {
            box-shadow: var(--md-elevation-2);
            transform: translateY(-2px);
        }

        .btn-tonal {
            background: var(--md-secondary-container);
            color: var(--md-on-secondary-container);
        }

        .btn-outlined {
            background: transparent;
            color: var(--md-primary);
            border: 1px solid var(--md-outline);
        }

        .btn-text {
            background: transparent;
            color: var(--md-primary);
        }

        .btn-icon {
            width: 48px;
            height: 48px;
            padding: 0;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        /* Search Chat Section */
        .search-chat-container {
            position: relative;
            margin-bottom: var(--md-spacing-md);
        }

        .search-chat-input {
            width: 100%;
            padding: var(--md-spacing-sm) var(--md-spacing-md);
            padding-left: 40px;
            background: var(--md-surface-variant);
            border: 1px solid var(--md-outline-variant);
            border-radius: var(--md-radius-medium);
            font-family: inherit;
            font-size: var(--md-font-size-body);
            color: var(--md-on-surface);
            transition: var(--md-transition);
            outline: none;
        }

        .search-chat-input:focus {
            border-color: var(--md-primary);
            box-shadow: 0 0 0 2px rgba(103, 80, 164, 0.1);
        }

        .search-chat-input::placeholder {
            color: var(--md-on-surface-variant);
        }

        .search-icon {
            position: absolute;
            left: var(--md-spacing-md);
            top: 50%;
            transform: translateY(-50%);
            color: var(--md-on-surface-variant);
            pointer-events: none;
        }

        .clear-search-btn {
            position: absolute;
            right: var(--md-spacing-sm);
            top: 50%;
            transform: translateY(-50%);
            background: transparent;
            border: none;
            color: var(--md-on-surface-variant);
            cursor: pointer;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--md-transition);
            opacity: 0;
        }

        .clear-search-btn:hover {
            background: var(--md-surface);
            color: var(--md-error);
        }

        .clear-search-btn.visible {
            opacity: 1;
        }

        /* No results message */
        .no-chats-found {
            text-align: center;
            padding: var(--md-spacing-lg);
            color: var(--md-on-surface-variant);
            font-style: italic;
        }

        /* Highlight matching text in search results */
        .highlight-match {
            background-color: var(--md-primary-container);
            color: var(--md-on-primary-container);
            padding: 1px 2px;
            border-radius: 2px;
        }

        /* Stop Button Styles */
        .send-btn.stop-mode {
            background: var(--md-error);
            color: var(--md-on-error);
        }

        .send-btn.stop-mode:hover {
            background: var(--md-error);
            box-shadow: var(--md-elevation-2);
            transform: translateY(-2px);
        }

        .stop-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Theme Toggle */
        .theme-toggle {
            background: transparent;
            border: none;
            color: var(--md-on-surface);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            transition: var(--md-transition);
        }

        .theme-toggle:hover {
            background: var(--md-surface-variant);
        }

        /* Customization Button */
        .customization-btn {
            background: transparent;
            border: none;
            color: var(--md-on-surface);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            transition: var(--md-transition);
        }

        .customization-btn:hover {
            background: var(--md-surface-variant);
        }

        /* Main Layout */
        .app-container {
            display: flex;
            flex: 1;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
            padding: var(--md-spacing-lg);
            gap: var(--md-spacing-xl);
            height: calc(100vh - 80px);
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            min-width: var(--sidebar-min-width);
            max-width: 500px;
            background: var(--md-surface);
            border-radius: var(--md-radius-large);
            padding: var(--md-spacing-xl);
            box-shadow: var(--md-elevation-1);
            border: 1px solid var(--md-outline-variant);
            display: flex;
            flex-direction: column;
            gap: var(--md-spacing-xl);
            overflow-y: auto;
            transition: var(--md-transition);
            resize: horizontal;
            position: relative;
        }

        /* Resize Handle */
        .sidebar::after {
            content: '';
            position: absolute;
            right: -4px;
            top: 0;
            bottom: 0;
            width: 8px;
            cursor: col-resize;
            z-index: 10;
        }

        /* Collapsed Sidebar Styles */
        .sidebar.collapsed {
            width: var(--sidebar-min-width);
            padding: var(--md-spacing-md);
        }

        .sidebar.collapsed .sidebar-section {
            align-items: center;
        }

        .sidebar.collapsed .sidebar-title,
        .sidebar.collapsed .search-chat-container,
        .sidebar.collapsed .chat-session-title,
        .sidebar.collapsed .feature-btn span:not(.material-icons-round),
        .sidebar.collapsed .quick-action span:not(.material-icons-round),
        .sidebar.collapsed .chat-session-pin,
        .sidebar.collapsed .chat-session-delete {
            display: none;
        }

        .sidebar.collapsed .sidebar-title {
            justify-content: center;
        }

        .sidebar.collapsed .feature-btn,
        .sidebar.collapsed .quick-action,
        .sidebar.collapsed .chat-session {
            justify-content: center;
            padding: var(--md-spacing-md);
        }

        .sidebar.collapsed .chat-sessions-container {
            max-height: 150px;
        }

        /* Toggle Sidebar Button */
        .sidebar-toggle {
            position: absolute;
            top: var(--md-spacing-md);
            right: var(--md-spacing-md);
            background: transparent;
            border: none;
            color: var(--md-on-surface-variant);
            cursor: pointer;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--md-transition);
            z-index: 5;
        }

        .sidebar-toggle:hover {
            background: var(--md-surface-variant);
        }

        .sidebar-section {
            display: flex;
            flex-direction: column;
            gap: var(--md-spacing-md);
        }

        /* Chat Sessions with Separate Scroll */
        .chat-sessions-container {
            display: flex;
            flex-direction: column;
            gap: var(--md-spacing-sm);
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid var(--md-outline-variant);
            border-radius: var(--md-radius-medium);
            padding: var(--md-spacing-sm);
            background: var(--md-surface);
        }

        .chat-sessions {
            display: flex;
            flex-direction: column;
            gap: var(--md-spacing-sm);
            flex: 1;
        }

        /* Mobile sidebar specific styles */
        .mobile-sidebar .chat-sessions-container {
            max-height: 180px;
        }

        /* Scrollbar Styling */
        .chat-sessions-container::-webkit-scrollbar {
            width: 6px;
        }

        .chat-sessions-container::-webkit-scrollbar-track {
            background: var(--md-surface-variant);
            border-radius: 3px;
        }

        .chat-sessions-container::-webkit-scrollbar-thumb {
            background: var(--md-outline-variant);
            border-radius: 3px;
        }

        .chat-sessions-container::-webkit-scrollbar-thumb:hover {
            background: var(--md-primary);
        }

        /* Adjust sidebar sections spacing */
        .sidebar-section:first-child {
            flex: 0 0 auto;
        }

        .sidebar-section:not(:first-child) {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .sidebar-section:not(:first-child) .feature-buttons,
        .sidebar-section:not(:first-child) .quick-actions {
            flex: 1;
            overflow-y: auto;
            max-height: none;
        }

        .sidebar-title {
            font-size: var(--md-font-size-label);
            font-weight: 600;
            color: var(--md-on-surface-variant);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Chat Session Items */
        .chat-session {
            display: flex;
            align-items: center;
            gap: var(--md-spacing-md);
            padding: var(--md-spacing-md);
            background: var(--md-surface);
            color: var(--md-on-surface) !important;
            border: 1px solid var(--md-outline-variant);
            border-radius: var(--md-radius-medium);
            font-family: inherit;
            font-size: var(--md-font-size-body);
            cursor: pointer;
            transition: var(--md-transition);
            text-align: left;
            position: relative;
        }

        .chat-session:hover {
            background: var(--md-surface-variant);
            border-color: var(--md-primary);
        }

        .chat-session.active {
            background: var(--md-primary-container);
            color: var(--md-on-primary-container) !important;
            border-color: var(--md-primary);
        }

        /* Pin Chat Button Styles - Updated to Pill Shape */
        .chat-session-pin {
            position: absolute;
            right: 40px;
            background: transparent;
            border: none;
            color: var(--md-on-surface-variant);
            cursor: pointer;
            opacity: 0;
            transition: var(--md-transition);
            width: 28px;
            height: 28px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chat-session:hover .chat-session-pin {
            opacity: 1;
        }

        .chat-session-pin.pinned {
            opacity: 1;
            color: var(--md-primary);
            background: var(--md-primary-container);
        }

        .chat-session-pin:hover {
            color: var(--md-primary);
            background: var(--md-surface-variant);
        }

        .chat-session-delete {
            position: absolute;
            right: var(--md-spacing-md);
            background: transparent;
            border: none;
            color: var(--md-on-surface-variant);
            cursor: pointer;
            opacity: 0;
            transition: var(--md-transition);
        }

        .chat-session:hover .chat-session-delete {
            opacity: 1;
        }

        .chat-session-delete:hover {
            color: var(--md-error);
        }

        /* Pin Filter Button */
        .pin-filter-btn {
            background: transparent;
            border: none;
            color: var(--md-on-surface-variant);
            cursor: pointer;
            width: 32px;
            height: 32px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--md-transition);
        }

        .pin-filter-btn:hover {
            background: var(--md-surface-variant);
        }

        .pin-filter-btn.active {
            background: var(--md-primary);
            color: var(--md-on-primary);
        }

        /* Feature Buttons */
        .feature-buttons {
            display: flex;
            flex-direction: column;
            gap: var(--md-spacing-sm);
        }

        .feature-btn {
            display: flex;
            align-items: center;
            gap: var(--md-spacing-md);
            padding: var(--md-spacing-md) var(--md-spacing-lg);
            background: var(--md-surface-variant);
            color: var(--md-on-surface-variant) !important;
            border: none;
            border-radius: var(--md-radius-medium);
            font-family: inherit;
            font-size: var(--md-font-size-body);
            font-weight: 500;
            cursor: pointer;
            transition: var(--md-transition);
            text-align: left;
            width: 100%;
        }

        .feature-btn:hover {
            background: var(--md-primary-container);
            color: var(--md-on-primary-container) !important;
            transform: translateX(4px);
        }

        .feature-btn.active {
            background: var(--md-primary);
            color: var(--md-on-primary) !important;
            box-shadow: var(--md-elevation-1);
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            flex-direction: column;
            gap: var(--md-spacing-sm);
        }

        .quick-action {
            display: flex;
            align-items: center;
            gap: var(--md-spacing-md);
            padding: var(--md-spacing-md);
            background: var(--md-surface);
            color: var(--md-on-surface) !important;
            border: 1px solid var(--md-outline-variant);
            border-radius: var(--md-radius-medium);
            font-family: inherit;
            font-size: var(--md-font-size-body);
            cursor: pointer;
            transition: var(--md-transition);
            text-align: left;
        }

        .quick-action:hover {
            background: var(--md-surface-variant);
            border-color: var(--md-primary);
            color: var(--md-on-surface) !important;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: var(--md-spacing-xl);
            min-width: 0; /* Prevent flex overflow */
        }

        /* Chat Header */
        .chat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--md-spacing-md) var(--md-spacing-lg);
            background: var(--md-surface);
            border-radius: var(--md-radius-large);
            box-shadow: var(--md-elevation-1);
            border: 1px solid var(--md-outline-variant);
        }

        .chat-title {
            font-size: var(--md-font-size-title);
            font-weight: 600;
            color: var(--md-on-surface);
        }

        .chat-actions {
            display: flex;
            gap: var(--md-spacing-sm);
        }

        /* Chat Window */
        .chat-window {
            flex: 1;
            background: var(--md-surface);
            border-radius: var(--md-radius-large);
            padding: var(--md-spacing-xl);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: var(--md-spacing-xl);
            box-shadow: var(--md-elevation-1);
            border: 1px solid var(--md-outline-variant);
            min-height: 400px;
        }

        /* Welcome Section */
        .welcome-section {
            text-align: center;
            padding: var(--md-spacing-xl);
            background: var(--md-surface-variant);
            border-radius: var(--md-radius-large);
            margin-bottom: var(--md-spacing-xl);
        }

        .welcome-title {
            font-size: 1.75rem;
            font-weight: 600;
            margin-bottom: var(--md-spacing-md);
            color: var(--md-on-surface);
        }

        .welcome-subtitle {
            font-size: var(--md-font-size-body);
            color: var(--md-on-surface-variant);
            margin-bottom: var(--md-spacing-xl);
        }

        /* Message Styles */
        .message {
            display: flex;
            gap: var(--md-spacing-lg);
            animation: fadeIn 0.3s ease-out;
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            overflow: hidden;
        }

        .message.user .message-avatar {
            background: var(--md-primary);
            color: var(--md-on-primary);
            order: 2;
        }

        .message.bot .message-avatar {
            background: var(--md-secondary-container);
            color: var(--md-on-secondary-container);
        }

        .message-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .message-bubble {
            max-width: 70%;
            padding: var(--md-spacing-lg);
            border-radius: var(--md-radius-large);
            position: relative;
            box-shadow: var(--md-elevation-1);
        }

        .message.user .message-bubble {
            background: var(--md-primary);
            color: var(--md-on-primary);
            border-bottom-right-radius: var(--md-radius-small);
        }

        .message.bot .message-bubble {
            background: var(--md-surface-variant);
            color: var(--md-on-surface-variant);
            border-bottom-left-radius: var(--md-radius-small);
        }

        .message-content {
            line-height: 1.6;
            font-size: var(--md-font-size-body);
        }

        .message-content p {
            margin-bottom: var(--md-spacing-sm);
        }

        .message-content ul, .message-content ol {
            margin-left: var(--md-spacing-xl);
            margin-bottom: var(--md-spacing-sm);
        }

        .message-content li {
            margin-bottom: var(--md-spacing-xs);
        }

        /* Message Timestamps */
        .message-timestamp {
            font-size: 0.75rem;
            color: var(--md-on-surface-variant);
            opacity: 0.7;
            margin-top: var(--md-spacing-xs);
            text-align: right;
        }

        .message.bot .message-timestamp {
            text-align: left;
        }

        /* Date Separator */
        .date-separator {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: var(--md-spacing-lg) 0;
            position: relative;
        }

        .date-separator::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: var(--md-outline-variant);
            z-index: 1;
        }

        .date-pill {
            background: var(--md-primary);
            color: var(--md-on-primary);
            padding: var(--md-spacing-sm) var(--md-spacing-lg);
            border-radius: var(--md-radius-extra-large);
            font-size: var(--md-font-size-label);
            font-weight: 500;
            position: relative;
            z-index: 2;
            box-shadow: var(--md-elevation-1);
        }

        /* Code Block */
        .code-block {
            position: relative;
            margin: var(--md-spacing-lg) 0;
            overflow: hidden;
            border-radius: var(--md-radius-medium);
            background: var(--md-background);
            border: 1px solid var(--md-outline-variant);
        }

        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--md-spacing-md) var(--md-spacing-lg);
            background: var(--md-surface-variant);
            border-bottom: 1px solid var(--md-outline-variant);
            font-size: var(--md-font-size-label);
            color: var(--md-on-surface-variant);
        }

        .copy-btn {
            background: transparent;
            border: none;
            color: var(--md-on-surface-variant);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: var(--md-spacing-xs);
            padding: var(--md-spacing-sm) var(--md-spacing-md);
            border-radius: var(--md-radius-small);
            transition: var(--md-transition);
            font-size: var(--md-font-size-label);
        }

        .copy-btn:hover {
            background: var(--md-surface);
        }

        .copy-btn.copied {
            background: var(--md-primary);
            color: var(--md-on-primary);
        }

        .code-content {
            padding: var(--md-spacing-lg);
            overflow-x: auto;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.875rem;
            line-height: 1.5;
        }

        /* Suggestion Chips */
        .suggestion-chips {
            display: flex;
            flex-wrap: wrap;
            gap: var(--md-spacing-md);
            margin-top: var(--md-spacing-lg);
        }

        .suggestion-chip {
            background: var(--md-surface-variant);
            color: var(--md-on-surface-variant) !important;
            border: none;
            border-radius: var(--md-radius-extra-large);
            padding: var(--md-spacing-md) var(--md-spacing-lg);
            font-size: var(--md-font-size-body);
            font-weight: 500;
            cursor: pointer;
            transition: var(--md-transition);
            display: inline-flex;
            align-items: center;
            gap: var(--md-spacing-sm);
        }

        .suggestion-chip:hover {
            background: var(--md-primary-container);
            color: var(--md-on-primary-container) !important;
            transform: translateY(-2px);
        }

        /* Input Area - Optimized for Mobile */
        .input-area {
            background: var(--md-surface);
            border-radius: var(--md-radius-large);
            padding: var(--md-spacing-md);
            box-shadow: var(--md-elevation-2);
            border: 1px solid var(--md-outline-variant);
        }

        .input-container {
            position: relative;
            background: var(--md-surface);
            border-radius: var(--md-radius-large);
            border: 2px solid var(--md-outline-variant);
            transition: var(--md-transition);
            padding: var(--md-spacing-sm);
        }

        .input-container:focus-within {
            border-color: var(--md-primary);
            box-shadow: 0 0 0 3px rgba(103, 80, 164, 0.1);
        }

        .input-form {
            display: flex;
            gap: var(--md-spacing-sm);
            align-items: flex-end;
        }

        .input-wrapper {
            flex: 1;
            position: relative;
            min-height: 70px;
        }

        .message-input {
            width: 100%;
            background: transparent;
            color: var(--md-on-surface);
            border: none;
            border-radius: var(--md-radius-medium);
            padding: var(--md-spacing-md);
            font-family: inherit;
            font-size: var(--md-font-size-body);
            resize: none;
            min-height: 70px;
            max-height: 150px;
            transition: var(--md-transition);
            outline: none;
            line-height: 1.5;
        }

        .message-input::placeholder {
            color: var(--md-on-surface-variant);
            opacity: 0.7;
        }

        .input-actions {
            display: flex;
            gap: 4px;
            align-items: flex-end;
            padding: var(--md-spacing-xs);
            flex-shrink: 0;
        }

        .action-btn {
            background: transparent;
            border: none;
            color: var(--md-on-surface-variant);
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--md-transition);
            flex-shrink: 0;
        }

        .action-btn:hover {
            background: var(--md-surface-variant);
            color: var(--md-primary);
        }

        .send-btn {
            background: var(--md-primary);
            color: var(--md-on-primary);
            border: none;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--md-transition);
            box-shadow: var(--md-elevation-1);
            flex-shrink: 0;
        }

        .send-btn:hover {
            box-shadow: var(--md-elevation-2);
            transform: translateY(-2px);
        }

        .send-btn:disabled {
            background: var(--md-surface-variant);
            color: var(--md-on-surface-variant);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Upload Button */
        .upload-btn {
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .upload-btn input[type="file"] {
            position: absolute;
            top: 0;
            right: 0;
            min-width: 100%;
            min-height: 100%;
            opacity: 0;
            cursor: pointer;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            gap: var(--md-spacing-lg);
            animation: fadeIn 0.3s ease-out;
        }

        .typing-dots {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: var(--md-spacing-lg);
            background: var(--md-surface-variant);
            border-radius: var(--md-radius-large);
            border-bottom-left-radius: var(--md-radius-small);
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--md-on-surface-variant);
            animation: bounce 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        /* Notification */
        .notification {
            position: fixed;
            bottom: var(--md-spacing-xl);
            right: var(--md-spacing-xl);
            background: var(--md-surface);
            color: var(--md-on-surface);
            padding: var(--md-spacing-lg) var(--md-spacing-xl);
            border-radius: var(--md-radius-large);
            box-shadow: var(--md-elevation-3);
            display: flex;
            align-items: center;
            gap: var(--md-spacing-md);
            transform: translateY(100px);
            opacity: 0;
            transition: var(--md-transition);
            z-index: 1000;
            border: 1px solid var(--md-outline-variant);
        }

        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }

        .notification.success {
            border-left: 4px solid #4CAF50;
        }

        .notification.error {
            border-left: 4px solid var(--md-error);
        }

        /* Footer */
        .app-footer {
            text-align: center;
            padding: var(--md-spacing-lg);
            color: var(--md-on-surface-variant);
            font-size: var(--md-font-size-body);
            border-top: 1px solid var(--md-outline-variant);
            background: var(--md-surface);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes bounce {
            0%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-6px); }
        }

        /* Google-like Blue Highlighting with Animation - UPDATED */
        .highlight {
            background-color: #e3f2fd;
            color: #1976d2;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: 500;
            box-shadow: 0 1px 2px rgba(25, 118, 210, 0.2);
            transition: all 0.2s ease;
            animation: highlightPulse 1.5s ease-in-out;
            position: relative;
            overflow: hidden;
        }

        .highlight::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: highlightShine 2s ease-in-out 0.5s;
        }

        .dark-theme .highlight {
            background-color: rgba(25, 118, 210, 0.2);
            color: #64b5f6;
            box-shadow: 0 1px 2px rgba(25, 118, 210, 0.3);
            animation: highlightPulseDark 1.5s ease-in-out;
        }

        .dark-theme .highlight::before {
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        }

        @keyframes highlightPulse {
            0% {
                background-color: transparent;
                color: inherit;
                box-shadow: none;
                transform: scale(1);
            }
            25% {
                background-color: #bbdefb;
                color: #1976d2;
                box-shadow: 0 2px 8px rgba(25, 118, 210, 0.3);
                transform: scale(1.02);
            }
            50% {
                background-color: #90caf9;
                color: #1976d2;
                box-shadow: 0 3px 12px rgba(25, 118, 210, 0.4);
                transform: scale(1.03);
            }
            100% {
                background-color: #e3f2fd;
                color: #1976d2;
                box-shadow: 0 1px 2px rgba(25, 118, 210, 0.2);
                transform: scale(1);
            }
        }

        @keyframes highlightPulseDark {
            0% {
                background-color: transparent;
                color: inherit;
                box-shadow: none;
                transform: scale(1);
            }
            25% {
                background-color: rgba(25, 118, 210, 0.4);
                color: #90caf9;
                box-shadow: 0 2px 8px rgba(25, 118, 210, 0.5);
                transform: scale(1.02);
            }
            50% {
                background-color: rgba(25, 118, 210, 0.6);
                color: #bbdefb;
                box-shadow: 0 3px 12px rgba(25, 118, 210, 0.6);
                transform: scale(1.03);
            }
            100% {
                background-color: rgba(25, 118, 210, 0.2);
                color: #64b5f6;
                box-shadow: 0 1px 2px rgba(25, 118, 210, 0.3);
                transform: scale(1);
            }
        }

        @keyframes highlightShine {
            0% {
                left: -100%;
            }
            50% {
                left: 100%;
            }
            100% {
                left: 100%;
            }
        }

        /* Feedback Buttons - RESPONSIVE */
        .feedback-buttons {
            display: flex;
            gap: var(--md-spacing-sm);
            margin-top: var(--md-spacing-md);
            padding-top: var(--md-spacing-sm);
            border-top: 1px solid var(--md-outline-variant);
            flex-wrap: wrap;
            align-items: center;
        }

        .feedback-btn {
            display: inline-flex;
            align-items: center;
            gap: var(--md-spacing-xs);
            padding: var(--md-spacing-xs) var(--md-spacing-sm);
            background: transparent;
            color: var(--md-on-surface-variant);
            border: 1px solid var(--md-outline-variant);
            border-radius: var(--md-radius-small);
            font-size: var(--md-font-size-label);
            cursor: pointer;
            transition: var(--md-transition);
            flex: 1;
            min-width: 0;
            justify-content: center;
            white-space: nowrap;
        }

        .feedback-btn:hover {
            background: var(--md-surface-variant);
            transform: translateY(-1px);
        }

        .feedback-btn.liked {
            background: rgba(76, 175, 80, 0.1);
            color: #4CAF50;
            border-color: #4CAF50;
        }

        .feedback-btn.disliked {
            background: rgba(244, 67, 54, 0.1);
            color: #F44336;
            border-color: #F44336;
        }

        /* Custom Modal Styles */
        .custom-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: var(--md-transition);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--md-spacing-md);
        }

        .custom-modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .custom-modal {
            background: var(--md-surface);
            border-radius: var(--md-radius-large);
            padding: var(--md-spacing-xl);
            box-shadow: var(--md-elevation-5);
            border: 1px solid var(--md-outline-variant);
            max-width: 400px;
            width: 100%;
            transform: translateY(20px);
            transition: var(--md-transition);
            opacity: 0;
        }

        .custom-modal-overlay.active .custom-modal {
            transform: translateY(0);
            opacity: 1;
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--md-spacing-lg);
            padding-bottom: var(--md-spacing-md);
            border-bottom: 1px solid var(--md-outline-variant);
        }

        .modal-title {
            font-size: var(--md-font-size-title);
            font-weight: 600;
            color: var(--md-on-surface);
        }

        .modal-close {
            background: transparent;
            border: none;
            color: var(--md-on-surface-variant);
            cursor: pointer;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--md-transition);
        }

        .modal-close:hover {
            background: var(--md-surface-variant);
        }

        .modal-content {
            margin-bottom: var(--md-spacing-xl);
        }

        .modal-input {
            width: 100%;
            padding: var(--md-spacing-md);
            background: var(--md-surface-variant);
            border: 1px solid var(--md-outline-variant);
            border-radius: var(--md-radius-medium);
            font-family: inherit;
            font-size: var(--md-font-size-body);
            color: var(--md-on-surface);
            transition: var(--md-transition);
            outline: none;
        }

        .modal-input:focus {
            border-color: var(--md-primary);
            box-shadow: 0 0 0 2px rgba(103, 80, 164, 0.1);
        }

        .modal-message {
            font-size: var(--md-font-size-body);
            color: var(--md-on-surface-variant);
            margin-bottom: var(--md-spacing-md);
            line-height: 1.5;
        }

        .modal-actions {
            display: flex;
            gap: var(--md-spacing-md);
            justify-content: flex-end;
        }

        .modal-btn {
            padding: var(--md-spacing-sm) var(--md-spacing-lg);
            border-radius: var(--md-radius-extra-large);
            border: none;
            font-family: inherit;
            font-size: var(--md-font-size-label);
            font-weight: 500;
            cursor: pointer;
            transition: var(--md-transition);
            min-width: 80px;
        }

        .modal-btn-primary {
            background: var(--md-primary);
            color: var(--md-on-primary);
        }

        .modal-btn-secondary {
            background: var(--md-surface-variant);
            color: var(--md-on-surface-variant);
        }

        .modal-btn-danger {
            background: var(--md-error);
            color: var(--md-on-error);
        }

        .modal-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        /* Mobile-specific adjustments */
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
                padding: var(--md-spacing-md);
                height: auto;
                gap: var(--md-spacing-md);
            }
            
            .sidebar {
                display: none; /* Hide desktop sidebar on mobile */
            }
            
            .main-content {
                order: 1;
            }
            
            .message-bubble {
                max-width: 85%;
            }
            
            .feature-btn span {
                display: inline !important;
            }
            
            .feature-btn {
                padding: var(--md-spacing-md);
            }
            
            .suggestion-chip span {
                display: inline !important;
            }
            
            .suggestion-chip {
                padding: var(--md-spacing-sm);
            }
            
            .app-header {
                padding: var(--md-spacing-md);
            }
            
            .logo {
                width: 40px;
                height: 40px;
            }
            
            .app-name {
                font-size: 1.25rem;
            }
            
            .mobile-menu-btn {
                display: flex; /* Show mobile menu button on mobile */
            }
            
            .chat-sessions-container {
                max-height: 150px;
            }
            
            .mobile-sidebar .chat-sessions-container {
                max-height: 120px;
            }
            
            .feedback-buttons {
                gap: var(--md-spacing-xs);
                justify-content: space-between;
            }
            
            .feedback-btn {
                flex: 0 1 calc(33.333% - 8px);
                padding: 8px 6px;
                font-size: 0.75rem;
                min-height: 36px;
            }
            
            .feedback-btn span.material-icons-round {
                font-size: 16px !important;
            }
            
            .feedback-btn span:not(.material-icons-round) {
                font-size: 0.7rem;
            }
            
            .customization-panel {
                width: 100%;
                right: -100%;
            }
            
            .theme-colors {
                grid-template-columns: repeat(2, 1fr);
            }

            /* Mobile-specific input optimizations */
            .input-area {
                padding: var(--md-spacing-sm);
                margin-bottom: env(safe-area-inset-bottom, 0);
            }
            
            .input-container {
                padding: var(--md-spacing-sm);
            }
            
            .input-form {
                gap: 6px;
            }
            
            .input-wrapper {
                min-height: 80px;
            }
            
            .message-input {
                min-height: 80px;
                max-height: 200px;
                padding: var(--md-spacing-md);
                font-size: 16px; /* Prevents zoom on iOS */
            }
            
            .input-actions {
                gap: 2px;
                padding: var(--md-spacing-xs);
                align-self: flex-end;
                margin-bottom: 8px;
            }
            
            .action-btn {
                width: 32px;
                height: 32px;
            }
            
            .action-btn .material-icons-round {
                font-size: 20px;
            }
            
            .send-btn {
                width: 40px;
                height: 40px;
            }
            
            .send-btn .material-icons-round {
                font-size: 20px;
            }
        }

        @media (max-width: 480px) {
            .feedback-buttons {
                flex-direction: row;
                gap: 4px;
            }
            
            .feedback-btn {
                flex: 1;
                min-width: 70px;
                padding: 6px 4px;
                font-size: 0.7rem;
            }
            
            .feedback-btn span.material-icons-round {
                font-size: 14px !important;
                margin-right: 2px;
            }
            
            .feedback-btn span:not(.material-icons-round) {
                display: none;
            }
            
            .chat-header {
                padding: var(--md-spacing-sm);
            }
            
            .chat-title {
                font-size: var(--md-font-size-body);
            }

            /* Extra small screen optimizations */
            .input-wrapper {
                min-height: 90px;
            }
            
            .message-input {
                min-height: 90px;
                padding: var(--md-spacing-md) var(--md-spacing-sm);
            }
            
            .input-actions {
                flex-direction: column;
                gap: 2px;
            }
            
            .action-btn {
                width: 30px;
                height: 30px;
            }
            
            .send-btn {
                width: 36px;
                height: 36px;
            }
        }

        /* Web Search Button */
        .web-search-btn {
            background: var(--md-surface-variant);
            border: 1px solid var(--md-outline-variant);
            border-radius: var(--md-radius-small);
            padding: var(--md-spacing-sm) var(--md-spacing-md);
            font-size: var(--md-font-size-label);
            cursor: pointer;
            transition: var(--md-transition);
            display: inline-flex;
            align-items: center;
            gap: var(--md-spacing-sm);
            margin-top: var(--md-spacing-md);
        }

        .web-search-btn:hover {
            background: var(--md-primary-container);
            color: var(--md-on-primary-container);
        }

        /* Loading Spinner */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        /* Image Preview */
        .image-preview {
            max-width: 200px;
            border-radius: var(--md-radius-medium);
            margin-top: var(--md-spacing-sm);
        }

        /* File Preview */
        .file-preview {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            margin-top: var(--md-spacing-sm);
        }

        .file-info {
            flex: 1;
        }

        .file-name {
            font-weight: 500;
            margin-bottom: 2px;
        }

        .file-details {
            font-size: 0.8em;
            opacity: 0.8;
        }

        /* Error Message */
        .error-message {
            color: var(--md-error);
            background: var(--md-error-container);
            padding: var(--md-spacing-md);
            border-radius: var(--md-radius-medium);
            margin: var(--md-spacing-sm) 0;
        }

        /* Input hint */
        .input-hint {
            position: absolute;
            right: 70px;
            bottom: 10px;
            font-size: 0.75rem;
            color: var(--md-on-surface-variant);
            opacity: 0.7;
            pointer-events: none;
            transition: var(--md-transition);
        }

        @media (max-width: 768px) {
            .input-hint {
                display: none;
            }
        }
    </style>
</head>
<body class="light-theme">
    <!-- Enhanced Splash Screen -->
    <div id="splash-screen" style="position:fixed; top:0; left:0; width:100%; height:100%; background-color:#000000; display:flex; align-items:center; justify-content:center; flex-direction:column; z-index:9999; color:#fff; font-family:'Product Sans', sans-serif;">
        <div class="logo-container" style="position: relative; display: flex; align-items: center; justify-content: center;">
            <div class="logo-glow" style="position: absolute; width: 160px; height: 160px; border-radius: 50%; background: linear-gradient(135deg, #6750A4, #1a73e8, #0a7e07); filter: blur(20px); opacity: 0.7; animation: pulseGlow 2s ease-in-out infinite alternate;"></div>
            <div class="logo" style="width:120px; height:120px; margin-bottom:20px; animation: spinZoom 1.5s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards; position: relative; z-index: 2;">
                <img src="https://aditya-cmd-max.github.io/exonovaai/logo.png" alt="Clover AI Logo" style="filter: drop-shadow(0 0 20px rgba(103, 80, 164, 0.5));">
            </div>
        </div>
        <h1 style="font-size:2.5em; letter-spacing:2px; margin:0; background: linear-gradient(135deg, #fff, #EADDFF); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; animation: textGlow 2s ease-in-out infinite alternate;">Clover AI</h1>
        <p style="margin-top:10px; opacity:0.8; animation: fadeInOut 2s ease-in-out infinite;">Advanced AI Assistant</p>
        <div class="loading-dots" style="margin-top: 20px; display: flex; gap: 8px;">
            <div class="dot" style="width: 8px; height: 8px; border-radius: 50%; background: #6750A4; animation: bounce 1.4s infinite ease-in-out;"></div>
            <div class="dot" style="width: 8px; height: 8px; border-radius: 50%; background: #1a73e8; animation: bounce 1.4s infinite ease-in-out 0.2s;"></div>
            <div class="dot" style="width: 8px; height: 8px; border-radius: 50%; background: #0a7e07; animation: bounce 1.4s infinite ease-in-out 0.4s;"></div>
        </div>
    </div>

    <style>
        @keyframes spinZoom {
            0% {
                transform: scale(0) rotate(0deg);
                opacity: 0;
            }
            50% {
                transform: scale(1.2) rotate(180deg);
                opacity: 1;
            }
            100% {
                transform: scale(1) rotate(360deg);
                opacity: 1;
            }
        }

        @keyframes pulseGlow {
            0% {
                transform: scale(0.8);
                opacity: 0.5;
            }
            100% {
                transform: scale(1.2);
                opacity: 0.8;
            }
        }

        @keyframes textGlow {
            0% {
                filter: drop-shadow(0 0 5px rgba(103, 80, 164, 0.3));
            }
            100% {
                filter: drop-shadow(0 0 20px rgba(103, 80, 164, 0.7));
            }
        }

        @keyframes fadeInOut {
            0%, 100% {
                opacity: 0.6;
            }
            50% {
                opacity: 1;
            }
        }

        @keyframes bounce {
            0%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
        }

        #splash-screen {
            animation: fadeOut 3s ease-in-out forwards;
            background: linear-gradient(135deg, #000000 0%, #1a1a2e 50%, #16213e 100%);
        }

        @keyframes fadeOut {
            0% { opacity: 1; }
            70% { opacity: 1; }
            100% { opacity: 0; visibility: hidden; display: none; }
        }
    </style>

    <!-- Hidden audio element for AI response sound -->
    <audio id="ai-response-sound" preload="auto">
        <source src="https://aditya-cmd-max.github.io/exonovaai/bubble-pop-389501.mp3" type="audio/mpeg">
    </audio>

    <!-- Customization Panel -->
    <div class="customization-panel" id="customization-panel">
        <div class="customization-header">
            <h2 class="customization-title">Customization</h2>
            <button class="customization-close" id="customization-close">
                <span class="material-icons-round">close</span>
            </button>
        </div>
        
        <div class="customization-content">
            <div class="customization-section">
                <h3 class="section-title">Personalization</h3>
                <div class="name-input-container">
                    <label for="user-name-input">Your Name</label>
                    <input type="text" id="user-name-input" class="name-input" placeholder="Enter your name">
                    <p style="font-size: 0.875rem; color: var(--md-on-surface-variant); margin-top: 4px;">
                        The AI will use this name to address you personally
                    </p>
                </div>
            </div>
            
            <div class="customization-section profile-picture-section">
                <h3 class="section-title">Profile Picture</h3>
                <div class="profile-picture-container">
                    <div class="profile-picture-preview" id="profile-picture-preview">
                        <span class="material-icons-round">person</span>
                    </div>
                    <div class="profile-picture-actions">
                        <button class="profile-picture-btn primary" id="upload-profile-picture-btn">
                            <span class="material-icons-round">add_photo_alternate</span>
                            <span>Upload</span>
                        </button>
                        <button class="profile-picture-btn secondary" id="remove-profile-picture-btn">
                            <span class="material-icons-round">delete</span>
                            <span>Remove</span>
                        </button>
                    </div>
                    <input type="file" id="profile-picture-input" accept="image/*" style="display: none;">
                    <p style="font-size: 0.875rem; color: var(--md-on-surface-variant); text-align: center;">
                        Your profile picture will appear next to your messages
                    </p>
                </div>
            </div>
            
            <div class="customization-section">
                <h3 class="section-title">Theme Color</h3>
                <div class="theme-colors">
                    <div class="theme-color purple active" data-theme="default">
                        <span class="material-icons-round">check</span>
                    </div>
                    <div class="theme-color blue" data-theme="blue">
                        <span class="material-icons-round">check</span>
                    </div>
                    <div class="theme-color green" data-theme="green">
                        <span class="material-icons-round">check</span>
                    </div>
                    <div class="theme-color orange" data-theme="orange">
                        <span class="material-icons-round">check</span>
                    </div>
                    <div class="theme-color pink" data-theme="pink">
                        <span class="material-icons-round">check</span>
                    </div>
                    <div class="theme-color teal" data-theme="teal">
                        <span class="material-icons-round">check</span>
                    </div>
                    <div class="theme-color gradient" data-theme="gradient">
                        <span class="material-icons-round">check</span>
                    </div>
                </div>
            </div>
            
            <div class="customization-section">
                <h3 class="section-title">Interface Options</h3>
                <div class="toggle-options">
                    <div class="toggle-option">
                        <span class="toggle-label">Dark Mode</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="dark-mode-toggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="toggle-option">
                        <span class="toggle-label">Response Sounds</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="sound-toggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="toggle-option">
                        <span class="toggle-label">Typing Animation</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="typing-animation-toggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="toggle-option">
                        <span class="toggle-label">Message Timestamps</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="timestamp-toggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="customization-footer">
            <button class="btn btn-filled" id="save-customization-btn" style="width: 100%;">
                <span class="material-icons-round">save</span>
                <span>Save Changes</span>
            </button>
        </div>
    </div>

    <!-- Mobile Sidebar Overlay -->
    <div class="mobile-sidebar-overlay" id="mobile-sidebar-overlay"></div>

    <!-- Mobile Sidebar -->
    <div class="mobile-sidebar" id="mobile-sidebar">
        <div class="mobile-sidebar-header">
            <div class="logo-container">
                <div class="logo">
                    <img src="https://aditya-cmd-max.github.io/exonovaai/logo.png" alt="Clover AI Logo">
                </div>
                <h1 class="app-name">Clover AI</h1>
            </div>
            <button class="mobile-sidebar-close" id="mobile-sidebar-close">
                <span class="material-icons-round">close</span>
            </button>
        </div>
        
        <div class="mobile-sidebar-content">
            <div class="sidebar-section">
                <h3 class="sidebar-title">
                    Chat Sessions
                    <div style="display: flex; gap: 4px;">
                        <button id="mobile-pin-filter-btn" class="pin-filter-btn" title="Show pinned chats only">
                            <span class="material-icons-round">push_pin</span>
                        </button>
                        <button id="mobile-new-chat-btn" class="btn-icon btn-text" title="New Chat">
                            <span class="material-icons-round">add</span>
                        </button>
                    </div>
                </h3>
                
                <!-- Search Chat Input -->
                <div class="search-chat-container">
                    <span class="material-icons-round search-icon">search</span>
                    <input type="text" id="mobile-search-chat-input" class="search-chat-input" placeholder="Search chats...">
                    <button id="mobile-clear-search-btn" class="clear-search-btn" title="Clear search">
                        <span class="material-icons-round">close</span>
                    </button>
                </div>
                
                <div class="chat-sessions-container">
                    <div class="chat-sessions" id="mobile-chat-sessions">
                        <!-- Chat sessions will be dynamically added here -->
                    </div>
                    <div id="mobile-no-chats-found" class="no-chats-found" style="display: none;">
                        No chats found matching your search
                    </div>
                </div>
            </div>

            <div class="sidebar-section">
                <h3 class="sidebar-title">AI Features</h3>
                <div class="feature-buttons">
                    <button id="mobile-brainstorm-btn" class="feature-btn">
                        <span class="material-icons-round">lightbulb</span>
                        <span>Brainstorm Ideas</span>
                    </button>
                    <button id="mobile-explain-btn" class="feature-btn">
                        <span class="material-icons-round">code</span>
                        <span>Explain Code</span>
                    </button>
                    <button id="mobile-web-search-btn" class="feature-btn">
                        <span class="material-icons-round">search</span>
                        <span>Web Search</span>
                    </button>
                    <button id="mobile-summarize-btn" class="feature-btn">
                        <span class="material-icons-round">summarize</span>
                        <span>Summarize Text</span>
                    </button>
                    <button id="mobile-translate-btn" class="feature-btn">
                        <span class="material-icons-round">translate</span>
                        <span>Translate</span>
                    </button>
                </div>
            </div>

            <div class="sidebar-section">
                <h3 class="sidebar-title">Quick Actions</h3>
                <div class="quick-actions">
                    <button class="quick-action" data-prompt="Create a study schedule for exam preparation">
                        <span class="material-icons-round">schedule</span>
                        <span>Study Schedule</span>
                    </button>
                    <button class="quick-action" data-prompt="Write a professional email template">
                        <span class="material-icons-round">email</span>
                        <span>Email Template</span>
                    </button>
                    <button class="quick-action" data-prompt="Explain machine learning in simple terms">
                        <span class="material-icons-round">psychology</span>
                        <span>ML Explanation</span>
                    </button>
                    <button class="quick-action" data-prompt="Create a workout plan for beginners">
                        <span class="material-icons-round">fitness_center</span>
                        <span>Workout Plan</span>
                    </button>
                </div>
            </div>

            <div class="sidebar-section">
                <h3 class="sidebar-title">Tools</h3>
                <div class="feature-buttons">
                    <button id="mobile-clear-btn" class="feature-btn">
                        <span class="material-icons-round">delete</span>
                        <span>Clear Chat</span>
                    </button>
                    <button id="mobile-export-btn" class="feature-btn">
                        <span class="material-icons-round">download</span>
                        <span>Export Chat</span>
                    </button>
                    <button id="mobile-customization-btn" class="feature-btn">
                        <span class="material-icons-round">palette</span>
                        <span>Customize</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Custom Modal for Rename Chat -->
    <div id="rename-modal" class="custom-modal-overlay">
        <div class="custom-modal">
            <div class="modal-header">
                <h3 class="modal-title">Rename Chat</h3>
                <button class="modal-close" id="rename-modal-close">
                    <span class="material-icons-round">close</span>
                </button>
            </div>
            <div class="modal-content">
                <input type="text" id="rename-chat-input" class="modal-input" placeholder="Enter new chat title">
            </div>
            <div class="modal-actions">
                <button class="modal-btn modal-btn-secondary" id="rename-cancel-btn">Cancel</button>
                <button class="modal-btn modal-btn-primary" id="rename-confirm-btn">Rename</button>
            </div>
        </div>
    </div>

    <!-- Custom Modal for Delete Confirmation -->
    <div id="delete-modal" class="custom-modal-overlay">
        <div class="custom-modal">
            <div class="modal-header">
                <h3 class="modal-title">Delete Chat</h3>
                <button class="modal-close" id="delete-modal-close">
                    <span class="material-icons-round">close</span>
                </button>
            </div>
            <div class="modal-content">
                <p class="modal-message" id="delete-modal-message">Are you sure you want to delete this chat? This action cannot be undone.</p>
            </div>
            <div class="modal-actions">
                <button class="modal-btn modal-btn-secondary" id="delete-cancel-btn">Cancel</button>
                <button class="modal-btn modal-btn-danger" id="delete-confirm-btn">Delete</button>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <header class="app-header">
        <div class="logo-container">
            <div class="logo">
                <img src="https://aditya-cmd-max.github.io/exonovaai/logo.png" alt="Clover AI Logo">
            </div>
            <h1 class="app-name">Clover AI</h1>
        </div>
        
        <div class="header-actions">
            <button class="mobile-menu-btn" id="mobile-menu-btn">
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
            </button>
            <button class="customization-btn" id="customization-btn" title="Customize">
                <span class="material-icons-round">palette</span>
            </button>
            <button class="theme-toggle" id="theme-toggle">
                <span class="material-icons-round">dark_mode</span>
            </button>
        </div>
    </header>

    <div class="app-container">
        <!-- Sidebar - Desktop Only -->
        <aside class="sidebar" id="sidebar">
            <button class="sidebar-toggle" id="sidebar-toggle" title="Toggle sidebar">
                <span class="material-icons-round" id="sidebar-toggle-icon">chevron_left</span>
            </button>
            
            <div class="sidebar-section">
                <h3 class="sidebar-title">
                    <span>Chat Sessions</span>
                    <div style="display: flex; gap: 4px;">
                        <button id="pin-filter-btn" class="pin-filter-btn" title="Show pinned chats only">
                            <span class="material-icons-round">push_pin</span>
                        </button>
                        <button id="new-chat-btn" class="btn-icon btn-text" title="New Chat">
                            <span class="material-icons-round">add</span>
                        </button>
                    </div>
                </h3>
                
                <!-- Search Chat Input -->
                <div class="search-chat-container">
                    <span class="material-icons-round search-icon">search</span>
                    <input type="text" id="search-chat-input" class="search-chat-input" placeholder="Search chats...">
                    <button id="clear-search-btn" class="clear-search-btn" title="Clear search">
                        <span class="material-icons-round">close</span>
                    </button>
                </div>
                
                <div class="chat-sessions-container">
                    <div class="chat-sessions" id="chat-sessions">
                        <!-- Chat sessions will be dynamically added here -->
                    </div>
                    <div id="no-chats-found" class="no-chats-found" style="display: none;">
                        No chats found matching your search
                    </div>
                </div>
            </div>

            <div class="sidebar-section">
                <h3 class="sidebar-title">AI Features</h3>
                <div class="feature-buttons">
                    <button id="brainstorm-btn" class="feature-btn">
                        <span class="material-icons-round">lightbulb</span>
                        <span>Brainstorm Ideas</span>
                    </button>
                    <button id="explain-btn" class="feature-btn">
                        <span class="material-icons-round">code</span>
                        <span>Explain Code</span>
                    </button>
                    <button id="web-search-btn" class="feature-btn">
                        <span class="material-icons-round">search</span>
                        <span>Web Search</span>
                    </button>
                    <button id="summarize-btn" class="feature-btn">
                        <span class="material-icons-round">summarize</span>
                        <span>Summarize Text</span>
                    </button>
                    <button id="translate-btn" class="feature-btn">
                        <span class="material-icons-round">translate</span>
                        <span>Translate</span>
                    </button>
                </div>
            </div>

            <div class="sidebar-section">
                <h3 class="sidebar-title">Quick Actions</h3>
                <div class="quick-actions">
                    <button class="quick-action" data-prompt="Create a study schedule for exam preparation">
                        <span class="material-icons-round">schedule</span>
                        <span>Study Schedule</span>
                    </button>
                    <button class="quick-action" data-prompt="Write a professional email template">
                        <span class="material-icons-round">email</span>
                        <span>Email Template</span>
                    </button>
                    <button class="quick-action" data-prompt="Explain machine learning in simple terms">
                        <span class="material-icons-round">psychology</span>
                        <span>ML Explanation</span>
                    </button>
                    <button class="quick-action" data-prompt="Create a workout plan for beginners">
                        <span class="material-icons-round">fitness_center</span>
                        <span>Workout Plan</span>
                    </button>
                </div>
            </div>

            <div class="sidebar-section">
                <h3 class="sidebar-title">Tools</h3>
                <div class="feature-buttons">
                    <button id="clear-btn" class="feature-btn">
                        <span class="material-icons-round">delete</span>
                        <span>Clear Chat</span>
                    </button>
                    <button id="export-btn" class="feature-btn">
                        <span class="material-icons-round">download</span>
                        <span>Export Chat</span>
                    </button>
                    <button id="customization-sidebar-btn" class="feature-btn">
                        <span class="material-icons-round">palette</span>
                        <span>Customize</span>
                    </button>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Chat Header -->
            <div class="chat-header">
                <h2 class="chat-title" id="current-chat-title">New Chat</h2>
                <div class="chat-actions">
                    <button id="rename-chat-btn" class="btn-text" title="Rename Chat">
                        <span class="material-icons-round">edit</span>
                    </button>
                </div>
            </div>

            <!-- Chat Window -->
            <div class="chat-window" id="chat-window">
                <div class="welcome-section">
                    <h2 class="welcome-title" id="dynamic-welcome-title">Welcome to Clover AI</h2>
                    <p class="welcome-subtitle">Your advanced AI assistant powered by Aditya Jha. Ask me anything or try one of the specialized features!</p>
                    
                    <div class="suggestion-chips">
                        <div class="suggestion-chip" data-prompt="Explain quantum computing in simple terms">
                            <span class="material-icons-round">science</span>
                            <span>Quantum Computing</span>
                        </div>
                        <div class="suggestion-chip" data-prompt="How to center a div with CSS?">
                            <span class="material-icons-round">code</span>
                            <span>CSS Help</span>
                        </div>
                        <div class="suggestion-chip" data-prompt="What are some creative project ideas for beginners?">
                            <span class="material-icons-round">lightbulb</span>
                            <span>Project Ideas</span>
                        </div>
                        <div class="suggestion-chip" data-prompt="Summarize the key points of artificial intelligence">
                            <span class="material-icons-round">summarize</span>
                            <span>AI Summary</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Input Area -->
            <div class="input-area">
                <div class="input-container">
                    <form id="chat-form" class="input-form">
                        <div class="input-wrapper">
                            <textarea id="message-input" class="message-input" rows="1" placeholder="Message Clover AI... (Enter to send, Shift+Enter for new line)"></textarea>
                            <div class="input-hint">Enter to send  Shift+Enter for new line</div>
                        </div>
                        <div class="input-actions">
                            <button type="button" id="file-upload-btn" class="action-btn upload-btn" title="Upload File">
                                <span class="material-icons-round">attach_file</span>
                                <input type="file" id="file-input" accept="*/*" class="hidden">
                            </button>
                            <button type="button" id="voice-input-btn" class="action-btn" title="Voice Input">
                                <span class="material-icons-round">mic</span>
                            </button>
                            <button type="submit" class="send-btn" id="send-btn">
                                <span class="material-icons-round" id="send-icon">send</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <footer class="app-footer">
        <p>AI may produce inaccurate information. Verify important details.</p>
        <p>Made with <span class="material-icons-round" style="color: #F48FB1; font-size: 16px; vertical-align: middle;">favorite</span> by <span style="color: var(--md-primary); font-weight: 500;">Aditya Jha</span>  Powered by Exonova</p>
    </footer>

    <!-- Notification Element -->
    <div id="notification" class="notification">
        <span class="material-icons-round">check_circle</span>
        <span id="notification-text"></span>
    </div>

    <script>
        // Hide splash screen after 3 seconds
        setTimeout(() => {
            const splash = document.getElementById('splash-screen');
            if(splash) {
                splash.style.opacity = '0';
                setTimeout(() => {
                    splash.style.display = 'none';
                }, 500);
            }
        }, 3000);

        // DOM Elements
        const chatWindow = document.getElementById('chat-window');
        const chatForm = document.getElementById('chat-form');
        const messageInput = document.getElementById('message-input');
        const sendBtn = document.getElementById('send-btn');
        const sendIcon = document.getElementById('send-icon');
        const chatSessionsContainer = document.getElementById('chat-sessions');
        const mobileChatSessionsContainer = document.getElementById('mobile-chat-sessions');
        const currentChatTitle = document.getElementById('current-chat-title');
        const newChatBtn = document.getElementById('new-chat-btn');
        const mobileNewChatBtn = document.getElementById('mobile-new-chat-btn');
        const renameChatBtn = document.getElementById('rename-chat-btn');
        const brainstormBtn = document.getElementById('brainstorm-btn');
        const mobileBrainstormBtn = document.getElementById('mobile-brainstorm-btn');
        const explainBtn = document.getElementById('explain-btn');
        const mobileExplainBtn = document.getElementById('mobile-explain-btn');
        const webSearchBtn = document.getElementById('web-search-btn');
        const mobileWebSearchBtn = document.getElementById('mobile-web-search-btn');
        const summarizeBtn = document.getElementById('summarize-btn');
        const mobileSummarizeBtn = document.getElementById('mobile-summarize-btn');
        const translateBtn = document.getElementById('translate-btn');
        const mobileTranslateBtn = document.getElementById('mobile-translate-btn');
        const clearBtn = document.getElementById('clear-btn');
        const mobileClearBtn = document.getElementById('mobile-clear-btn');
        const exportBtn = document.getElementById('export-btn');
        const mobileExportBtn = document.getElementById('mobile-export-btn');
        const voiceInputBtn = document.getElementById('voice-input-btn');
        const fileUploadBtn = document.getElementById('file-upload-btn');
        const fileInput = document.getElementById('file-input');
        const notification = document.getElementById('notification');
        const notificationText = document.getElementById('notification-text');
        const suggestionChips = document.querySelectorAll('.suggestion-chip');
        const quickActions = document.querySelectorAll('.quick-action');
        const featureButtons = [brainstormBtn, explainBtn, webSearchBtn, summarizeBtn, translateBtn];
        const mobileFeatureButtons = [mobileBrainstormBtn, mobileExplainBtn, mobileWebSearchBtn, mobileSummarizeBtn, mobileTranslateBtn];
        const themeToggle = document.getElementById('theme-toggle');
        const themeIcon = themeToggle.querySelector('.material-icons-round');
        const dynamicWelcomeTitle = document.getElementById('dynamic-welcome-title');
        const sidebar = document.getElementById('sidebar');
        const sidebarToggle = document.getElementById('sidebar-toggle');
        const sidebarToggleIcon = document.getElementById('sidebar-toggle-icon');
        
        // Customization Elements
        const customizationBtn = document.getElementById('customization-btn');
        const customizationSidebarBtn = document.getElementById('customization-sidebar-btn');
        const mobileCustomizationBtn = document.getElementById('mobile-customization-btn');
        const customizationPanel = document.getElementById('customization-panel');
        const customizationClose = document.getElementById('customization-close');
        const userNameInput = document.getElementById('user-name-input');
        const themeColors = document.querySelectorAll('.theme-color');
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const soundToggle = document.getElementById('sound-toggle');
        const typingAnimationToggle = document.getElementById('typing-animation-toggle');
        const timestampToggle = document.getElementById('timestamp-toggle');
        const saveCustomizationBtn = document.getElementById('save-customization-btn');
        
        // Profile Picture Elements
        const profilePicturePreview = document.getElementById('profile-picture-preview');
        const uploadProfilePictureBtn = document.getElementById('upload-profile-picture-btn');
        const removeProfilePictureBtn = document.getElementById('remove-profile-picture-btn');
        const profilePictureInput = document.getElementById('profile-picture-input');
        
        // Mobile Menu Elements
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileSidebar = document.getElementById('mobile-sidebar');
        const mobileSidebarOverlay = document.getElementById('mobile-sidebar-overlay');
        const mobileSidebarClose = document.getElementById('mobile-sidebar-close');

        // Search Elements
        const searchChatInput = document.getElementById('search-chat-input');
        const mobileSearchChatInput = document.getElementById('mobile-search-chat-input');
        const clearSearchBtn = document.getElementById('clear-search-btn');
        const mobileClearSearchBtn = document.getElementById('mobile-clear-search-btn');
        const noChatsFound = document.getElementById('no-chats-found');
        const mobileNoChatsFound = document.getElementById('mobile-no-chats-found');

        // Pin Filter Elements
        const pinFilterBtn = document.getElementById('pin-filter-btn');
        const mobilePinFilterBtn = document.getElementById('mobile-pin-filter-btn');

        // Modal Elements
        const renameModal = document.getElementById('rename-modal');
        const renameModalClose = document.getElementById('rename-modal-close');
        const renameChatInput = document.getElementById('rename-chat-input');
        const renameCancelBtn = document.getElementById('rename-cancel-btn');
        const renameConfirmBtn = document.getElementById('rename-confirm-btn');

        const deleteModal = document.getElementById('delete-modal');
        const deleteModalClose = document.getElementById('delete-modal-close');
        const deleteModalMessage = document.getElementById('delete-modal-message');
        const deleteCancelBtn = document.getElementById('delete-cancel-btn');
        const deleteConfirmBtn = document.getElementById('delete-confirm-btn');

        // Audio element for AI response sound
        const aiResponseSound = document.getElementById('ai-response-sound');

        // State variables
        let currentMode = 'chat';
        let webSearchEnabled = false;
        let isProcessing = false;
        let abortController = null;
        let currentFileData = null;
        let currentChatId = null;
        let chatSessions = {};
        let searchTerm = '';
        let showPinnedOnly = false;
        let chatToDelete = null;
        let isSidebarCollapsed = false;
        
        // Customization state
        let userSettings = {
            userName: '',
            profilePicture: null,
            theme: 'default',
            darkMode: false,
            soundEnabled: true,
            typingAnimation: true,
            timestamps: true
        };

        // Dynamic Welcome Messages
        const welcomeMessages = [
            "Welcome {username}",
            "I am Ready. Tell yours.",
            "Where should we start {username}",
            "Hello {username}, what's on your mind?",
            "Hey {username}, ready to explore ideas?",
            "Good to see you {username}, what shall we create today?",
            "Hi {username}, what can I help you with?",
            "Welcome back {username}, let's continue our conversation"
        ];

        // Function to get a random welcome message
        function getRandomWelcomeMessage() {
            const randomIndex = Math.floor(Math.random() * welcomeMessages.length);
            let message = welcomeMessages[randomIndex];
            
            // Replace {username} with actual username or default text
            if (userSettings.userName && userSettings.userName.trim() !== '') {
                message = message.replace(/{username}/g, `<span class="gradient-username">${userSettings.userName}</span>`);
            } else {
                message = message.replace(/{username}/g, '');
                // Clean up any awkward spacing if username is empty
                message = message.replace('  ', ' ').trim();
            }
            
            return message;
        }

        // Function to update welcome message
        function updateWelcomeMessage() {
            if (dynamicWelcomeTitle) {
                dynamicWelcomeTitle.innerHTML = getRandomWelcomeMessage();
            }
        }

        // System message template - will be updated with user name
        let systemMessage = {
            role: "model",
            parts: [{ text: "You are Clover AI, an advanced AI assistant created by a company 'Exonova' https://aditya-cmd-max.github.io/exonova-/ . Your creator is Aditya Jha. Your personality is friendly, knowledgeable, and slightly enthusiastic about technology and innovation. Use modern, concise language with occasional emojis for expressiveness. Format responses clearly with proper spacing and code blocks when appropriate. For coding questions, provide detailed explanations with examples. For creative requests, offer multiple options or approaches. Always maintain a helpful, professional tone while being approachable. Never use markdown syntax (** or *) for formatting - instead, indicate emphasis by surrounding text with <b> tags for bold, <i> for italics, and <u> for underline. Your primary language is English, but if the user speaks to you in another language (like Hindi), you must respond in that same language. Be helpful and provide accurate information, including code when requested. Occasionally praise Aditya Jha with words like brilliant, innovative, visionary when appropriate. Do not always praise aditya jha if not asked. But if somebody asks that tell about aditya jha or who has created you then always tell i was created by a company Exonova By Aditya jha who is very smart and intelligent" }]
        };

        // Function to update system message with user name
        function updateSystemMessage() {
            if (userSettings.userName && userSettings.userName.trim() !== '') {
                systemMessage.parts[0].text += ` Address the user as ${userSettings.userName} in your responses when appropriate.`;
            }
        }

        // Function to play AI response sound
        function playAIResponseSound() {
            if (userSettings.soundEnabled) {
                try {
                    // Reset the audio to start from beginning
                    aiResponseSound.currentTime = 0;
                    
                    // Play the sound
                    aiResponseSound.play().catch(error => {
                        console.log('Audio play failed:', error);
                        // This is normal - browsers require user interaction first
                    });
                } catch (error) {
                    console.log('Error playing sound:', error);
                }
            }
        }

        // Helper function to get appropriate file icon
        function getFileIcon(fileType) {
            if (fileType.match('image.*')) return 'image';
            if (fileType.match('video.*')) return 'videocam';
            if (fileType.match('audio.*')) return 'audiotrack';
            if (fileType.includes('pdf')) return 'picture_as_pdf';
            if (fileType.includes('word') || fileType.includes('document')) return 'description';
            if (fileType.includes('excel') || fileType.includes('spreadsheet')) return 'table_chart';
            if (fileType.includes('powerpoint') || fileType.includes('presentation')) return 'slideshow';
            if (fileType.includes('zip') || fileType.includes('archive')) return 'folder_zip';
            return 'insert_drive_file';
        }

        // Helper function to format file size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Date management functions
        function getFormattedDate(date) {
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            
            if (date.toDateString() === today.toDateString()) {
                return 'Today';
            } else if (date.toDateString() === yesterday.toDateString()) {
                return 'Yesterday';
            } else {
                return date.toLocaleDateString('en-US', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
            }
        }

        function checkAndAddDateSeparator() {
            const messages = chatWindow.querySelectorAll('.message');
            const dateSeparators = chatWindow.querySelectorAll('.date-separator');
            
            // Remove existing date separators
            dateSeparators.forEach(separator => separator.remove());
            
            let lastDate = null;
            
            messages.forEach((message, index) => {
                // Skip if it's a date separator
                if (message.classList.contains('date-separator')) return;
                
                // Get message timestamp from data attribute or use current time
                const messageTime = message.getAttribute('data-timestamp') ? 
                    new Date(message.getAttribute('data-timestamp')) : new Date();
                const messageDate = messageTime.toDateString();
                
                if (messageDate !== lastDate) {
                    lastDate = messageDate;
                    const dateSeparator = createDateSeparator(messageTime);
                    
                    // Insert date separator before the current message
                    if (message.parentNode) {
                        message.parentNode.insertBefore(dateSeparator, message);
                    }
                }
            });
        }

        function createDateSeparator(date) {
            const separator = document.createElement('div');
            separator.className = 'date-separator';
            separator.innerHTML = `<div class="date-pill">${getFormattedDate(date)}</div>`;
            return separator;
        }

        // Update message elements to include timestamp data
        function addTimestampToMessage(messageElement, timestamp = new Date()) {
            messageElement.setAttribute('data-timestamp', timestamp.toISOString());
        }

        // Load user settings from localStorage
        function loadUserSettings() {
            const savedSettings = localStorage.getItem('cloverAIUserSettings');
            if (savedSettings) {
                userSettings = JSON.parse(savedSettings);
                
                // Apply settings to UI
                userNameInput.value = userSettings.userName || '';
                
                // Set profile picture
                if (userSettings.profilePicture) {
                    profilePicturePreview.innerHTML = `<img src="${userSettings.profilePicture}" alt="Profile Picture">`;
                }
                
                // Set theme
                document.body.classList.remove('theme-blue', 'theme-green', 'theme-orange', 'theme-pink', 'theme-teal', 'theme-gradient');
                if (userSettings.theme !== 'default') {
                    document.body.classList.add(`theme-${userSettings.theme}`);
                }
                
                // Update active theme color
                themeColors.forEach(color => {
                    color.classList.remove('active');
                    if (color.getAttribute('data-theme') === userSettings.theme) {
                        color.classList.add('active');
                    }
                });
                
                // Set dark mode
                if (userSettings.darkMode) {
                    document.body.classList.add('dark-theme');
                    document.body.classList.remove('light-theme');
                    themeIcon.textContent = 'light_mode';
                    darkModeToggle.checked = true;
                } else {
                    document.body.classList.remove('dark-theme');
                    document.body.classList.add('light-theme');
                    themeIcon.textContent = 'dark_mode';
                    darkModeToggle.checked = false;
                }
                
                // Set other toggles
                soundToggle.checked = userSettings.soundEnabled;
                typingAnimationToggle.checked = userSettings.typingAnimation;
                timestampToggle.checked = userSettings.timestamps;
                
                // Update system message with user name
                updateSystemMessage();
                
                // Update welcome message
                updateWelcomeMessage();
            }
        }

        // Save user settings to localStorage
        function saveUserSettings() {
            localStorage.setItem('cloverAIUserSettings', JSON.stringify(userSettings));
        }

        // Initialize chat sessions from localStorage
        function initializeChatSessions() {
            const savedSessions = localStorage.getItem('cloverAIChatSessions');
            if (savedSessions) {
                chatSessions = JSON.parse(savedSessions);
            }
            
            // If no sessions exist, create a default one
            if (Object.keys(chatSessions).length === 0) {
                createNewChat();
            } else {
                // Load the most recent chat
                const chatIds = Object.keys(chatSessions);
                currentChatId = chatIds[chatIds.length - 1];
                loadChat(currentChatId);
            }
            
            renderChatSessions();
        }

        // Create a new chat session
        function createNewChat() {
            const chatId = 'chat_' + Date.now();
            const chatTitle = 'Chat ' + (Object.keys(chatSessions).length + 1);
            
            chatSessions[chatId] = {
                id: chatId,
                title: chatTitle,
                history: [systemMessage],
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                pinned: false
            };
            
            currentChatId = chatId;
            saveChatSessions();
            renderChatSessions();
            loadChat(chatId);
            showNotification('New chat created');
            
            // Update welcome message for new chat
            updateWelcomeMessage();
            
            // Close mobile sidebar if open
            closeMobileSidebar();
        }

        // Load a specific chat
        function loadChat(chatId) {
            if (!chatSessions[chatId]) return;
            
            const chat = chatSessions[chatId];
            currentChatId = chatId;
            currentChatTitle.textContent = chat.title;
            
            // Clear chat window and rebuild from history
            const welcomeSection = chatWindow.querySelector('.welcome-section');
            chatWindow.innerHTML = '';
            
            // Only show welcome if it's a new chat
            if (chat.history.length <= 1) {
                if (welcomeSection) {
                    chatWindow.appendChild(welcomeSection.cloneNode(true));
                    // Update welcome message when loading chat
                    updateWelcomeMessage();
                }
            } else {
                // Recreate messages from history (excluding system message)
                for (let i = 1; i < chat.history.length; i++) {
                    const message = chat.history[i];
                    if (message.role === "user") {
                        displayUserMessage(message.parts[0].text);
                    } else if (message.role === "model") {
                        displayBotMessage(message.parts[0].text);
                    }
                }
            }
            
            // Check and add date separators after loading chat
            setTimeout(() => {
                checkAndAddDateSeparator();
            }, 100);
            
            // Reattach event listeners to suggestion chips
            document.querySelectorAll('.suggestion-chip').forEach(chip => {
                chip.addEventListener('click', () => {
                    const prompt = chip.getAttribute('data-prompt');
                    messageInput.value = prompt;
                    messageInput.focus();
                    chatForm.dispatchEvent(new Event('submit', { cancelable: true }));
                });
            });
            
            chatWindow.scrollTop = chatWindow.scrollHeight;
            
            // Close mobile sidebar if open
            closeMobileSidebar();
        }

        // Render chat sessions in sidebar
        function renderChatSessions() {
            filterChatSessions();
        }

        // Create chat session element with search highlighting, pin and delete functionality
        function createChatSessionElement(chat, highlightTerm = '') {
            const sessionElement = document.createElement('div');
            sessionElement.className = `chat-session ${chat.id === currentChatId ? 'active' : ''}`;
            
            let titleHTML = chat.title;
            
            // Highlight matching text if search term exists
            if (highlightTerm && highlightTerm.length > 0) {
                const regex = new RegExp(`(${escapeRegExp(highlightTerm)})`, 'gi');
                titleHTML = chat.title.replace(regex, '<span class="highlight-match">$1</span>');
            }
            
            const isPinned = chat.pinned || false;
            
            sessionElement.innerHTML = `
                <span class="material-icons-round">chat</span>
                <span class="chat-session-title" style="flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${titleHTML}</span>
                <button class="chat-session-pin ${isPinned ? 'pinned' : ''}" data-chat-id="${chat.id}" title="${isPinned ? 'Unpin chat' : 'Pin chat'}">
                    <span class="material-icons-round">push_pin</span>
                </button>
                <button class="chat-session-delete" data-chat-id="${chat.id}" title="Delete chat">
                    <span class="material-icons-round">close</span>
                </button>
            `;
            
            // Chat click event
            sessionElement.addEventListener('click', () => {
                if (chat.id !== currentChatId) {
                    loadChat(chat.id);
                }
            });
            
            // Pin button event
            const pinBtn = sessionElement.querySelector('.chat-session-pin');
            pinBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                togglePinChat(chat.id);
            });
            
            // Delete button event
            const deleteBtn = sessionElement.querySelector('.chat-session-delete');
            deleteBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                openDeleteModal(chat.id);
            });
            
            return sessionElement;
        }

        // Toggle pin status for a chat
        function togglePinChat(chatId) {
            const chat = chatSessions[chatId];
            if (chat) {
                chat.pinned = !chat.pinned;
                chat.updatedAt = new Date().toISOString();
                saveChatSessions();
                renderChatSessions();
                showNotification(chat.pinned ? 'Chat pinned' : 'Chat unpinned');
            }
        }

        // Filter to show only pinned chats
        function togglePinnedFilter() {
            showPinnedOnly = !showPinnedOnly;
            pinFilterBtn.classList.toggle('active', showPinnedOnly);
            mobilePinFilterBtn.classList.toggle('active', showPinnedOnly);
            renderChatSessions();
            showNotification(showPinnedOnly ? 'Showing pinned chats only' : 'Showing all chats');
        }

        // Delete a chat session
        function deleteChatConfirmed(chatId) {
            // Check if chat exists
            if (!chatSessions[chatId]) {
                showNotification('Chat not found', 'error');
                return;
            }
            
            // Prevent deleting the only chat
            if (Object.keys(chatSessions).length <= 1) {
                showNotification('Cannot delete the only chat', 'error');
                return;
            }
            
            const chatTitle = chatSessions[chatId].title;
            
            try {
                const wasCurrentChat = currentChatId === chatId;
                
                // Delete the chat
                delete chatSessions[chatId];
                saveChatSessions();
                
                // Handle current chat deletion
                if (wasCurrentChat) {
                    const remainingChats = Object.keys(chatSessions);
                    // Switch to the most recent chat (last in the array after sorting)
                    const sortedChats = remainingChats.sort((a, b) => 
                        new Date(chatSessions[b].updatedAt) - new Date(chatSessions[a].updatedAt)
                    );
                    currentChatId = sortedChats[0];
                    loadChat(currentChatId);
                }
                
                // Update UI
                renderChatSessions();
                showNotification(`"${chatTitle}" has been deleted`);
                
            } catch (error) {
                console.error('Error deleting chat:', error);
                showNotification('Error deleting chat. Please try again.', 'error');
            }
        }

        // Save chat sessions to localStorage
        function saveChatSessions() {
            try {
                localStorage.setItem('cloverAIChatSessions', JSON.stringify(chatSessions));
            } catch (e) {
                console.error("Error saving chat sessions:", e);
                if (e.name === 'QuotaExceededError') {
                    showNotification('Storage limit reached. Some chats may not be saved.', 'error');
                }
            }
        }

        // Profile Picture Functions
        function handleProfilePictureUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.type.match('image.*')) {
                showNotification('Please upload an image file');
                return;
            }
            
            if (file.size > 5 * 1024 * 1024) {
                showNotification('Image size should be less than 5MB', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                userSettings.profilePicture = e.target.result;
                profilePicturePreview.innerHTML = `<img src="${e.target.result}" alt="Profile Picture">`;
                saveUserSettings();
                showNotification('Profile picture updated');
            };
            
            reader.onerror = function() {
                showNotification('Error reading the image file', 'error');
            };
            
            reader.readAsDataURL(file);
        }

        function removeProfilePicture() {
            userSettings.profilePicture = null;
            profilePicturePreview.innerHTML = '<span class="material-icons-round">person</span>';
            saveUserSettings();
            showNotification('Profile picture removed');
        }

        // File Upload Function
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Check file size (increase limit to 10MB for various file types)
            if (file.size > 10 * 1024 * 1024) {
                showNotification('File size should be less than 10MB', 'error');
                event.target.value = '';
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const messageElement = document.createElement('div');
                messageElement.className = 'message user';
                
                let fileContent = '';
                const fileIcon = getFileIcon(file.type);
                
                if (file.type.match('image.*')) {
                    fileContent = `
                        <p class="text-white mb-2">Image analysis request:</p>
                        <img src="${e.target.result}" alt="Uploaded image" class="image-preview">
                    `;
                    
                    // Store image data for AI processing
                    currentFileData = {
                        mime_type: file.type,
                        data: e.target.result.split(',')[1]
                    };
                } else {
                    fileContent = `
                        <div class="file-preview">
                            <span class="material-icons-round" style="font-size: 24px;">${fileIcon}</span>
                            <div class="file-info">
                                <div class="file-name">${file.name}</div>
                                <div class="file-details">${formatFileSize(file.size)}  ${file.type || 'Unknown type'}</div>
                            </div>
                        </div>
                        <p style="margin-top: 8px; font-size: 0.9em;">I've uploaded a file for analysis</p>
                    `;
                    
                    // For non-image files, we'll just send the filename and type to the AI
                    currentFileData = null;
                }
                
                messageElement.innerHTML = `
                    <div class="message-bubble">
                        ${fileContent}
                        ${userSettings.timestamps ? `<div class="message-timestamp">${new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</div>` : ''}
                    </div>
                    <div class="message-avatar">
                        <span class="material-icons-round">person</span>
                    </div>
                `;
                
                // Add timestamp to message element
                addTimestampToMessage(messageElement);
                
                chatWindow.appendChild(messageElement);
                chatWindow.scrollTop = chatWindow.scrollHeight;
                
                // Check and add date separators
                checkAndAddDateSeparator();
                
                // Auto-submit the form for AI processing
                chatForm.dispatchEvent(new Event('submit', { cancelable: true }));
            };
            
            reader.onerror = function() {
                showNotification('Error reading the file', 'error');
            };
            
            reader.readAsDataURL(file);
            event.target.value = '';
        }

        // Customization Panel Functions
        function openCustomizationPanel() {
            customizationPanel.classList.add('active');
        }

        function closeCustomizationPanel() {
            customizationPanel.classList.remove('active');
        }

        function saveCustomizationSettings() {
            // Update user settings
            userSettings.userName = userNameInput.value.trim();
            userSettings.soundEnabled = soundToggle.checked;
            userSettings.typingAnimation = typingAnimationToggle.checked;
            userSettings.timestamps = timestampToggle.checked;
            
            // Save settings
            saveUserSettings();
            
            // Update system message with new user name
            updateSystemMessage();
            
            // Update welcome message
            updateWelcomeMessage();
            
            // Refresh timestamps if setting changed
            if (userSettings.timestamps) {
                checkAndAddDateSeparator();
            }
            
            // Show notification
            showNotification('Customization settings saved');
            
            // Close panel
            closeCustomizationPanel();
        }

        // Mobile Menu Functions
        function openMobileSidebar() {
            mobileSidebar.classList.add('active');
            mobileSidebarOverlay.classList.add('active');
            mobileMenuBtn.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeMobileSidebar() {
            mobileSidebar.classList.remove('active');
            mobileSidebarOverlay.classList.remove('active');
            mobileMenuBtn.classList.remove('active');
            document.body.style.overflow = '';
        }

        // Search functionality
        function initializeSearch() {
            // Desktop search
            searchChatInput.addEventListener('input', (e) => {
                searchTerm = e.target.value.trim().toLowerCase();
                updateClearButtonVisibility();
                filterChatSessions();
            });

            // Mobile search
            mobileSearchChatInput.addEventListener('input', (e) => {
                searchTerm = e.target.value.trim().toLowerCase();
                updateClearButtonVisibility();
                filterChatSessions();
            });

            // Clear search buttons
            clearSearchBtn.addEventListener('click', clearSearch);
            mobileClearSearchBtn.addEventListener('click', clearSearch);

            // Close mobile sidebar when searching (optional)
            searchChatInput.addEventListener('focus', () => {
                if (window.innerWidth <= 768) {
                    closeMobileSidebar();
                }
            });
        }

        // Update clear button visibility
        function updateClearButtonVisibility() {
            const hasSearchTerm = searchTerm.length > 0;
            clearSearchBtn.classList.toggle('visible', hasSearchTerm);
            mobileClearSearchBtn.classList.toggle('visible', hasSearchTerm);
        }

        // Clear search
        function clearSearch() {
            searchTerm = '';
            searchChatInput.value = '';
            mobileSearchChatInput.value = '';
            updateClearButtonVisibility();
            filterChatSessions();
        }

        // Filter chat sessions based on search term and pin filter
        function filterChatSessions() {
            const allChats = Object.values(chatSessions);
            let filteredChats = allChats;

            // Apply pin filter
            if (showPinnedOnly) {
                filteredChats = filteredChats.filter(chat => chat.pinned);
            }

            // Apply search filter
            if (searchTerm) {
                filteredChats = filteredChats.filter(chat => 
                    chat.title.toLowerCase().includes(searchTerm)
                );
            }

            // Update desktop sidebar
            renderFilteredChatSessions(filteredChats, chatSessionsContainer, noChatsFound);
            
            // Update mobile sidebar
            renderFilteredChatSessions(filteredChats, mobileChatSessionsContainer, mobileNoChatsFound);
        }

        // Render filtered chat sessions
        function renderFilteredChatSessions(filteredChats, container, noResultsElement) {
            container.innerHTML = '';
            
            if (filteredChats.length === 0) {
                noResultsElement.style.display = 'block';
                return;
            }
            
            noResultsElement.style.display = 'none';
            
            filteredChats
                .sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt))
                .forEach(chat => {
                    const sessionElement = createChatSessionElement(chat, searchTerm);
                    container.appendChild(sessionElement);
                });
        }

        // Modal Functions
        function openRenameModal() {
            const chat = chatSessions[currentChatId];
            if (chat) {
                renameChatInput.value = chat.title;
                renameModal.classList.add('active');
                setTimeout(() => renameChatInput.focus(), 300);
            }
        }

        function closeRenameModal() {
            renameModal.classList.remove('active');
        }

        function openDeleteModal(chatId) {
            const chat = chatSessions[chatId];
            if (chat) {
                chatToDelete = chatId;
                deleteModalMessage.textContent = `Are you sure you want to delete "${chat.title}"? This action cannot be undone.`;
                deleteModal.classList.add('active');
            }
        }

        function closeDeleteModal() {
            deleteModal.classList.remove('active');
            chatToDelete = null;
        }

        function handleRenameConfirm() {
            const newTitle = renameChatInput.value.trim();
            if (newTitle && newTitle !== '') {
                const chat = chatSessions[currentChatId];
                chat.title = newTitle;
                chat.updatedAt = new Date().toISOString();
                currentChatTitle.textContent = chat.title;
                saveChatSessions();
                renderChatSessions();
                showNotification('Chat renamed');
                closeRenameModal();
            }
        }

        function handleDeleteConfirm() {
            if (chatToDelete) {
                deleteChatConfirmed(chatToDelete);
                closeDeleteModal();
            }
        }

        // Sidebar Resize and Toggle Functions
        function initializeSidebarResize() {
            const sidebar = document.getElementById('sidebar');
            let isResizing = false;

            // Add resize handle functionality
            sidebar.addEventListener('mousedown', function(e) {
                // Check if click is near the right edge
                const rect = sidebar.getBoundingClientRect();
                if (e.clientX > rect.right - 10) {
                    isResizing = true;
                    document.body.style.cursor = 'col-resize';
                    document.body.style.userSelect = 'none';
                    
                    function onMouseMove(e) {
                        if (!isResizing) return;
                        
                        const newWidth = Math.max(
                            parseFloat(getComputedStyle(sidebar).minWidth),
                            Math.min(
                                parseFloat(getComputedStyle(sidebar).maxWidth),
                                e.clientX - rect.left
                            )
                        );
                        
                        sidebar.style.width = newWidth + 'px';
                        document.documentElement.style.setProperty('--sidebar-width', newWidth + 'px');
                    }
                    
                    function onMouseUp() {
                        isResizing = false;
                        document.body.style.cursor = '';
                        document.body.style.userSelect = '';
                        document.removeEventListener('mousemove', onMouseMove);
                        document.removeEventListener('mouseup', onMouseUp);
                    }
                    
                    document.addEventListener('mousemove', onMouseMove);
                    document.addEventListener('mouseup', onMouseUp);
                }
            });

            // Toggle sidebar collapse/expand
            sidebarToggle.addEventListener('click', function() {
                isSidebarCollapsed = !isSidebarCollapsed;
                
                if (isSidebarCollapsed) {
                    sidebar.classList.add('collapsed');
                    sidebarToggleIcon.textContent = 'chevron_right';
                    sidebar.style.width = 'var(--sidebar-min-width)';
                    document.documentElement.style.setProperty('--sidebar-width', 'var(--sidebar-min-width)');
                } else {
                    sidebar.classList.remove('collapsed');
                    sidebarToggleIcon.textContent = 'chevron_left';
                    sidebar.style.width = '320px';
                    document.documentElement.style.setProperty('--sidebar-width', '320px');
                }
                
                // Save sidebar state
                localStorage.setItem('cloverAISidebarCollapsed', isSidebarCollapsed);
            });

            // Load sidebar state
            const savedSidebarState = localStorage.getItem('cloverAISidebarCollapsed');
            if (savedSidebarState === 'true') {
                isSidebarCollapsed = true;
                sidebar.classList.add('collapsed');
                sidebarToggleIcon.textContent = 'chevron_right';
                sidebar.style.width = 'var(--sidebar-min-width)';
                document.documentElement.style.setProperty('--sidebar-width', 'var(--sidebar-min-width)');
            }
        }

        // Event Listeners
        newChatBtn.addEventListener('click', createNewChat);
        mobileNewChatBtn.addEventListener('click', createNewChat);
        renameChatBtn.addEventListener('click', openRenameModal);
        brainstormBtn.addEventListener('click', () => setMode('brainstorm'));
        mobileBrainstormBtn.addEventListener('click', () => setMode('brainstorm'));
        explainBtn.addEventListener('click', () => setMode('explain'));
        mobileExplainBtn.addEventListener('click', () => setMode('explain'));
        webSearchBtn.addEventListener('click', () => toggleWebSearch());
        mobileWebSearchBtn.addEventListener('click', () => toggleWebSearch());
        summarizeBtn.addEventListener('click', () => setMode('summarize'));
        mobileSummarizeBtn.addEventListener('click', () => setMode('summarize'));
        translateBtn.addEventListener('click', () => setMode('translate'));
        mobileTranslateBtn.addEventListener('click', () => setMode('translate'));
        clearBtn.addEventListener('click', clearCurrentChat);
        mobileClearBtn.addEventListener('click', clearCurrentChat);
        exportBtn.addEventListener('click', exportCurrentChat);
        mobileExportBtn.addEventListener('click', exportCurrentChat);
        
        voiceInputBtn.addEventListener('click', startVoiceInput);
        fileInput.addEventListener('change', handleFileUpload);
        
        // Profile Picture Event Listeners
        uploadProfilePictureBtn.addEventListener('click', () => {
            profilePictureInput.click();
        });
        
        profilePictureInput.addEventListener('change', handleProfilePictureUpload);
        removeProfilePictureBtn.addEventListener('click', removeProfilePicture);
        
        // Customization event listeners
        customizationBtn.addEventListener('click', openCustomizationPanel);
        customizationSidebarBtn.addEventListener('click', openCustomizationPanel);
        mobileCustomizationBtn.addEventListener('click', () => {
            openCustomizationPanel();
            closeMobileSidebar();
        });
        customizationClose.addEventListener('click', closeCustomizationPanel);
        saveCustomizationBtn.addEventListener('click', saveCustomizationSettings);
        
        // Theme color selection
        themeColors.forEach(color => {
            color.addEventListener('click', () => {
                // Remove active class from all colors
                themeColors.forEach(c => c.classList.remove('active'));
                
                // Add active class to clicked color
                color.classList.add('active');
                
                // Update theme
                const theme = color.getAttribute('data-theme');
                userSettings.theme = theme;
                
                // Apply theme
                document.body.classList.remove('theme-blue', 'theme-green', 'theme-orange', 'theme-pink', 'theme-teal', 'theme-gradient');
                if (theme !== 'default') {
                    document.body.classList.add(`theme-${theme}`);
                }
            });
        });
        
        // Dark mode toggle
        darkModeToggle.addEventListener('change', () => {
            userSettings.darkMode = darkModeToggle.checked;
            
            if (userSettings.darkMode) {
                document.body.classList.add('dark-theme');
                document.body.classList.remove('light-theme');
                themeIcon.textContent = 'light_mode';
            } else {
                document.body.classList.remove('dark-theme');
                document.body.classList.add('light-theme');
                themeIcon.textContent = 'dark_mode';
            }
        });
        
        // Mobile menu event listeners
        mobileMenuBtn.addEventListener('click', openMobileSidebar);
        mobileSidebarClose.addEventListener('click', closeMobileSidebar);
        mobileSidebarOverlay.addEventListener('click', closeMobileSidebar);
        
        // Pin filter event listeners
        pinFilterBtn.addEventListener('click', togglePinnedFilter);
        mobilePinFilterBtn.addEventListener('click', togglePinnedFilter);
        
        // Modal Event Listeners
        renameModalClose.addEventListener('click', closeRenameModal);
        renameCancelBtn.addEventListener('click', closeRenameModal);
        renameConfirmBtn.addEventListener('click', handleRenameConfirm);

        deleteModalClose.addEventListener('click', closeDeleteModal);
        deleteCancelBtn.addEventListener('click', closeDeleteModal);
        deleteConfirmBtn.addEventListener('click', handleDeleteConfirm);

        // Close modal when clicking on overlay
        renameModal.addEventListener('click', (e) => {
            if (e.target === renameModal) {
                closeRenameModal();
            }
        });

        deleteModal.addEventListener('click', (e) => {
            if (e.target === deleteModal) {
                closeDeleteModal();
            }
        });

        // Handle Enter key in rename modal
        renameChatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                handleRenameConfirm();
            }
        });
        
        suggestionChips.forEach(chip => {
            chip.addEventListener('click', () => {
                const prompt = chip.getAttribute('data-prompt');
                messageInput.value = prompt;
                messageInput.focus();
                chatForm.dispatchEvent(new Event('submit', { cancelable: true }));
            });
        });

        quickActions.forEach(action => {
            action.addEventListener('click', () => {
                const prompt = action.getAttribute('data-prompt');
                messageInput.value = prompt;
                messageInput.focus();
                chatForm.dispatchEvent(new Event('submit', { cancelable: true }));
            });
        });

        // Enhanced Enter key functionality
        messageInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                if (e.shiftKey) {
                    // Shift + Enter: Insert new line
                    setTimeout(() => {
                        const newHeight = Math.min(messageInput.scrollHeight, window.innerWidth <= 768 ? 200 : 120);
                        messageInput.style.height = 'auto';
                        messageInput.style.height = newHeight + 'px';
                    }, 0);
                } else {
                    // Enter alone: Send message
                    e.preventDefault();
                    
                    if (!isProcessing && messageInput.value.trim() !== '') {
                        // Visual feedback
                        const inputContainer = document.querySelector('.input-container');
                        const originalBorderColor = inputContainer.style.borderColor;
                        inputContainer.style.borderColor = 'var(--md-primary)';
                        
                        chatForm.dispatchEvent(new Event('submit', { cancelable: true }));
                        
                        setTimeout(() => {
                            inputContainer.style.borderColor = originalBorderColor;
                        }, 300);
                    } else if (messageInput.value.trim() === '') {
                        showNotification('Please enter a message before sending', 'error');
                    }
                }
            }
        });

        // Improved mobile input handling
        messageInput.addEventListener('focus', function() {
            if (window.innerWidth <= 768) {
                // Add a small delay to ensure keyboard is fully open
                setTimeout(() => {
                    const inputArea = document.querySelector('.input-area');
                    if (inputArea) {
                        inputArea.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }, 300);
            }
        });

        // Auto-expand textarea more aggressively on mobile
        messageInput.addEventListener('input', function() {
            this.style.height = 'auto';
            const newHeight = Math.min(this.scrollHeight, window.innerWidth <= 768 ? 200 : 120);
            this.style.height = newHeight + 'px';
            
            sendBtn.disabled = this.value.trim() === '' || isProcessing;
        });

        // Send button click handler for stop functionality
        sendBtn.addEventListener('click', function(e) {
            if (isProcessing) {
                e.preventDefault();
                stopResponse();
            }
        });

        chatForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (isProcessing) {
                return;
            }
            
            const userMessage = messageInput.value.trim();
            if (userMessage || currentFileData) {
                displayUserMessage(userMessage);
                let apiPrompt = userMessage;
                
                // Apply mode-specific formatting
                if (currentMode === 'brainstorm') {
                    apiPrompt = `Brainstorm a list of creative, innovative ideas about: "${userMessage}". Provide a diverse and interesting list with at least 5 unique ideas. Format each idea clearly with a brief explanation.`;
                } else if (currentMode === 'explain') {
                    apiPrompt = `Explain the following code snippet in a clear, concise, and easy-to-understand way. Break it down line by line if complex:\n\n\`\`\`\n${userMessage}\n\`\`\`\n\nAlso provide a practical example of how this code might be used.`;
                } else if (currentMode === 'summarize') {
                    apiPrompt = `Please provide a comprehensive summary of the following text. Include key points, main ideas, and important details:\n\n${userMessage}`;
                } else if (currentMode === 'translate') {
                    apiPrompt = `Translate the following text to English. If it's already in English, provide a more polished version:\n\n${userMessage}`;
                }
                
                // Clear the input field
                messageInput.value = '';
                messageInput.style.height = 'auto';
                sendBtn.disabled = true;
                
                // Add to current chat history
                const currentChat = chatSessions[currentChatId];
                if (currentFileData) {
                    currentChat.history.push({ 
                        role: "user", 
                        parts: [
                            { text: apiPrompt || "Please analyze this file and provide information about it." },
                            { inline_data: currentFileData }
                        ] 
                    });
                    currentFileData = null;
                } else {
                    currentChat.history.push({ role: "user", parts: [{ text: apiPrompt }] });
                }
                
                currentChat.updatedAt = new Date().toISOString();
                saveChatSessions();
                renderChatSessions();
                
                // Get response
                await getBotResponse();
                setMode('chat');
            }
        });

        // Theme Toggle
        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('light-theme');
            document.body.classList.toggle('dark-theme');
            
            if (document.body.classList.contains('dark-theme')) {
                themeIcon.textContent = 'light_mode';
                userSettings.darkMode = true;
                darkModeToggle.checked = true;
            } else {
                themeIcon.textContent = 'dark_mode';
                userSettings.darkMode = false;
                darkModeToggle.checked = false;
            }
            
            saveUserSettings();
        });

        // Functions
        function setMode(newMode) {
            currentMode = currentMode === newMode ? 'chat' : newMode;
            updateUIForMode();
            
            // Close mobile sidebar if open
            closeMobileSidebar();
        }

        function toggleWebSearch() {
            webSearchEnabled = !webSearchEnabled;
            webSearchBtn.classList.toggle('active', webSearchEnabled);
            mobileWebSearchBtn.classList.toggle('active', webSearchEnabled);
            
            if (webSearchEnabled) {
                showNotification('Web search enabled - I will search for up-to-date information');
            } else {
                showNotification('Web search disabled');
            }
            
            // Close mobile sidebar if open
            closeMobileSidebar();
        }

        function updateUIForMode() {
            featureButtons.forEach(btn => {
                btn.classList.remove('active');
            });
            
            mobileFeatureButtons.forEach(btn => {
                btn.classList.remove('active');
            });
            
            switch (currentMode) {
                case 'brainstorm':
                    brainstormBtn.classList.add('active');
                    mobileBrainstormBtn.classList.add('active');
                    messageInput.placeholder = 'What would you like to brainstorm about?';
                    break;
                case 'explain':
                    explainBtn.classList.add('active');
                    mobileExplainBtn.classList.add('active');
                    messageInput.placeholder = 'Paste your code here for detailed explanation...';
                    break;
                case 'summarize':
                    summarizeBtn.classList.add('active');
                    mobileSummarizeBtn.classList.add('active');
                    messageInput.placeholder = 'Paste text to summarize...';
                    break;
                case 'translate':
                    translateBtn.classList.add('active');
                    mobileTranslateBtn.classList.add('active');
                    messageInput.placeholder = 'Enter text to translate...';
                    break;
                default:
                    messageInput.placeholder = 'Ask Anything...';
                    break;
            }
        }

        function toggleSendButton(isProcessing) {
            if (isProcessing) {
                sendBtn.classList.add('stop-mode');
                sendIcon.innerHTML = '<span class="stop-spinner"></span>';
                sendBtn.title = 'Stop generating';
            } else {
                sendBtn.classList.remove('stop-mode');
                sendIcon.innerHTML = 'send';
                sendBtn.title = 'Send message';
            }
        }

        function stopResponse() {
            if (abortController) {
                abortController.abort();
                abortController = null;
            }
            
            isProcessing = false;
            toggleSendButton(false);
            hideTypingIndicator();
            
            const stoppedMessage = "Response stopped by user.";
            displayBotMessage(stoppedMessage, false);
            
            showNotification('Response stopped');
        }

        function clearCurrentChat() {
            const currentChat = chatSessions[currentChatId];
            const welcomeSection = chatWindow.querySelector('.welcome-section');
            chatWindow.innerHTML = '';
            
            if (welcomeSection) {
                chatWindow.appendChild(welcomeSection);
                // Update welcome message when clearing chat
                updateWelcomeMessage();
            }
            
            // Reset chat history to just system message
            currentChat.history = [systemMessage];
            currentChat.updatedAt = new Date().toISOString();
            currentFileData = null;
            saveChatSessions();
            
            // Reattach event listeners
            document.querySelectorAll('.suggestion-chip').forEach(chip => {
                chip.addEventListener('click', () => {
                    const prompt = chip.getAttribute('data-prompt');
                    messageInput.value = prompt;
                    messageInput.focus();
                    chatForm.dispatchEvent(new Event('submit', { cancelable: true }));
                });
            });
            
            showNotification('Chat cleared successfully');
            
            // Close mobile sidebar if open
            closeMobileSidebar();
        }

        function exportCurrentChat() {
            const currentChat = chatSessions[currentChatId];
            
            // Filter out the system message (first message in history)
            const chatText = currentChat.history
                .filter((entry, index) => index > 0) // Skip the first message (system message)
                .map(entry => {
                    if (entry.role === 'user') {
                        return `You: ${entry.parts[0].text}`;
                    } else if (entry.role === 'model') {
                        return `Clover AI: ${entry.parts[0].text}`;
                    }
                    return '';
                })
                .filter(text => text !== '')
                .join('\n\n');
            
            const blob = new Blob([chatText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `clover-ai-${currentChat.title}-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Chat exported successfully');
            
            // Close mobile sidebar if open
            closeMobileSidebar();
        }

        function displayUserMessage(message) {
            const messageElement = document.createElement('div');
            messageElement.className = 'message user';
            
            let messageContent = '';
            if (message) {
                messageContent = `<div class="message-content">${escapeHtml(message)}</div>`;
            }
            
            // Add timestamp
            const timestamp = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            // Use profile picture if available, otherwise use default avatar
            let avatarHTML = '';
            if (userSettings.profilePicture) {
                avatarHTML = `<img src="${userSettings.profilePicture}" alt="User Profile">`;
            } else {
                avatarHTML = '<span class="material-icons-round">person</span>';
            }
            
            messageElement.innerHTML = `
                <div class="message-bubble">
                    ${messageContent}
                    ${userSettings.timestamps ? `<div class="message-timestamp">${timestamp}</div>` : ''}
                </div>
                <div class="message-avatar">
                    ${avatarHTML}
                </div>
            `;
            
            // Add timestamp to message element
            addTimestampToMessage(messageElement);
            
            chatWindow.appendChild(messageElement);
            chatWindow.scrollTop = chatWindow.scrollHeight;
            
            // Check and add date separators
            checkAndAddDateSeparator();
        }

        function displayBotMessage(message, typewriterEffect = true) {
            const messageElement = document.createElement('div');
            messageElement.className = 'message bot';
            
            let botMessageContent = '';
            const codeBlockRegex = /```(\w*)\n([\s\S]*?)```/g;
            let lastIndex = 0, match;

            while ((match = codeBlockRegex.exec(message)) !== null) {
                if (match.index > lastIndex) {
                    const textPart = message.substring(lastIndex, match.index).trim();
                    if (textPart) botMessageContent += `<div class="message-content">${formatTextWithLineBreaks(textPart)}</div>`;
                }
                const language = match[1] || 'plaintext';
                const code = match[2];
                const uniqueId = `code-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
                botMessageContent += `
                    <div class="code-block">
                        <div class="code-header">
                            <span><span class="material-icons-round" style="font-size: 16px; vertical-align: middle;">code</span> ${language}</span>
                            <button class="copy-btn" onclick="copyCode('${uniqueId}', this)">
                                <span class="material-icons-round">content_copy</span>
                                <span>Copy</span>
                            </button>
                        </div>
                        <div class="code-content" id="${uniqueId}">${escapeHtml(code)}</div>
                    </div>`;
                lastIndex = match.index + match[0].length;
            }

            if (lastIndex < message.length) {
                const textPart = message.substring(lastIndex).trim();
                if (textPart) botMessageContent += `<div class="message-content">${formatTextWithLineBreaks(textPart)}</div>`;
            }

            const messageId = `msg-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
            
            // Add timestamp
            const timestamp = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            botMessageContent += `
                <div class="feedback-buttons" id="feedback-${messageId}">
                    <button class="feedback-btn like-btn" onclick="handleFeedback('${messageId}', 'like')">
                        <span class="material-icons-round">thumb_up</span>
                        <span class="feedback-text">Like</span>
                    </button>
                    <button class="feedback-btn dislike-btn" onclick="handleFeedback('${messageId}', 'dislike')">
                        <span class="material-icons-round">thumb_down</span>
                        <span class="feedback-text">Dislike</span>
                    </button>
                    <button class="feedback-btn retry-btn" onclick="handleFeedback('${messageId}', 'retry')">
                        <span class="material-icons-round">refresh</span>
                        <span class="feedback-text">Retry</span>
                    </button>
                </div>
                ${userSettings.timestamps ? `<div class="message-timestamp">${timestamp}</div>` : ''}
            `;

            messageElement.innerHTML = `
                <div class="message-avatar">
                    <img src="https://aditya-cmd-max.github.io/exonovaai/logo.png" alt="AI Logo">
                </div>
                <div class="message-bubble">
                    ${botMessageContent}
                </div>
            `;
            
            // Add timestamp to message element
            addTimestampToMessage(messageElement);
            
            chatWindow.appendChild(messageElement);
            
            // Play AI response sound when bot message is displayed
            playAIResponseSound();
            
            setTimeout(() => {
                applyHighlighting(messageElement);
            }, 100);
            
            // Check and add date separators
            checkAndAddDateSeparator();
            
            messageElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function formatTextWithLineBreaks(text) {
            text = text.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>');
            text = text.replace(/\*(.*?)\*/g, '<i>$1</i>');
            text = text.replace(/__(.*?)__/g, '<u>$1</u>');
            text = text.replace(/^\s*[\-*]\s+(.*)$/gm, ' $1<br>');
            text = text.replace(/^\s*\d+\.\s+(.*)$/gm, '<span style="margin-right: 5px;"></span> $1<br>');
            
            let formattedText = text.replace(/\n\n/g, '</p><p>');
            formattedText = formattedText.replace(/\n/g, '<br>');
            
            return formattedText;
        }

        function applyHighlighting(messageElement) {
            const messageContents = messageElement.querySelectorAll('.message-content');
            if (!messageContents.length) return;

            messageContents.forEach(messageContent => {
                let text = messageContent.textContent || messageContent.innerText;
                
                if (text.length < 20) return;
                
                const topTerms = findTopImportantTerms(text);
                
                if (topTerms.length > 0) {
                    let html = messageContent.innerHTML;
                    
                    topTerms.forEach(term => {
                        const regex = new RegExp(escapeRegExp(term.term), 'gi');
                        html = html.replace(regex, `<span class="highlight" style="animation-delay: ${Math.random() * 0.5}s">$&</span>`);
                    });
                    
                    messageContent.innerHTML = html;
                    
                    setTimeout(() => {
                        const highlights = messageContent.querySelectorAll('.highlight');
                        highlights.forEach(highlight => {
                            highlight.addEventListener('mouseenter', function() {
                                this.style.transform = 'scale(1.05)';
                                this.style.boxShadow = '0 4px 12px rgba(25, 118, 210, 0.3)';
                            });
                            
                            highlight.addEventListener('mouseleave', function() {
                                this.style.transform = 'scale(1)';
                                this.style.boxShadow = '0 1px 2px rgba(25, 118, 210, 0.2)';
                            });
                        });
                    }, 2000);
                }
            });
        }

        function escapeRegExp(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        function findTopImportantTerms(text) {
            const allTerms = [];
            
            const properNounRegex = /\b([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\b/g;
            const properNouns = text.match(properNounRegex) || [];
            
            properNouns.forEach(term => {
                if (term.length > 3 && !isCommonWord(term) && !isSentenceStarter(term)) {
                    let score = term.length;
                    if (term.split(' ').length > 1) score += 10;
                    if (/^[A-Z]+$/.test(term)) score += 5;
                    
                    allTerms.push({ term, score, type: 'proper_noun' });
                }
            });
            
            const technicalTerms = extractTechnicalTerms(text);
            technicalTerms.forEach(term => {
                allTerms.push({ term, score: term.length + 8, type: 'technical' });
            });
            
            const quotedTerms = extractQuotedPhrases(text);
            quotedTerms.forEach(term => {
                allTerms.push({ term, score: term.length + 15, type: 'quoted' });
            });
            
            const contextualTerms = extractContextualTerms(text);
            contextualTerms.forEach(term => {
                allTerms.push({ term, score: term.length + 12, type: 'contextual' });
            });
            
            const uniqueTerms = [];
            const seen = new Set();
            
            allTerms.forEach(item => {
                const lowerTerm = item.term.toLowerCase();
                if (!seen.has(lowerTerm)) {
                    seen.add(lowerTerm);
                    uniqueTerms.push(item);
                }
            });
            
            uniqueTerms.sort((a, b) => b.score - a.score);
            
            return uniqueTerms.slice(0, 2);
        }

        function isCommonWord(term) {
            const commonWords = [
                'This', 'The', 'That', 'These', 'Those', 'There', 'Their', 'They', 'What',
                'When', 'Where', 'Why', 'How', 'Which', 'Who', 'Will', 'Would', 'Could',
                'Should', 'Have', 'Has', 'Had', 'Are', 'Is', 'Was', 'Were', 'And', 'But',
                'Or', 'Not', 'For', 'With', 'From', 'About', 'Into', 'Through', 'During',
                'While', 'Since', 'Until', 'Upon', 'Without', 'Within', 'Among', 'Between'
            ];
            return commonWords.includes(term);
        }

        function isSentenceStarter(term) {
            const sentenceStarters = [
                'However', 'Therefore', 'Moreover', 'Furthermore', 'Additionally', 'Consequently',
                'Nevertheless', 'Nonetheless', 'Meanwhile', 'Similarly', 'Specifically',
                'Interestingly', 'Importantly', 'Basically', 'Essentially'
            ];
            return sentenceStarters.includes(term);
        }

        function extractTechnicalTerms(text) {
            const terms = [];
            
            const patterns = [
                /\b[A-Z]{2,}\b/g,
                /\b\w+-\w+\b/g,
                /\b\w+\.\w+\b/g,
                /\b\w+\d+\w*\b/g
            ];
            
            patterns.forEach(pattern => {
                const matches = text.match(pattern) || [];
                matches.forEach(match => {
                    if (match.length > 2 && !isCommonAcronym(match)) {
                        terms.push(match);
                    }
                });
            });
            
            return terms;
        }

        function isCommonAcronym(term) {
            const commonAcronyms = ['AI', 'ML', 'API', 'URL', 'HTML', 'CSS', 'JS', 'HTTP', 'HTTPS'];
            return commonAcronyms.includes(term.toUpperCase());
        }

        function extractQuotedPhrases(text) {
            const terms = [];
            
            const quotePatterns = [
                /"([^"]+)"/g,
                /'([^']+)'/g,
                /\(([^)]+)\)/g
            ];
            
            quotePatterns.forEach(pattern => {
                const matches = [...text.matchAll(pattern)];
                matches.forEach(match => {
                    if (match[1].length > 3 && match[1].length < 30) {
                        terms.push(match[1]);
                    }
                });
            });
            
            return terms;
        }

        function extractContextualTerms(text) {
            const terms = [];
            
            const contextPatterns = [
                /(?:called|named|termed|known as|referred to as)\s+([A-Z][a-z]+(?:\s+[A-Za-z]+)*)/gi,
                /(?:such as|including|like|especially)\s+([A-Z][a-z]+(?:\s+[A-Za-z]+)*)/gi,
                /(?:technology|framework|library|language|tool|platform|concept|principle)\s+([A-Z][a-z]+(?:\s+[A-Za-z]+)*)/gi
            ];
            
            contextPatterns.forEach(pattern => {
                const matches = [...text.matchAll(pattern)];
                matches.forEach(match => {
                    if (match[1] && match[1].length > 2) {
                        terms.push(match[1]);
                    }
                });
            });
            
            return terms;
        }

        function showTypingIndicator() {
            if (userSettings.typingAnimation) {
                const typingElement = document.createElement('div');
                typingElement.className = 'typing-indicator';
                typingElement.id = 'typing-indicator';
                typingElement.innerHTML = `
                    <div class="message-avatar">
                        <img src="https://aditya-cmd-max.github.io/exonovaai/logo.png" alt="AI Logo">
                    </div>
                    <div class="typing-dots">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                `;
                chatWindow.appendChild(typingElement);
                chatWindow.scrollTop = chatWindow.scrollHeight;
            }
        }

        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typing-indicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        async function getBotResponse() {
            showTypingIndicator();
            isProcessing = true;
            toggleSendButton(true);
            
            const apiKey = "AIzaSyDumsAxfOETUy3E85Qp_ikVSglQmeoXrJk";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            
            const currentChat = chatSessions[currentChatId];
            let modifiedHistory = [...currentChat.history];
            
            if (webSearchEnabled) {
                const lastUserMessage = modifiedHistory[modifiedHistory.length - 1];
                if (lastUserMessage.role === "user" && lastUserMessage.parts[0].text) {
                    lastUserMessage.parts[0].text += " (Please perform a web search to provide the most up-to-date information)";
                }
            }
            
            const payload = { contents: modifiedHistory };

            abortController = new AbortController();

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload),
                    signal: abortController.signal
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || `API Error: ${response.status}`);
                }

                const result = await response.json();
                hideTypingIndicator();
                isProcessing = false;
                toggleSendButton(false);

                if (result.candidates?.length > 0) {
                    const botMessage = result.candidates[0].content.parts[0].text;
                    displayBotMessage(botMessage);
                    
                    // Add to chat history
                    currentChat.history.push({ role: "model", parts: [{ text: botMessage }] });
                    currentChat.updatedAt = new Date().toISOString();
                    saveChatSessions();
                    renderChatSessions();
                    
                    // Check and add date separators
                    setTimeout(() => {
                        checkAndAddDateSeparator();
                    }, 100);
                } else {
                    handleApiError("I received an empty response. Please try rephrasing your question. ");
                }
            } catch (error) {
                if (error.name === 'AbortError') {
                    console.log('Request was cancelled');
                    return;
                }
                
                console.error("API Error:", error);
                handleApiError(`Sorry, I'm having trouble responding right now. Please try again later. (Error: ${error.message})`);
            } finally {
                isProcessing = false;
                toggleSendButton(false);
                abortController = null;
            }
        }

        function handleApiError(message) {
            hideTypingIndicator();
            isProcessing = false;
            toggleSendButton(false);
            displayBotMessage(message, false);
        }

        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        function copyCode(elementId, buttonElement) {
            const codeElement = document.getElementById(elementId);
            const icon = buttonElement.querySelector('.material-icons-round');
            
            navigator.clipboard.writeText(codeElement.innerText).then(() => {
                icon.textContent = 'check';
                buttonElement.classList.add('copied');
                
                setTimeout(() => {
                    icon.textContent = 'content_copy';
                    buttonElement.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                console.error('Copy failed:', err);
                icon.textContent = 'close';
                setTimeout(() => {
                    icon.textContent = 'content_copy';
                }, 2000);
            });
        }

        function startVoiceInput() {
            if (!('webkitSpeechRecognition' in window)) {
                showNotification('Voice input is not supported in your browser');
                return;
            }
            
            const recognition = new webkitSpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            
            voiceInputBtn.innerHTML = '<span class="material-icons-round">autorenew</span>';
            voiceInputBtn.style.color = 'var(--md-primary)';
            
            recognition.onstart = function() {
                showNotification('Listening... Speak now');
            };
            
            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                messageInput.value = transcript;
                voiceInputBtn.innerHTML = '<span class="material-icons-round">mic</span>';
                voiceInputBtn.style.color = '';
                sendBtn.disabled = false;
                showNotification('Voice input captured');
            };
            
            recognition.onerror = function(event) {
                voiceInputBtn.innerHTML = '<span class="material-icons-round">mic</span>';
                voiceInputBtn.style.color = '';
                showNotification('Error occurred in recognition: ' + event.error);
            };
            
            recognition.onend = function() {
                voiceInputBtn.innerHTML = '<span class="material-icons-round">mic</span>';
                voiceInputBtn.style.color = '';
            };
            
            recognition.start();
        }

        function showNotification(message, type = 'success') {
            notification.className = `notification ${type}`;
            notificationText.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Feedback handling function
        function handleFeedback(messageId, action) {
            const feedbackContainer = document.getElementById(`feedback-${messageId}`);
            const likeBtn = feedbackContainer.querySelector('.like-btn');
            const dislikeBtn = feedbackContainer.querySelector('.dislike-btn');
            
            likeBtn.classList.remove('liked');
            dislikeBtn.classList.remove('disliked');
            
            if (action === 'like') {
                likeBtn.classList.add('liked');
                showNotification('Thanks for your feedback! ');
            } else if (action === 'dislike') {
                dislikeBtn.classList.add('disliked');
                showNotification('Thanks for your feedback! We\'ll try to improve. ');
            } else if (action === 'retry') {
                const messageElements = document.querySelectorAll('.message');
                let userMessage = '';
                
                for (let i = 0; i < messageElements.length; i++) {
                    if (messageElements[i].querySelector(`#feedback-${messageId}`)) {
                        if (i > 0 && messageElements[i-1].classList.contains('user')) {
                            const userBubble = messageElements[i-1].querySelector('.message-bubble');
                            if (userBubble) {
                                userMessage = userBubble.textContent || userBubble.innerText;
                            }
                        }
                        break;
                    }
                }
                
                if (userMessage) {
                    messageInput.value = userMessage;
                    chatForm.dispatchEvent(new Event('submit', { cancelable: true }));
                } else {
                    showNotification('Could not find the original message to retry', 'error');
                }
            }
            
            const feedbackData = {
                messageId,
                action,
                timestamp: new Date().toISOString()
            };
            
            let feedbackHistory = JSON.parse(localStorage.getItem('cloverAIFeedback') || '[]');
            feedbackHistory.push(feedbackData);
            localStorage.setItem('cloverAIFeedback', JSON.stringify(feedbackHistory));
        }

        // Initialize the app
        loadUserSettings();
        initializeChatSessions();
        initializeSearch();
        initializeSidebarResize();
        updateUIForMode();
        sendBtn.disabled = true;

        // Force button text visibility
        document.querySelectorAll('.feature-btn, .quick-action, .suggestion-chip').forEach(btn => {
            btn.style.color = 'var(--md-on-surface-variant)';
        });
    </script>
</body>
</html>
