<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Clover AI</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700;800&family=Lora:wght@400;500;600;700&family=Roboto:wght@300;400;500;700&family=Open+Sans:wght@300;400;500;600;700&family=Montserrat:wght@300;400;500;600;700&family=Source+Sans+Pro:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <!-- AI Training System -->
    <script src="../ai-training-data.js"></script>
    
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="https://aditya-cmd-max.github.io/cloverai/logo.png">

    <meta name="google-site-verification" content="gVm_Dk4QJW6bhd3nyT3WJPIzHXt9SEgn8Z43IU2t27Y" />
    
    <!-- Reverbit Auth -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-storage-compat.js"></script>
    <script src="https://aditya-cmd-max.github.io/js/auth.js"></script>

    <style>
        /* Material Design 3 Color System - Enhanced Blue/Green Theme */
        :root {
            /* Primary Colors - Blue Theme */
            --md-primary: #1a73e8;
            --md-primary-light: #4285f4;
            --md-primary-dark: #0d47a1;
            --md-on-primary: #FFFFFF;
            --md-primary-container: #d2e3fc;
            --md-on-primary-container: #001d3d;
            
            /* Secondary Colors - Green Theme */
            --md-secondary: #0d8a72;
            --md-secondary-light: #34a853;
            --md-secondary-dark: #0a5c42;
            --md-on-secondary: #FFFFFF;
            --md-secondary-container: #b8f2e6;
            --md-on-secondary-container: #00201a;
            
            /* Surface Colors */
            --md-surface: #FFFFFF;
            --md-on-surface: #202124;
            --md-surface-variant: #F8F9FA;
            --md-on-surface-variant: #5f6368;
            
            /* Background Colors */
            --md-background: #FFFFFF;
            --md-on-background: #202124;
            
            /* Error Colors */
            --md-error: #B3261E;
            --md-on-error: #FFFFFF;
            --md-error-container: #F9DEDC;
            --md-on-error-container: #410E0B;
            
            /* Outline Colors */
            --md-outline: #DADCE0;
            --md-outline-variant: #E8EAED;
            
            /* Shadow Elevations */
            --md-elevation-1: 0 1px 2px rgba(60,64,67,0.3), 0 1px 3px 1px rgba(60,64,67,0.15);
            --md-elevation-2: 0 1px 2px rgba(60,64,67,0.3), 0 2px 6px 2px rgba(60,64,67,0.15);
            --md-elevation-3: 0 1px 3px 1px rgba(60,64,67,0.15), 0 1px 2px rgba(60,64,67,0.3);
            --md-elevation-4: 0 4px 12px rgba(0, 0, 0, 0.1);
            --md-elevation-5: 0 8px 16px rgba(0, 0, 0, 0.12);
            
            /* Animation */
            --md-transition: all 0.3s cubic-bezier(0.2, 0, 0, 1);
            --md-transition-fast: all 0.15s cubic-bezier(0.2, 0, 0, 1);
            
            /* Border Radius */
            --md-radius-small: 8px;
            --md-radius-medium: 12px;
            --md-radius-large: 16px;
            --md-radius-extra-large: 28px;
            --md-radius-pill: 9999px;
            
            /* Spacing */
            --md-spacing-xs: 4px;
            --md-spacing-sm: 8px;
            --md-spacing-md: 16px;
            --md-spacing-lg: 24px;
            --md-spacing-xl: 32px;
            --md-spacing-xxl: 48px;
            
            /* Typography */
            --md-font-logo: 'Playfair Display', serif;
            --md-font-heading: 'Inter', sans-serif;
            --md-font-body: 'Lora', serif;
            --md-font-family: 'Inter', sans-serif;
            
            /* Sidebar */
            --sidebar-width: 280px;
            --sidebar-min-width: 68px;
            --sidebar-sticky-top: 80px;
        }

        /* Dark Theme */
        .dark-theme {
            --md-surface: #202124;
            --md-on-surface: #FFFFFF;
            --md-surface-variant: #303134;
            --md-on-surface-variant: #E8EAED;
            --md-background: #202124;
            --md-on-background: #FFFFFF;
            --md-primary: #8ab4f8;
            --md-primary-light: #aecbfa;
            --md-primary-container: #174ea6;
            --md-on-primary-container: #E8EAED;
            --md-secondary: #81c995;
            --md-secondary-light: #a8dab5;
            --md-secondary-container: #0d8a72;
            --md-on-secondary-container: #E8EAED;
            --md-outline: #3C4043;
            --md-outline-variant: #5F6368;
            --md-elevation-1: 0 1px 2px rgba(0,0,0,0.3), 0 1px 3px 1px rgba(0,0,0,0.15);
            --md-elevation-2: 0 1px 2px rgba(0,0,0,0.3), 0 2px 6px 2px rgba(0,0,0,0.15);
            --md-elevation-3: 0 1px 3px 1px rgba(0,0,0,0.15), 0 1px 2px rgba(0,0,0,0.3);
            --md-elevation-4: 0 4px 12px rgba(0, 0, 0, 0.15);
            --md-elevation-5: 0 8px 16px rgba(0, 0, 0, 0.2);
        }

        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--md-font-body);
            background-color: var(--md-background);
            color: var(--md-on-surface);
            line-height: 1.6;
            overflow-x: hidden;
            transition: var(--md-transition);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Splash Screen */
        #splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--md-background);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 9999;
            color: var(--md-on-surface);
            font-family: var(--md-font-heading);
        }

        .splash-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            gap: var(--md-spacing-lg);
        }

        .splash-logo {
            width: 120px;
            height: 120px;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }

        /* Header */
        .app-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--md-spacing-md) var(--md-spacing-xl);
            background: var(--md-surface);
            border-bottom: 1px solid var(--md-outline);
            position: sticky;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
            height: 64px;
            gap: var(--md-spacing-md);
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: var(--md-spacing-md);
            flex-shrink: 0;
        }

        .logo {
            width: 40px;
            height: 40px;
            border-radius: var(--md-radius-medium);
            overflow: hidden;
            transition: var(--md-transition);
        }

        .logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .app-name {
            font-family: var(--md-font-logo);
            font-size: 1.25rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--md-primary), var(--md-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            white-space: nowrap;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: var(--md-spacing-xs);
            flex-shrink: 0;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--md-spacing-sm);
            padding: var(--md-spacing-sm) var(--md-spacing-lg);
            border-radius: var(--md-radius-pill);
            border: none;
            font-family: var(--md-font-heading);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--md-transition);
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }

        .btn-filled {
            background: linear-gradient(135deg, var(--md-primary), var(--md-secondary));
            color: var(--md-on-primary);
            box-shadow: var(--md-elevation-2);
        }

        .btn-filled:hover {
            transform: translateY(-2px);
            box-shadow: var(--md-elevation-3);
        }

        .btn-icon {
            width: 40px;
            height: 40px;
            padding: 0;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: var(--md-surface-variant);
            color: var(--md-on-surface);
            transition: var(--md-transition);
            flex-shrink: 0;
        }

        .btn-icon:hover {
            background: var(--md-primary-container);
            color: var(--md-primary);
            transform: rotate(15deg);
        }

        /* App Container */
        .app-container {
            display: flex;
            flex: 1;
            max-width: 1600px;
            margin: 0 auto;
            width: 100%;
            padding: var(--md-spacing-lg);
            gap: var(--md-spacing-xl);
            min-height: calc(100vh - 64px);
            position: relative;
            align-items: flex-start;
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            min-width: var(--sidebar-min-width);
            background: var(--md-surface);
            border-radius: var(--md-radius-large);
            padding: var(--md-spacing-lg);
            box-shadow: var(--md-elevation-2);
            border: 1px solid var(--md-outline);
            display: flex;
            flex-direction: column;
            gap: var(--md-spacing-lg);
            overflow-y: auto;
            position: sticky;
            top: var(--sidebar-sticky-top);
            height: calc(100vh - var(--sidebar-sticky-top) - var(--md-spacing-lg) * 2);
            max-height: calc(100vh - var(--sidebar-sticky-top) - var(--md-spacing-lg) * 2);
            flex-shrink: 0;
            align-self: flex-start;
            transition: var(--md-transition);
        }

        .sidebar.collapsed {
            width: var(--sidebar-min-width);
            padding: var(--md-spacing-md);
        }

        .sidebar.collapsed .sidebar-title span:not(.material-icons-round),
        .sidebar.collapsed .search-chat-container,
        .sidebar.collapsed .chat-session-title,
        .sidebar.collapsed .feature-btn span:not(.material-icons-round),
        .sidebar.collapsed .chat-session-pin,
        .sidebar.collapsed .chat-session-delete {
            display: none;
        }

        .sidebar.collapsed .feature-btn,
        .sidebar.collapsed .chat-session {
            justify-content: center;
            padding: var(--md-spacing-sm);
            min-width: auto;
        }

        .sidebar-toggle {
            position: absolute;
            top: var(--md-spacing-sm);
            right: var(--md-spacing-sm);
            background: transparent;
            border: none;
            color: var(--md-on-surface-variant);
            cursor: pointer;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--md-transition);
            z-index: 5;
            background: var(--md-surface-variant);
        }

        .sidebar-toggle:hover {
            background: var(--md-primary-container);
            color: var(--md-primary);
            transform: rotate(15deg);
        }

        /* Search Chat */
        .search-chat-container {
            position: relative;
            margin-bottom: var(--md-spacing-sm);
        }

        .search-chat-input {
            width: 100%;
            padding: var(--md-spacing-sm);
            padding-left: 40px;
            background: var(--md-surface);
            border: 1px solid var(--md-outline);
            border-radius: var(--md-radius-pill);
            font-family: var(--md-font-body);
            font-size: 0.875rem;
            color: var(--md-on-surface);
            transition: var(--md-transition);
            outline: none;
        }

        .search-chat-input:focus {
            border-color: var(--md-primary);
            box-shadow: 0 0 0 2px var(--md-primary-container);
        }

        .search-icon {
            position: absolute;
            left: var(--md-spacing-sm);
            top: 50%;
            transform: translateY(-50%);
            color: var(--md-on-surface-variant);
            pointer-events: none;
        }

        /* Chat Sessions */
        .chat-sessions {
            display: flex;
            flex-direction: column;
            gap: var(--md-spacing-xs);
            flex: 1;
            overflow-y: auto;
        }

        .chat-session {
            display: flex;
            align-items: center;
            gap: var(--md-spacing-sm);
            padding: var(--md-spacing-sm);
            background: var(--md-surface);
            color: var(--md-on-surface);
            border: 1px solid var(--md-outline);
            border-radius: var(--md-radius-medium);
            font-family: var(--md-font-body);
            font-size: 0.875rem;
            cursor: pointer;
            transition: var(--md-transition);
            text-align: left;
            position: relative;
            border-left: 3px solid transparent;
        }

        .chat-session:hover {
            background: var(--md-surface-variant);
            border-color: var(--md-primary);
            border-left-color: var(--md-primary);
            transform: translateX(2px);
        }

        .chat-session.active {
            background: var(--md-primary-container);
            color: var(--md-on-primary-container);
            border-color: var(--md-primary);
            border-left-color: var(--md-primary);
        }

        /* Feature Buttons */
        .feature-buttons {
            display: flex;
            flex-direction: column;
            gap: var(--md-spacing-xs);
        }

        .feature-btn {
            display: flex;
            align-items: center;
            gap: var(--md-spacing-sm);
            padding: var(--md-spacing-sm) var(--md-spacing-md);
            background: var(--md-surface-variant);
            color: var(--md-on-surface-variant);
            border: none;
            border-radius: var(--md-radius-medium);
            font-family: var(--md-font-heading);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--md-transition);
            text-align: left;
            width: 100%;
            border-left: 3px solid transparent;
        }

        .feature-btn:hover {
            background: var(--md-primary-container);
            color: var(--md-on-primary-container);
            transform: translateX(2px);
            border-left-color: var(--md-primary);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: var(--md-spacing-lg);
            min-width: 0;
            width: 100%;
            position: relative;
            min-height: calc(100vh - 64px - var(--md-spacing-lg) * 2);
        }

        /* Chat Header */
        .chat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--md-spacing-sm) var(--md-spacing-md);
            background: var(--md-surface);
            border-radius: var(--md-radius-medium);
            box-shadow: var(--md-elevation-1);
            border: 1px solid var(--md-outline);
            flex-shrink: 0;
        }

        .chat-title {
            font-family: var(--md-font-heading);
            font-size: 1rem;
            font-weight: 600;
            color: var(--md-on-surface);
        }

        /* Chat Window */
        .chat-window {
            flex: 1;
            background: var(--md-surface);
            border-radius: var(--md-radius-large);
            padding: var(--md-spacing-lg);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: var(--md-spacing-lg);
            box-shadow: var(--md-elevation-1);
            border: 1px solid var(--md-outline);
            min-height: 300px;
            position: relative;
        }

        /* Welcome Section */
        .welcome-section {
            text-align: center;
            padding: var(--md-spacing-xl);
            background: var(--md-surface-variant);
            border-radius: var(--md-radius-large);
            margin-bottom: var(--md-spacing-lg);
            border: 1px solid var(--md-outline);
        }

        .welcome-title {
            font-family: var(--md-font-logo);
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: var(--md-spacing-sm);
            background: linear-gradient(135deg, var(--md-primary), var(--md-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .welcome-subtitle {
            font-family: var(--md-font-body);
            font-size: 0.875rem;
            color: var(--md-on-surface-variant);
            margin-bottom: var(--md-spacing-lg);
            line-height: 1.5;
        }

        /* Suggestion Chips */
        .suggestion-chips {
            display: flex;
            flex-wrap: wrap;
            gap: var(--md-spacing-sm);
            justify-content: center;
        }

        .suggestion-chip {
            background: var(--md-surface);
            color: var(--md-on-surface);
            border: 1px solid var(--md-outline);
            border-radius: var(--md-radius-extra-large);
            padding: var(--md-spacing-sm) var(--md-spacing-md);
            font-family: var(--md-font-heading);
            font-size: 0.75rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--md-transition);
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .suggestion-chip:hover {
            background: var(--md-primary-container);
            color: var(--md-on-primary-container);
            border-color: var(--md-primary);
            transform: translateY(-2px);
        }

        /* Messages */
        .message {
            display: flex;
            gap: var(--md-spacing-md);
            animation: fadeIn 0.3s ease-out;
            align-items: flex-start;
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            overflow: hidden;
            border: 2px solid var(--md-surface);
            box-shadow: var(--md-elevation-1);
        }

        .message.user .message-avatar {
            background: linear-gradient(135deg, var(--md-primary), var(--md-secondary));
            color: var(--md-on-primary);
            order: 2;
        }

        .message.bot .message-avatar {
            background: var(--md-secondary-container);
            color: var(--md-on-secondary-container);
        }

        .message-bubble {
            max-width: 85%;
            padding: var(--md-spacing-md);
            border-radius: var(--md-radius-large);
            position: relative;
            box-shadow: var(--md-elevation-1);
            border: 1px solid transparent;
        }

        .message.user .message-bubble {
            background: linear-gradient(135deg, var(--md-primary), var(--md-secondary));
            color: var(--md-on-primary);
            border-bottom-right-radius: var(--md-radius-small);
        }

        .message.bot .message-bubble {
            background: var(--md-surface-variant);
            color: var(--md-on-surface-variant);
            border-bottom-left-radius: var(--md-radius-small);
            border: 1px solid var(--md-outline);
        }

        .message-content {
            line-height: 1.6;
            font-family: var(--md-font-body);
            font-size: 0.875rem;
        }

        /* Input Area */
        .input-area {
            background: var(--md-surface);
            border-radius: var(--md-radius-large);
            padding: var(--md-spacing-sm);
            box-shadow: var(--md-elevation-2);
            border: 1px solid var(--md-outline);
            position: sticky;
            bottom: 0;
            z-index: 10;
            flex-shrink: 0;
        }

        .input-container {
            position: relative;
            background: var(--md-surface);
            border-radius: var(--md-radius-medium);
            border: 2px solid var(--md-outline);
            transition: var(--md-transition);
        }

        .input-container:focus-within {
            border-color: var(--md-primary);
            box-shadow: 0 0 0 3px var(--md-primary-container);
        }

        .input-form {
            display: flex;
            gap: var(--md-spacing-xs);
            align-items: flex-end;
        }

        .input-wrapper {
            flex: 1;
            position: relative;
            min-height: 60px;
        }

        .message-input {
            width: 100%;
            background: transparent;
            color: var(--md-on-surface);
            border: none;
            border-radius: var(--md-radius-medium);
            padding: var(--md-spacing-sm);
            font-family: var(--md-font-body);
            font-size: 0.875rem;
            resize: none;
            min-height: 60px;
            max-height: 120px;
            transition: var(--md-transition);
            outline: none;
            line-height: 1.5;
        }

        .message-input::placeholder {
            color: var(--md-on-surface-variant);
            opacity: 0.7;
        }

        .input-actions {
            display: flex;
            gap: 2px;
            align-items: flex-end;
            padding: var(--md-spacing-xs);
            flex-shrink: 0;
        }

        .action-btn {
            background: transparent;
            border: none;
            color: var(--md-on-surface-variant);
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--md-transition);
            flex-shrink: 0;
            background: var(--md-surface-variant);
        }

        .action-btn:hover {
            background: var(--md-primary-container);
            color: var(--md-primary);
            transform: rotate(15deg);
        }

        .send-btn {
            background: linear-gradient(135deg, var(--md-primary), var(--md-secondary));
            color: var(--md-on-primary);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--md-transition);
            box-shadow: var(--md-elevation-2);
            flex-shrink: 0;
        }

        .send-btn:hover {
            box-shadow: var(--md-elevation-3);
            transform: translateY(-2px) rotate(15deg);
        }

        .send-btn:disabled {
            background: var(--md-surface-variant);
            color: var(--md-on-surface-variant);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Tools Dropdown */
        .tools-dropdown {
            position: relative;
            display: inline-block;
        }

        .tools-dropdown-content {
            position: absolute;
            bottom: 100%;
            left: 0;
            background: var(--md-surface);
            border: 1px solid var(--md-outline);
            border-radius: var(--md-radius-medium);
            box-shadow: var(--md-elevation-3);
            min-width: 180px;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px);
            transition: var(--md-transition);
        }

        .tools-dropdown-content.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            gap: var(--md-spacing-md);
            animation: fadeIn 0.3s ease-out;
        }

        .typing-dots {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: var(--md-spacing-sm);
            background: var(--md-surface-variant);
            border-radius: var(--md-radius-medium);
            border: 1px solid var(--md-outline);
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--md-primary);
            animation: bounce 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
            background: var(--md-secondary);
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
            background: var(--md-primary-light);
        }

        /* Notification */
        .notification {
            position: fixed;
            bottom: var(--md-spacing-lg);
            right: var(--md-spacing-lg);
            background: var(--md-surface);
            color: var(--md-on-surface);
            padding: var(--md-spacing-sm) var(--md-spacing-md);
            border-radius: var(--md-radius-medium);
            box-shadow: var(--md-elevation-3);
            display: flex;
            align-items: center;
            gap: var(--md-spacing-sm);
            transform: translateY(100px);
            opacity: 0;
            transition: var(--md-transition);
            z-index: 1000;
            border: 1px solid var(--md-outline);
            border-left: 3px solid var(--md-primary);
            font-size: 0.875rem;
        }

        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }

        /* Customization Panel */
        .customization-panel {
            position: fixed;
            top: 0;
            right: -380px;
            width: 350px;
            height: 100%;
            background: var(--md-surface);
            z-index: 1001;
            overflow-y: auto;
            transition: var(--md-transition);
            box-shadow: var(--md-elevation-5);
            border-left: 1px solid var(--md-outline);
            display: flex;
            flex-direction: column;
        }

        .customization-panel.active {
            right: 0;
        }

        /* Auth Required Overlay */
        .auth-required-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--md-background);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            font-family: var(--md-font-heading);
            color: var(--md-on-surface);
        }

        .auth-container {
            max-width: 400px;
            width: 90%;
            background: var(--md-surface);
            border-radius: var(--md-radius-large);
            padding: var(--md-spacing-xl);
            box-shadow: var(--md-elevation-5);
            border: 1px solid var(--md-outline);
            text-align: center;
        }

        /* Footer */
        .app-footer {
            text-align: center;
            padding: var(--md-spacing-md);
            color: var(--md-on-surface-variant);
            font-family: var(--md-font-body);
            font-size: 0.75rem;
            border-top: 1px solid var(--md-outline);
            background: var(--md-surface);
            flex-shrink: 0;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes bounce {
            0%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-4px); }
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
                padding: var(--md-spacing-sm);
                gap: var(--md-spacing-sm);
            }
            
            .sidebar {
                display: none;
            }
            
            .app-header {
                padding: var(--md-spacing-sm);
                height: 56px;
            }
            
            .logo {
                width: 32px;
                height: 32px;
            }
            
            .app-name {
                font-size: 1rem;
            }
            
            .chat-window {
                padding: var(--md-spacing-sm);
                min-height: 250px;
            }
            
            .welcome-section {
                padding: var(--md-spacing-lg);
            }
            
            .welcome-title {
                font-size: 1.25rem;
            }
            
            .input-area {
                padding: var(--md-spacing-xs);
            }
            
            .message-input {
                font-size: 16px;
                min-height: 50px;
            }
            
            .message-bubble {
                max-width: 90%;
            }
        }

        @media (max-width: 480px) {
            .app-header {
                gap: var(--md-spacing-xs);
            }
            
            .btn-icon {
                width: 32px;
                height: 32px;
            }
            
            .chat-header {
                padding: var(--md-spacing-xs);
            }
            
            .chat-title {
                font-size: 0.875rem;
            }
            
            .suggestion-chip {
                font-size: 0.75rem;
                padding: var(--md-spacing-xs) var(--md-spacing-sm);
            }
            
            .customization-panel {
                width: 100%;
                right: -100%;
            }
        }

        /* Enhanced Mobile Navigation */
        .mobile-nav-btn {
            display: none;
        }

        @media (max-width: 768px) {
            .mobile-nav-btn {
                display: flex;
            }
            
            .mobile-sidebar {
                position: fixed;
                top: 0;
                left: -100%;
                width: 85%;
                max-width: 300px;
                height: 100%;
                background: var(--md-surface);
                z-index: 1000;
                overflow-y: auto;
                transition: var(--md-transition);
                display: flex;
                flex-direction: column;
                padding: var(--md-spacing-lg) var(--md-spacing-md);
                box-shadow: var(--md-elevation-5);
                border-right: 1px solid var(--md-outline);
            }
            
            .mobile-sidebar.active {
                left: 0;
            }
            
            .mobile-sidebar-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 999;
                opacity: 0;
                visibility: hidden;
                transition: var(--md-transition);
                backdrop-filter: blur(4px);
            }
            
            .mobile-sidebar-overlay.active {
                opacity: 1;
                visibility: visible;
            }
        }

        /* Reverbit Profile Integration */
        .reverbit-profile-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            overflow: hidden;
            border: 2px solid var(--md-primary, #1a73e8);
            cursor: pointer;
            background: none;
            padding: 0;
            transition: transform 0.2s ease;
            margin: 0 4px;
        }

        .reverbit-profile-avatar:hover {
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(var(--md-primary-rgb, 26, 115, 232), 0.3);
        }

        .reverbit-profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Code Blocks */
        .code-block {
            position: relative;
            margin: var(--md-spacing-sm) 0;
            overflow: hidden;
            border-radius: var(--md-radius-medium);
            background: var(--md-background);
            border: 1px solid var(--md-outline);
            box-shadow: var(--md-elevation-1);
        }

        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--md-spacing-xs) var(--md-spacing-sm);
            background: var(--md-surface-variant);
            border-bottom: 1px solid var(--md-outline);
            font-family: var(--md-font-heading);
            font-size: 0.75rem;
            color: var(--md-on-surface-variant);
        }

        .code-content {
            padding: var(--md-spacing-sm);
            overflow-x: auto;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.75rem;
            line-height: 1.5;
            background: var(--md-background);
        }

        /* Feedback Buttons */
        .feedback-buttons {
            display: flex;
            gap: var(--md-spacing-xs);
            margin-top: var(--md-spacing-sm);
            padding-top: var(--md-spacing-xs);
            border-top: 1px solid var(--md-outline);
            justify-content: flex-end;
            align-items: center;
        }

        .feedback-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 6px;
            background: transparent;
            color: var(--md-on-surface-variant);
            border: 1px solid var(--md-outline);
            border-radius: var(--md-radius-small);
            cursor: pointer;
            transition: var(--md-transition);
            width: 28px;
            height: 28px;
            min-width: 28px;
        }

        .feedback-btn:hover {
            background: var(--md-surface-variant);
            transform: translateY(-2px);
        }

        .feedback-btn .material-icons-round {
            font-size: 16px;
        }
    </style>
</head>
<body class="dark-theme">
    <!-- Splash Screen -->
    <div id="splash-screen">
        <div class="splash-content">
            <div class="logo">
                <img src="https://aditya-cmd-max.github.io/cloverai/logo.png" alt="Clover AI">
            </div>
            <h2>Clover AI</h2>
            <div>Loading...</div>
        </div>
    </div>

    <!-- Auth Required Overlay -->
    <div class="auth-required-overlay" id="auth-required-overlay" style="display: none;">
        <div class="auth-container">
            <div class="logo">
                <img src="https://aditya-cmd-max.github.io/cloverai/logo.png" alt="Clover AI Logo">
            </div>
            
            <h2 style="margin: var(--md-spacing-md) 0; background: linear-gradient(135deg, var(--md-primary), var(--md-secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Authentication Required</h2>
            
            <p style="margin-bottom: var(--md-spacing-lg); color: var(--md-on-surface-variant); font-size: 0.875rem;">
                Sign in to access Clover AI. Your chat history and preferences will be saved across devices.
            </p>
            
            <div style="display: flex; flex-direction: column; gap: var(--md-spacing-sm);">
                <a href="https://aditya-cmd-max.github.io/signin" class="btn btn-filled" id="sign-in-btn" style="text-decoration: none;">
                    <span class="material-icons-round" style="font-size: 16px;">login</span>
                    <span>Sign In to Continue</span>
                </a>
            </div>
            
            <div style="margin-top: var(--md-spacing-lg); padding-top: var(--md-spacing-md); border-top: 1px solid var(--md-outline); color: var(--md-on-surface-variant); font-size: 0.75rem; display: flex; align-items: center; gap: 4px; justify-content: center;">
                <div style="width: 6px; height: 6px; border-radius: 50%; background: var(--md-error);"></div>
                <span>Not signed in</span>
            </div>
        </div>
    </div>

    <!-- Hidden audio element for AI response sound -->
    <audio id="ai-response-sound" preload="auto">
        <source src="https://aditya-cmd-max.github.io/cloverai/notification-ping-372479.mp3" type="audio/mpeg">
    </audio>

    <!-- Header -->
    <header class="app-header">
        <div class="logo-container">
            <button class="btn-icon mobile-nav-btn" id="mobile-nav-btn">
                <span class="material-icons-round">menu</span>
            </button>
            <div class="logo">
                <img src="https://aditya-cmd-max.github.io/cloverai/logo.png" alt="Clover AI Logo">
            </div>
            <h1 class="app-name">Clover AI</h1>
        </div>
        
        <div class="header-actions" id="header-actions">
            <!-- Reverbit profile avatar will be added here by auth.js -->
        </div>
    </header>

    <!-- Mobile Sidebar Overlay -->
    <div class="mobile-sidebar-overlay" id="mobile-sidebar-overlay"></div>

    <!-- Mobile Sidebar -->
    <div class="sidebar mobile-sidebar" id="mobile-sidebar">
        <button class="sidebar-toggle" id="mobile-sidebar-close">
            <span class="material-icons-round">close</span>
        </button>
        
        <h3 class="sidebar-title" style="display: flex; align-items: center; gap: var(--md-spacing-sm); margin-bottom: var(--md-spacing-sm);">
            <span class="material-icons-round">chat</span>
            <span>Chat Sessions</span>
            <div style="margin-left: auto; display: flex; gap: 2px;">
                <button id="mobile-pin-filter-btn" class="btn-icon" style="width: 28px; height: 28px;">
                    <span class="material-icons-round">push_pin</span>
                </button>
                <button id="mobile-new-chat-btn" class="btn-icon" style="width: 28px; height: 28px;">
                    <span class="material-icons-round">add</span>
                </button>
            </div>
        </h3>
        
        <div class="search-chat-container">
            <span class="material-icons-round search-icon">search</span>
            <input type="text" id="mobile-search-chat-input" class="search-chat-input" placeholder="Search chats...">
            <button id="mobile-clear-search-btn" class="btn-icon" style="position: absolute; right: 2px; top: 50%; transform: translateY(-50%); width: 24px; height: 24px;">
                <span class="material-icons-round">close</span>
            </button>
        </div>
        
        <div class="chat-sessions" id="mobile-chat-sessions" style="flex: 1; overflow-y: auto;">
            <!-- Chat sessions will be dynamically added here -->
        </div>
        
        <div style="margin-top: auto; padding-top: var(--md-spacing-sm); border-top: 1px solid var(--md-outline);">
            <h3 class="sidebar-title" style="margin-bottom: var(--md-spacing-sm);">
                <span class="material-icons-round">build</span>
                <span>Tools</span>
            </h3>
            <div class="feature-buttons">
                <button id="mobile-clear-btn" class="feature-btn">
                    <span class="material-icons-round">delete</span>
                    <span>Clear Chat</span>
                </button>
                <button id="mobile-export-btn" class="feature-btn">
                    <span class="material-icons-round">download</span>
                    <span>Export Chat</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Main App Container -->
    <div class="app-container">
        <!-- Sidebar - Desktop -->
        <aside class="sidebar" id="sidebar">
            <button class="sidebar-toggle" id="sidebar-toggle">
                <span class="material-icons-round" id="sidebar-toggle-icon">chevron_left</span>
            </button>
            
            <h3 class="sidebar-title" style="display: flex; align-items: center; gap: var(--md-spacing-sm); margin-bottom: var(--md-spacing-sm);">
                <span class="material-icons-round">chat</span>
                <span>Chat Sessions</span>
                <div style="margin-left: auto; display: flex; gap: 2px;">
                    <button id="pin-filter-btn" class="btn-icon" style="width: 28px; height: 28px;">
                        <span class="material-icons-round">push_pin</span>
                    </button>
                    <button id="new-chat-btn" class="btn-icon" style="width: 28px; height: 28px;">
                        <span class="material-icons-round">add</span>
                    </button>
                </div>
            </h3>
            
            <div class="search-chat-container">
                <span class="material-icons-round search-icon">search</span>
                <input type="text" id="search-chat-input" class="search-chat-input" placeholder="Search chats...">
                <button id="clear-search-btn" class="btn-icon" style="position: absolute; right: 2px; top: 50%; transform: translateY(-50%); width: 24px; height: 24px;">
                    <span class="material-icons-round">close</span>
                </button>
            </div>
            
            <div class="chat-sessions" id="chat-sessions">
                <!-- Chat sessions will be dynamically added here -->
            </div>
            
            <div style="margin-top: auto; padding-top: var(--md-spacing-sm); border-top: 1px solid var(--md-outline);">
                <h3 class="sidebar-title" style="margin-bottom: var(--md-spacing-sm);">
                    <span class="material-icons-round">build</span>
                    <span>Tools</span>
                </h3>
                <div class="feature-buttons">
                    <button id="clear-btn" class="feature-btn">
                        <span class="material-icons-round">delete</span>
                        <span>Clear Chat</span>
                    </button>
                    <button id="export-btn" class="feature-btn">
                        <span class="material-icons-round">download</span>
                        <span>Export Chat</span>
                    </button>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Chat Header -->
            <div class="chat-header">
                <h2 class="chat-title" id="current-chat-title">New Chat</h2>
                <button id="rename-chat-btn" class="btn-icon" style="width: 32px; height: 32px;">
                    <span class="material-icons-round">edit</span>
                </button>
            </div>

            <!-- Chat Window -->
            <div class="chat-window" id="chat-window">
                <div class="welcome-section">
                    <h2 class="welcome-title" id="dynamic-welcome-title">Welcome to Clover AI</h2>
                    <p class="welcome-subtitle">Your intelligent assistant powered by advanced AI. Ask me anything!</p>
                    
                    <div class="suggestion-chips">
                        <div class="suggestion-chip" data-prompt="Explain quantum computing in simple terms">
                            <span class="material-icons-round">science</span>
                            <span>Quantum Computing</span>
                        </div>
                        <div class="suggestion-chip" data-prompt="How to center a div with CSS?">
                            <span class="material-icons-round">code</span>
                            <span>CSS Help</span>
                        </div>
                        <div class="suggestion-chip" data-prompt="What are some creative project ideas for beginners?">
                            <span class="material-icons-round">lightbulb</span>
                            <span>Project Ideas</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Input Area -->
            <div class="input-area">
                <div class="input-container">
                    <form id="chat-form" class="input-form">
                        <div class="input-wrapper">
                            <textarea id="message-input" class="message-input" rows="1" placeholder="Message Clover AI... (Enter to send, Shift+Enter for new line)"></textarea>
                        </div>
                        <div class="input-actions">
                            <div class="tools-dropdown">
                                <button type="button" class="action-btn tools-dropdown-btn" id="tools-dropdown-btn">
                                    <span class="material-icons-round">build</span>
                                </button>
                                <div class="tools-dropdown-content" id="tools-dropdown-content">
                                    <button type="button" class="btn" style="width: 100%; justify-content: flex-start; background: transparent; border-radius: 0; border-bottom: 1px solid var(--md-outline);" data-action="web-search">
                                        <span class="material-icons-round">search</span>
                                        <span>Web Search</span>
                                    </button>
                                    <button type="button" class="btn" style="width: 100%; justify-content: flex-start; background: transparent; border-radius: 0; border-bottom: 1px solid var(--md-outline);" data-action="brainstorm">
                                        <span class="material-icons-round">lightbulb</span>
                                        <span>Brainstorm</span>
                                    </button>
                                    <button type="button" class="btn" style="width: 100%; justify-content: flex-start; background: transparent; border-radius: 0;" data-action="explain-code">
                                        <span class="material-icons-round">code</span>
                                        <span>Explain Code</span>
                                    </button>
                                </div>
                            </div>
                            
                            <button type="button" id="file-upload-btn" class="action-btn" title="Upload File">
                                <span class="material-icons-round">attach_file</span>
                                <input type="file" id="file-input" accept="*/*" style="display: none;">
                            </button>
                            <button type="button" id="voice-input-btn" class="action-btn" title="Voice Input">
                                <span class="material-icons-round">mic</span>
                            </button>
                            <button type="submit" class="send-btn" id="send-btn">
                                <span class="material-icons-round" id="send-icon">send</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <!-- Footer -->
    <footer class="app-footer">
        <p>AI may produce inaccurate information. Verify important details.</p>
        <p>Made with  by Aditya Jha  Powered by Reverbit</p>
    </footer>

    <!-- Notification -->
    <div id="notification" class="notification">
        <span class="material-icons-round">check_circle</span>
        <span id="notification-text"></span>
    </div>

<script>
// ========== AUTHENTICATION SYSTEM ==========
const AuthSystem = {
    isAuthenticated: false,
    userData: null,
    checkInterval: null,
    
    async init() {
        console.log('Initializing authentication system...');
        await this.waitForReverbitAuth();
        this.checkReverbitAuthStatus();
        this.startAuthCheck();
        this.updateUI();
    },
    
    async waitForReverbitAuth() {
        return new Promise((resolve) => {
            const checkAuth = () => {
                if (window.ReverbitAuth && window.ReverbitAuth.initialized) {
                    console.log('ReverbitAuth found and initialized');
                    resolve();
                } else {
                    setTimeout(checkAuth, 100);
                }
            };
            checkAuth();
        });
    },
    
    checkReverbitAuthStatus() {
        try {
            if (window.ReverbitAuth && window.ReverbitAuth.getUser) {
                const user = window.ReverbitAuth.getUser();
                if (user) {
                    this.userData = {
                        uid: user.uid,
                        email: user.email,
                        name: user.displayName || user.email?.split('@')[0] || 'User',
                        photoURL: user.photoURL
                    };
                    this.isAuthenticated = true;
                    console.log('User authenticated via ReverbitAuth:', this.userData);
                    return true;
                }
            }
            
            const userData = localStorage.getItem('reverbit_user');
            if (userData) {
                try {
                    const parsedUser = JSON.parse(userData);
                    this.userData = {
                        uid: parsedUser.uid,
                        email: parsedUser.email,
                        name: parsedUser.displayName || parsedUser.email?.split('@')[0] || 'User',
                        photoURL: parsedUser.photoURL
                    };
                    this.isAuthenticated = true;
                    console.log('User authenticated via localStorage:', this.userData);
                    return true;
                } catch (e) {
                    console.error('Error parsing user data:', e);
                }
            }
            
            return false;
        } catch (error) {
            console.error('Error checking auth status:', error);
            return false;
        }
    },
    
    startAuthCheck() {
        this.checkInterval = setInterval(() => {
            this.verifyAuthStatus();
        }, 30000);
    },
    
    verifyAuthStatus() {
        const wasAuthenticated = this.isAuthenticated;
        this.checkReverbitAuthStatus();
        
        if (wasAuthenticated && !this.isAuthenticated) {
            this.showAuthRequired();
        } else if (!wasAuthenticated && this.isAuthenticated) {
            this.updateUI();
        }
    },
    
    showAuthRequired() {
        const overlay = document.getElementById('auth-required-overlay');
        if (overlay) {
            overlay.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }
    },
    
    hideAuthRequired() {
        const overlay = document.getElementById('auth-required-overlay');
        if (overlay) {
            overlay.style.display = 'none';
            document.body.style.overflow = '';
        }
    },
    
    updateUI() {
        if (this.isAuthenticated) {
            this.hideAuthRequired();
            
            // Hide splash screen
            const splash = document.getElementById('splash-screen');
            if (splash) splash.style.display = 'none';
            
            // Initialize app
            initializeAppAfterAuth();
        } else {
            this.showAuthRequired();
        }
    }
};

// ========== APP INITIALIZATION ==========
async function initializeApp() {
    await AuthSystem.init();
    
    if (!AuthSystem.isAuthenticated) {
        console.log('User not authenticated, showing auth overlay');
        AuthSystem.showAuthRequired();
        
        const signInBtn = document.getElementById('sign-in-btn');
        if (signInBtn) {
            signInBtn.addEventListener('click', function(e) {
                e.preventDefault();
                window.location.href = 'https://aditya-cmd-max.github.io/signin';
            });
        }
        
        return;
    }
    
    initializeAppAfterAuth();
}

async function initializeAppAfterAuth() {
    console.log('Initializing app after authentication...');
    
    // Initialize components
    initEventListeners();
    initializeChatSessions();
    initializeAITrainingSystem();
    
    // Hide splash screen
    const splash = document.getElementById('splash-screen');
    if (splash) splash.style.display = 'none';
}

// ========== DOM ELEMENTS ==========
const chatWindow = document.getElementById('chat-window');
const chatForm = document.getElementById('chat-form');
const messageInput = document.getElementById('message-input');
const sendBtn = document.getElementById('send-btn');
const chatSessionsContainer = document.getElementById('chat-sessions');
const mobileChatSessionsContainer = document.getElementById('mobile-chat-sessions');
const currentChatTitle = document.getElementById('current-chat-title');
const newChatBtn = document.getElementById('new-chat-btn');
const mobileNewChatBtn = document.getElementById('mobile-new-chat-btn');
const notification = document.getElementById('notification');
const notificationText = document.getElementById('notification-text');
const suggestionChips = document.querySelectorAll('.suggestion-chip');
const mobileNavBtn = document.getElementById('mobile-nav-btn');
const mobileSidebar = document.getElementById('mobile-sidebar');
const mobileSidebarOverlay = document.getElementById('mobile-sidebar-overlay');
const mobileSidebarClose = document.getElementById('mobile-sidebar-close');

// ========== STATE VARIABLES ==========
let currentChatId = null;
let chatSessions = {};
let isProcessing = false;
let abortController = null;
let userSettings = {
    userName: '',
    theme: 'default',
    darkMode: true,
    soundEnabled: true,
    typingAnimation: true,
    timestamps: true
};

// ========== AI TRAINING SYSTEM ==========
let aiTrainingSystem = null;

function initializeAITrainingSystem() {
    try {
        if (typeof AITrainingSystem !== 'undefined') {
            aiTrainingSystem = new AITrainingSystem();
            console.log('AI Training System initialized successfully');
        } else {
            console.warn('AI Training System not available');
        }
    } catch (error) {
        console.error('Error initializing AI Training System:', error);
    }
}

// ========== EVENT LISTENERS ==========
function initEventListeners() {
    // Mobile navigation
    mobileNavBtn.addEventListener('click', openMobileSidebar);
    mobileSidebarOverlay.addEventListener('click', closeMobileSidebar);
    mobileSidebarClose.addEventListener('click', closeMobileSidebar);
    
    // New chat
    newChatBtn.addEventListener('click', createNewChat);
    mobileNewChatBtn.addEventListener('click', createNewChat);
    
    // Chat form
    chatForm.addEventListener('submit', handleChatSubmit);
    
    // Message input
    messageInput.addEventListener('input', function() {
        this.style.height = 'auto';
        const newHeight = Math.min(this.scrollHeight, 120);
        this.style.height = newHeight + 'px';
        sendBtn.disabled = this.value.trim() === '' || isProcessing;
    });
    
    messageInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            if (!isProcessing && messageInput.value.trim() !== '') {
                chatForm.dispatchEvent(new Event('submit', { cancelable: true }));
            }
        }
    });
    
    // Suggestion chips
    suggestionChips.forEach(chip => {
        chip.addEventListener('click', () => {
            const prompt = chip.getAttribute('data-prompt');
            messageInput.value = prompt;
            messageInput.focus();
            chatForm.dispatchEvent(new Event('submit', { cancelable: true }));
        });
    });
    
    // Tools dropdown
    const toolsDropdownBtn = document.getElementById('tools-dropdown-btn');
    const toolsDropdownContent = document.getElementById('tools-dropdown-content');
    
    toolsDropdownBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        toolsDropdownContent.classList.toggle('show');
    });
    
    document.addEventListener('click', () => {
        toolsDropdownContent.classList.remove('show');
    });
    
    toolsDropdownContent.addEventListener('click', (e) => {
        e.stopPropagation();
    });
    
    // Tool actions
    document.querySelectorAll('[data-action]').forEach(btn => {
        btn.addEventListener('click', function() {
            const action = this.getAttribute('data-action');
            handleToolAction(action);
            toolsDropdownContent.classList.remove('show');
        });
    });
    
    // Clear chat
    const clearBtn = document.getElementById('clear-btn');
    const mobileClearBtn = document.getElementById('mobile-clear-btn');
    
    clearBtn.addEventListener('click', clearCurrentChat);
    mobileClearBtn.addEventListener('click', clearCurrentChat);
    
    // Export chat
    const exportBtn = document.getElementById('export-btn');
    const mobileExportBtn = document.getElementById('mobile-export-btn');
    
    exportBtn.addEventListener('click', exportCurrentChat);
    mobileExportBtn.addEventListener('click', exportCurrentChat);
    
    // File upload
    const fileUploadBtn = document.getElementById('file-upload-btn');
    const fileInput = document.getElementById('file-input');
    
    fileUploadBtn.addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', handleFileUpload);
    
    // Voice input
    const voiceInputBtn = document.getElementById('voice-input-btn');
    voiceInputBtn.addEventListener('click', startVoiceInput);
    
    // Search
    const searchInput = document.getElementById('search-chat-input');
    const mobileSearchInput = document.getElementById('mobile-search-chat-input');
    const clearSearchBtn = document.getElementById('clear-search-btn');
    const mobileClearSearchBtn = document.getElementById('mobile-clear-search-btn');
    
    searchInput.addEventListener('input', filterChatSessions);
    mobileSearchInput.addEventListener('input', filterChatSessions);
    clearSearchBtn.addEventListener('click', () => {
        searchInput.value = '';
        filterChatSessions();
    });
    mobileClearSearchBtn.addEventListener('click', () => {
        mobileSearchInput.value = '';
        filterChatSessions();
    });
    
    // Pin filter
    const pinFilterBtn = document.getElementById('pin-filter-btn');
    const mobilePinFilterBtn = document.getElementById('mobile-pin-filter-btn');
    
    pinFilterBtn.addEventListener('click', togglePinFilter);
    mobilePinFilterBtn.addEventListener('click', togglePinFilter);
}

// ========== CHAT FUNCTIONS ==========
async function createNewChat() {
    const chatId = 'chat_' + Date.now();
    const chatTitle = 'Chat ' + (Object.keys(chatSessions).length + 1);
    
    chatSessions[chatId] = {
        id: chatId,
        title: chatTitle,
        history: [],
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString(),
        pinned: false
    };
    
    currentChatId = chatId;
    saveChatSessions();
    renderChatSessions();
    loadChat(chatId);
    showNotification('New chat created');
    closeMobileSidebar();
    
    return chatId;
}

function loadChat(chatId) {
    if (!chatSessions[chatId]) return;
    
    const chat = chatSessions[chatId];
    currentChatId = chatId;
    currentChatTitle.textContent = chat.title;
    
    chatWindow.innerHTML = '';
    
    if (chat.history.length === 0) {
        const welcomeSection = document.querySelector('.welcome-section');
        if (welcomeSection) {
            chatWindow.appendChild(welcomeSection.cloneNode(true));
        }
    } else {
        chat.history.forEach(message => {
            if (message.role === "user") {
                displayUserMessage(message.content);
            } else if (message.role === "assistant") {
                displayBotMessage(message.content, false);
            }
        });
    }
    
    chatWindow.scrollTop = chatWindow.scrollHeight;
    closeMobileSidebar();
}

function saveChatSessions() {
    try {
        localStorage.setItem('cloverAIChatSessions', JSON.stringify(chatSessions));
    } catch (e) {
        console.error("Error saving chat sessions:", e);
    }
}

function initializeChatSessions() {
    const savedSessions = localStorage.getItem('cloverAIChatSessions');
    if (savedSessions) {
        chatSessions = JSON.parse(savedSessions);
    }
    
    if (Object.keys(chatSessions).length === 0) {
        createNewChat();
    } else {
        const chatIds = Object.keys(chatSessions);
        currentChatId = chatIds[chatIds.length - 1];
        loadChat(currentChatId);
    }
    
    renderChatSessions();
}

function renderChatSessions() {
    chatSessionsContainer.innerHTML = '';
    mobileChatSessionsContainer.innerHTML = '';
    
    Object.values(chatSessions)
        .sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt))
        .forEach(chat => {
            const sessionElement = createChatSessionElement(chat);
            chatSessionsContainer.appendChild(sessionElement);
            
            const mobileSessionElement = createChatSessionElement(chat);
            mobileChatSessionsContainer.appendChild(mobileSessionElement);
        });
}

function createChatSessionElement(chat) {
    const sessionElement = document.createElement('div');
    sessionElement.className = `chat-session ${chat.id === currentChatId ? 'active' : ''}`;
    sessionElement.innerHTML = `
        <span class="material-icons-round">chat</span>
        <span class="chat-session-title" style="flex: 1; overflow: hidden; text-overflow: ellipsis;">${chat.title}</span>
        <button class="btn-icon" style="width: 24px; height: 24px; background: transparent;" onclick="deleteChat('${chat.id}')">
            <span class="material-icons-round">close</span>
        </button>
    `;
    
    sessionElement.addEventListener('click', () => {
        if (chat.id !== currentChatId) {
            loadChat(chat.id);
        }
    });
    
    return sessionElement;
}

function deleteChat(chatId) {
    if (!confirm('Are you sure you want to delete this chat?')) return;
    
    delete chatSessions[chatId];
    saveChatSessions();
    renderChatSessions();
    
    if (currentChatId === chatId) {
        const remainingChats = Object.keys(chatSessions);
        if (remainingChats.length > 0) {
            currentChatId = remainingChats[0];
            loadChat(currentChatId);
        } else {
            createNewChat();
        }
    }
    
    showNotification('Chat deleted');
}

// ========== MESSAGE FUNCTIONS ==========
async function handleChatSubmit(e) {
    e.preventDefault();
    
    if (isProcessing) return;
    
    const userMessage = messageInput.value.trim();
    if (!userMessage) return;
    
    displayUserMessage(userMessage);
    messageInput.value = '';
    messageInput.style.height = 'auto';
    sendBtn.disabled = true;
    
    // Add to chat history
    if (chatSessions[currentChatId]) {
        chatSessions[currentChatId].history.push({
            role: "user",
            content: userMessage,
            timestamp: new Date().toISOString()
        });
        chatSessions[currentChatId].updatedAt = new Date().toISOString();
        saveChatSessions();
        renderChatSessions();
    }
    
    await getBotResponse(userMessage);
}

async function getBotResponse(userMessage) {
    showTypingIndicator();
    isProcessing = true;
    
    try {
        // Simulate AI response (replace with actual API call)
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        const responses = [
            "I understand you're asking about: " + userMessage + ". This is an interesting topic. Could you provide more details about what specifically you'd like to know?",
            "Great question! Based on your query about " + userMessage + ", I can provide detailed information. What aspect are you most interested in?",
            "Thanks for your question about " + userMessage + ". I'd be happy to help you with this. Could you clarify what specific information you're looking for?",
            "I've analyzed your question regarding " + userMessage + ". This is a complex topic that requires detailed explanation. Where would you like me to start?"
        ];
        
        const response = responses[Math.floor(Math.random() * responses.length)];
        
        hideTypingIndicator();
        displayBotMessage(response);
        
        // Add to chat history
        if (chatSessions[currentChatId]) {
            chatSessions[currentChatId].history.push({
                role: "assistant",
                content: response,
                timestamp: new Date().toISOString()
            });
            chatSessions[currentChatId].updatedAt = new Date().toISOString();
            saveChatSessions();
            renderChatSessions();
        }
        
    } catch (error) {
        console.error('Error getting bot response:', error);
        hideTypingIndicator();
        displayBotMessage("I apologize, but I'm having trouble processing your request. Please try again.", false);
    }
    
    isProcessing = false;
}

function displayUserMessage(message) {
    const messageElement = document.createElement('div');
    messageElement.className = 'message user';
    
    const avatar = AuthSystem.userData?.photoURL ? 
        `<img src="${AuthSystem.userData.photoURL}" alt="User Profile">` :
        '<span class="material-icons-round">person</span>';
    
    messageElement.innerHTML = `
        <div class="message-avatar">
            ${avatar}
        </div>
        <div class="message-bubble">
            <div class="message-content">${escapeHtml(message)}</div>
        </div>
    `;
    
    chatWindow.appendChild(messageElement);
    chatWindow.scrollTop = chatWindow.scrollHeight;
}

function displayBotMessage(message, typewriterEffect = true) {
    const messageElement = document.createElement('div');
    messageElement.className = 'message bot';
    
    messageElement.innerHTML = `
        <div class="message-avatar">
            <img src="https://aditya-cmd-max.github.io/cloverai/logo.png" alt="AI Logo">
        </div>
        <div class="message-bubble">
            <div class="message-content">${formatMessage(message)}</div>
            <div class="feedback-buttons">
                <button class="feedback-btn like-btn">
                    <span class="material-icons-round">thumb_up</span>
                </button>
                <button class="feedback-btn dislike-btn">
                    <span class="material-icons-round">thumb_down</span>
                </button>
                <button class="feedback-btn retry-btn">
                    <span class="material-icons-round">refresh</span>
                </button>
            </div>
        </div>
    `;
    
    chatWindow.appendChild(messageElement);
    chatWindow.scrollTop = chatWindow.scrollHeight;
}

function formatMessage(message) {
    // Basic formatting - replace markdown-like syntax
    let formatted = escapeHtml(message);
    formatted = formatted.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
    formatted = formatted.replace(/\*(.*?)\*/g, '<em>$1</em>');
    formatted = formatted.replace(/`(.*?)`/g, '<code>$1</code>');
    formatted = formatted.replace(/\n/g, '<br>');
    
    // Detect code blocks
    formatted = formatted.replace(/```(\w*)\n([\s\S]*?)```/g, (match, lang, code) => {
        return `<div class="code-block">
            <div class="code-header">${lang || 'Code'}</div>
            <div class="code-content">${escapeHtml(code)}</div>
        </div>`;
    });
    
    return formatted;
}

function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

function showTypingIndicator() {
    const typingElement = document.createElement('div');
    typingElement.className = 'typing-indicator';
    typingElement.id = 'typing-indicator';
    typingElement.innerHTML = `
        <div class="message-avatar">
            <img src="https://aditya-cmd-max.github.io/cloverai/logo.png" alt="AI Logo">
        </div>
        <div class="typing-dots">
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
        </div>
    `;
    chatWindow.appendChild(typingElement);
    chatWindow.scrollTop = chatWindow.scrollHeight;
}

function hideTypingIndicator() {
    const typingIndicator = document.getElementById('typing-indicator');
    if (typingIndicator) {
        typingIndicator.remove();
    }
}

// ========== UTILITY FUNCTIONS ==========
function showNotification(message, type = 'success') {
    notification.className = `notification ${type}`;
    notificationText.textContent = message;
    notification.classList.add('show');
    
    setTimeout(() => {
        notification.classList.remove('show');
    }, 3000);
}

function openMobileSidebar() {
    mobileSidebar.classList.add('active');
    mobileSidebarOverlay.classList.add('active');
}

function closeMobileSidebar() {
    mobileSidebar.classList.remove('active');
    mobileSidebarOverlay.classList.remove('active');
}

function clearCurrentChat() {
    if (!confirm('Are you sure you want to clear this chat?')) return;
    
    if (chatSessions[currentChatId]) {
        chatSessions[currentChatId].history = [];
        chatSessions[currentChatId].updatedAt = new Date().toISOString();
        saveChatSessions();
        loadChat(currentChatId);
        showNotification('Chat cleared');
    }
}

function exportCurrentChat() {
    const chat = chatSessions[currentChatId];
    if (!chat) return;
    
    const chatText = chat.history
        .map(entry => `${entry.role === 'user' ? 'You' : 'Clover AI'}: ${entry.content}`)
        .join('\n\n');
    
    const blob = new Blob([chatText], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `clover-ai-chat-${new Date().toISOString().split('T')[0]}.txt`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    showNotification('Chat exported');
}

function handleFileUpload(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    if (file.size > 10 * 1024 * 1024) {
        showNotification('File size should be less than 10MB', 'error');
        event.target.value = '';
        return;
    }
    
    const reader = new FileReader();
    reader.onload = function(e) {
        const messageElement = document.createElement('div');
        messageElement.className = 'message user';
        
        const fileIcon = file.type.match('image.*') ? 'image' : 
                        file.type.match('video.*') ? 'videocam' :
                        file.type.match('audio.*') ? 'audiotrack' :
                        file.type.includes('pdf') ? 'picture_as_pdf' : 'insert_drive_file';
        
        const fileContent = `
            <div style="display: flex; align-items: center; gap: 8px; padding: 8px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                <span class="material-icons-round">${fileIcon}</span>
                <div style="flex: 1;">
                    <div style="font-weight: 500;">${file.name}</div>
                    <div style="font-size: 12px; opacity: 0.8;">${formatFileSize(file.size)}</div>
                </div>
            </div>
            <div style="margin-top: 8px; font-size: 14px;">I've uploaded a file for analysis</div>
        `;
        
        messageElement.innerHTML = `
            <div class="message-avatar">
                <span class="material-icons-round">person</span>
            </div>
            <div class="message-bubble">
                ${fileContent}
            </div>
        `;
        
        chatWindow.appendChild(messageElement);
        chatWindow.scrollTop = chatWindow.scrollHeight;
        
        showNotification('File uploaded successfully');
    };
    
    reader.readAsDataURL(file);
    event.target.value = '';
}

function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

function startVoiceInput() {
    if (!('webkitSpeechRecognition' in window)) {
        showNotification('Voice input is not supported in your browser');
        return;
    }
    
    const recognition = new webkitSpeechRecognition();
    recognition.continuous = false;
    recognition.interimResults = false;
    
    recognition.onstart = function() {
        showNotification('Listening... Speak now');
    };
    
    recognition.onresult = function(event) {
        const transcript = event.results[0][0].transcript;
        messageInput.value = transcript;
        showNotification('Voice input captured');
    };
    
    recognition.onerror = function(event) {
        showNotification('Error occurred in recognition: ' + event.error);
    };
    
    recognition.start();
}

function handleToolAction(action) {
    switch(action) {
        case 'web-search':
            showNotification('Web search enabled');
            break;
        case 'brainstorm':
            showNotification('Brainstorm mode activated');
            break;
        case 'explain-code':
            showNotification('Code explanation mode activated');
            break;
    }
}

function filterChatSessions() {
    const searchTerm = document.getElementById('search-chat-input').value.toLowerCase();
    const mobileSearchTerm = document.getElementById('mobile-search-chat-input').value.toLowerCase();
    const term = searchTerm || mobileSearchTerm;
    
    if (!term) {
        renderChatSessions();
        return;
    }
    
    const filteredChats = Object.values(chatSessions).filter(chat => 
        chat.title.toLowerCase().includes(term) ||
        chat.history.some(msg => msg.content.toLowerCase().includes(term))
    );
    
    renderFilteredChatSessions(filteredChats);
}

function renderFilteredChatSessions(filteredChats) {
    chatSessionsContainer.innerHTML = '';
    mobileChatSessionsContainer.innerHTML = '';
    
    filteredChats
        .sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt))
        .forEach(chat => {
            const sessionElement = createChatSessionElement(chat);
            chatSessionsContainer.appendChild(sessionElement);
            
            const mobileSessionElement = createChatSessionElement(chat);
            mobileChatSessionsContainer.appendChild(mobileSessionElement);
        });
}

function togglePinFilter() {
    showNotification('Pin filter not implemented yet');
}

// ========== INITIALIZE APP ==========
document.addEventListener('DOMContentLoaded', function() {
    // Hide splash screen after 2 seconds
    setTimeout(() => {
        const splash = document.getElementById('splash-screen');
        if (splash) splash.style.display = 'none';
    }, 2000);
    
    initializeApp();
});

// Make functions available globally
window.deleteChat = deleteChat;
</script>
</body>
</html>
